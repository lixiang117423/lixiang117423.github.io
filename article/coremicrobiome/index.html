

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="李详【Xiang LI】">
  <meta name="keywords" content="">
  <meta name="google-site-verification" content="W0bd7QAXqv4_2p37UlvKzRbXgPQWZun5DbrUuQtdSI4">
  
    <meta name="description" content="12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394959697989910010110210">
<meta property="og:type" content="article">
<meta property="og:title" content="一种核心微生物的鉴定方法">
<meta property="og:url" content="https://lixiang117423.github.io/article/coremicrobiome/index.html">
<meta property="og:site_name" content="小蓝哥的知识荒原">
<meta property="og:description" content="12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394959697989910010110210">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202306081140194.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202306081140602.png">
<meta property="article:published_time" content="2023-06-08T01:22:16.000Z">
<meta property="article:modified_time" content="2025-11-14T08:27:55.537Z">
<meta property="article:author" content="小蓝哥">
<meta property="article:tag" content="生物信息学">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202306081140194.png">
  
  
  
  <title>一种核心微生物的鉴定方法 - 小蓝哥的知识荒原</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"lixiang117423.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":true,"offset_factor":3},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="小蓝哥的知识荒原" type="application/atom+xml">
</head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>小蓝哥的知识荒原</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://bing.biturl.top/?resolution=1920&format=image&index=0&mkt=zh-CN') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="一种核心微生物的鉴定方法"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-06-08 09:22" pubdate>
          2023年6月8日 上午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          2.4k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          20 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">一种核心微生物的鉴定方法</h1>
            
            
              <div class="markdown-body">
                
                <figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br></pre></td><td class="code"><pre><code class="hljs R"><span class="hljs-comment"># 核心微生物鉴定方法</span><br><br>rm<span class="hljs-punctuation">(</span><span class="hljs-built_in">list</span> <span class="hljs-operator">=</span> ls<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br><br>library<span class="hljs-punctuation">(</span>tidyverse<span class="hljs-punctuation">)</span><br>library<span class="hljs-punctuation">(</span>reshape2<span class="hljs-punctuation">)</span><br>library<span class="hljs-punctuation">(</span>vegan<span class="hljs-punctuation">)</span><br>library<span class="hljs-punctuation">(</span>ggsci<span class="hljs-punctuation">)</span><br>library<span class="hljs-punctuation">(</span>ggthemes<span class="hljs-punctuation">)</span><br><br><span class="hljs-comment">##############################################################################</span><br><span class="hljs-comment">############################## 定义关键函数 ##################################</span><br><span class="hljs-comment">##############################################################################</span><br><br><span class="hljs-comment"># Fits the neutral model from Sloan et al. 2006 to an OTU table and returns several fitting statistics. Alternatively, will return predicted occurrence frequencies for each OTU based on their abundance in the metacommunity when stats=FALSE.</span><br><span class="hljs-comment"># spp: 丰度表，行是样本，列是微生物信息，如OTU或者是ASV，而且必须是抽平以后的数据。</span><br><span class="hljs-comment"># pool: A community table for defining source community (optional; Default=NULL).</span><br><span class="hljs-comment"># taxon: OTU或者是ASV的信息，行是OTU或者ASV，列是分类信息。</span><br><span class="hljs-comment"># If stats=TRUE the function will return fitting statistics.</span><br><span class="hljs-comment"># If stats=FALSE the function will return a table of observed and predicted values for each otu.</span><br><br>sncm.fit <span class="hljs-operator">&lt;-</span> <span class="hljs-keyword">function</span><span class="hljs-punctuation">(</span>spp<span class="hljs-punctuation">,</span> pool <span class="hljs-operator">=</span> <span class="hljs-literal">NULL</span><span class="hljs-punctuation">,</span> stats <span class="hljs-operator">=</span> <span class="hljs-literal">TRUE</span><span class="hljs-punctuation">,</span> taxon <span class="hljs-operator">=</span> <span class="hljs-literal">NULL</span><span class="hljs-punctuation">)</span> <span class="hljs-punctuation">{</span><br>  require<span class="hljs-punctuation">(</span>minpack.lm<span class="hljs-punctuation">)</span><br>  require<span class="hljs-punctuation">(</span>Hmisc<span class="hljs-punctuation">)</span><br>  require<span class="hljs-punctuation">(</span>stats4<span class="hljs-punctuation">)</span><br><br>  options<span class="hljs-punctuation">(</span>warn <span class="hljs-operator">=</span> <span class="hljs-operator">-</span><span class="hljs-number">1</span><span class="hljs-punctuation">)</span><br><br>  <span class="hljs-comment"># Calculate the number of individuals per community</span><br>  N <span class="hljs-operator">&lt;-</span> mean<span class="hljs-punctuation">(</span>apply<span class="hljs-punctuation">(</span>spp<span class="hljs-punctuation">,</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span> <span class="hljs-built_in">sum</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br><br>  <span class="hljs-comment"># Calculate the average relative abundance of each taxa across communities</span><br>  <span class="hljs-keyword">if</span> <span class="hljs-punctuation">(</span><span class="hljs-built_in">is.null</span><span class="hljs-punctuation">(</span>pool<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-punctuation">{</span><br>    p.m <span class="hljs-operator">&lt;-</span> apply<span class="hljs-punctuation">(</span>spp<span class="hljs-punctuation">,</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span> mean<span class="hljs-punctuation">)</span><br>    p.m <span class="hljs-operator">&lt;-</span> p.m<span class="hljs-punctuation">[</span>p.m <span class="hljs-operator">!=</span> <span class="hljs-number">0</span><span class="hljs-punctuation">]</span><br>    p <span class="hljs-operator">&lt;-</span> p.m <span class="hljs-operator">/</span> N<br>  <span class="hljs-punctuation">}</span> <span class="hljs-keyword">else</span> <span class="hljs-punctuation">{</span><br>    p.m <span class="hljs-operator">&lt;-</span> apply<span class="hljs-punctuation">(</span>pool<span class="hljs-punctuation">,</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span> mean<span class="hljs-punctuation">)</span><br>    p.m <span class="hljs-operator">&lt;-</span> p.m<span class="hljs-punctuation">[</span>p.m <span class="hljs-operator">!=</span> <span class="hljs-number">0</span><span class="hljs-punctuation">]</span><br>    p <span class="hljs-operator">&lt;-</span> p.m <span class="hljs-operator">/</span> N<br>  <span class="hljs-punctuation">}</span><br><br>  <span class="hljs-comment"># Calculate the occurrence frequency of each taxa across communities</span><br>  spp.bi <span class="hljs-operator">&lt;-</span> 1 <span class="hljs-operator">*</span> <span class="hljs-punctuation">(</span>spp <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span><span class="hljs-punctuation">)</span><br>  freq <span class="hljs-operator">&lt;-</span> apply<span class="hljs-punctuation">(</span>spp.bi<span class="hljs-punctuation">,</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span> mean<span class="hljs-punctuation">)</span><br>  freq <span class="hljs-operator">&lt;-</span> freq<span class="hljs-punctuation">[</span>freq <span class="hljs-operator">!=</span> <span class="hljs-number">0</span><span class="hljs-punctuation">]</span><br><br>  <span class="hljs-comment"># Combine</span><br>  C <span class="hljs-operator">&lt;-</span> merge<span class="hljs-punctuation">(</span>p<span class="hljs-punctuation">,</span> freq<span class="hljs-punctuation">,</span> by <span class="hljs-operator">=</span> <span class="hljs-number">0</span><span class="hljs-punctuation">)</span><br>  C <span class="hljs-operator">&lt;-</span> C<span class="hljs-punctuation">[</span>order<span class="hljs-punctuation">(</span>C<span class="hljs-punctuation">[</span><span class="hljs-punctuation">,</span> <span class="hljs-number">2</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> <span class="hljs-punctuation">]</span><br>  C <span class="hljs-operator">&lt;-</span> as.data.frame<span class="hljs-punctuation">(</span>C<span class="hljs-punctuation">)</span><br>  C.0 <span class="hljs-operator">&lt;-</span> C<span class="hljs-punctuation">[</span><span class="hljs-operator">!</span><span class="hljs-punctuation">(</span>apply<span class="hljs-punctuation">(</span>C<span class="hljs-punctuation">,</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span> <span class="hljs-keyword">function</span><span class="hljs-punctuation">(</span>y<span class="hljs-punctuation">)</span> <span class="hljs-built_in">any</span><span class="hljs-punctuation">(</span>y <span class="hljs-operator">==</span> <span class="hljs-number">0</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> <span class="hljs-punctuation">]</span> <span class="hljs-comment"># Removes rows with any zero (absent in either source pool or local communities)</span><br>  p <span class="hljs-operator">&lt;-</span> C.0<span class="hljs-punctuation">[</span><span class="hljs-punctuation">,</span> <span class="hljs-number">2</span><span class="hljs-punctuation">]</span><br>  freq <span class="hljs-operator">&lt;-</span> C.0<span class="hljs-punctuation">[</span><span class="hljs-punctuation">,</span> <span class="hljs-number">3</span><span class="hljs-punctuation">]</span><br>  <span class="hljs-built_in">names</span><span class="hljs-punctuation">(</span>p<span class="hljs-punctuation">)</span> <span class="hljs-operator">&lt;-</span> C.0<span class="hljs-punctuation">[</span><span class="hljs-punctuation">,</span> <span class="hljs-number">1</span><span class="hljs-punctuation">]</span><br>  <span class="hljs-built_in">names</span><span class="hljs-punctuation">(</span>freq<span class="hljs-punctuation">)</span> <span class="hljs-operator">&lt;-</span> C.0<span class="hljs-punctuation">[</span><span class="hljs-punctuation">,</span> <span class="hljs-number">1</span><span class="hljs-punctuation">]</span><br><br>  <span class="hljs-comment"># Calculate the limit of detection</span><br>  d <span class="hljs-operator">&lt;-</span> 1 <span class="hljs-operator">/</span> N<br><br>  <span class="hljs-comment">## Fit model parameter m (or Nm) using Non-linear least squares (NLS)</span><br>  m.fit <span class="hljs-operator">&lt;-</span> nlsLM<span class="hljs-punctuation">(</span>freq <span class="hljs-operator">~</span> pbeta<span class="hljs-punctuation">(</span>d<span class="hljs-punctuation">,</span> N <span class="hljs-operator">*</span> m <span class="hljs-operator">*</span> p<span class="hljs-punctuation">,</span> N <span class="hljs-operator">*</span> m <span class="hljs-operator">*</span> <span class="hljs-punctuation">(</span><span class="hljs-number">1</span> <span class="hljs-operator">-</span> p<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> lower.tail <span class="hljs-operator">=</span> <span class="hljs-literal">FALSE</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> start <span class="hljs-operator">=</span> <span class="hljs-built_in">list</span><span class="hljs-punctuation">(</span>m <span class="hljs-operator">=</span> <span class="hljs-number">0.1</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>  m.ci <span class="hljs-operator">&lt;-</span> confint<span class="hljs-punctuation">(</span>m.fit<span class="hljs-punctuation">,</span> <span class="hljs-string">"m"</span><span class="hljs-punctuation">,</span> level <span class="hljs-operator">=</span> <span class="hljs-number">0.95</span><span class="hljs-punctuation">)</span><br><br>  <span class="hljs-comment">## Fit neutral model parameter m (or Nm) using Maximum likelihood estimation (MLE)</span><br>  sncm.LL <span class="hljs-operator">&lt;-</span> <span class="hljs-keyword">function</span><span class="hljs-punctuation">(</span>m<span class="hljs-punctuation">,</span> sigma<span class="hljs-punctuation">)</span> <span class="hljs-punctuation">{</span><br>    R <span class="hljs-operator">&lt;-</span> freq <span class="hljs-operator">-</span> pbeta<span class="hljs-punctuation">(</span>d<span class="hljs-punctuation">,</span> N <span class="hljs-operator">*</span> m <span class="hljs-operator">*</span> p<span class="hljs-punctuation">,</span> N <span class="hljs-operator">*</span> m <span class="hljs-operator">*</span> <span class="hljs-punctuation">(</span><span class="hljs-number">1</span> <span class="hljs-operator">-</span> p<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> lower.tail <span class="hljs-operator">=</span> <span class="hljs-literal">FALSE</span><span class="hljs-punctuation">)</span><br>    R <span class="hljs-operator">&lt;-</span> dnorm<span class="hljs-punctuation">(</span>R<span class="hljs-punctuation">,</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span> sigma<span class="hljs-punctuation">)</span><br>    <span class="hljs-operator">-</span><span class="hljs-built_in">sum</span><span class="hljs-punctuation">(</span><span class="hljs-built_in">log</span><span class="hljs-punctuation">(</span>R<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>  <span class="hljs-punctuation">}</span><br>  m.mle <span class="hljs-operator">&lt;-</span> mle<span class="hljs-punctuation">(</span>sncm.LL<span class="hljs-punctuation">,</span> start <span class="hljs-operator">=</span> <span class="hljs-built_in">list</span><span class="hljs-punctuation">(</span>m <span class="hljs-operator">=</span> <span class="hljs-number">0.1</span><span class="hljs-punctuation">,</span> sigma <span class="hljs-operator">=</span> <span class="hljs-number">0.1</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> nobs <span class="hljs-operator">=</span> <span class="hljs-built_in">length</span><span class="hljs-punctuation">(</span>p<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br><br>  <span class="hljs-comment">## Calculate Akaike's Information Criterion (AIC)</span><br>  aic.fit <span class="hljs-operator">&lt;-</span> AIC<span class="hljs-punctuation">(</span>m.mle<span class="hljs-punctuation">,</span> k <span class="hljs-operator">=</span> <span class="hljs-number">2</span><span class="hljs-punctuation">)</span><br>  bic.fit <span class="hljs-operator">&lt;-</span> BIC<span class="hljs-punctuation">(</span>m.mle<span class="hljs-punctuation">)</span><br><br>  <span class="hljs-comment">## Calculate goodness-of-fit (R-squared and Root Mean Squared Error)</span><br>  freq.pred <span class="hljs-operator">&lt;-</span> pbeta<span class="hljs-punctuation">(</span>d<span class="hljs-punctuation">,</span> N <span class="hljs-operator">*</span> coef<span class="hljs-punctuation">(</span>m.fit<span class="hljs-punctuation">)</span> <span class="hljs-operator">*</span> p<span class="hljs-punctuation">,</span> N <span class="hljs-operator">*</span> coef<span class="hljs-punctuation">(</span>m.fit<span class="hljs-punctuation">)</span> <span class="hljs-operator">*</span> <span class="hljs-punctuation">(</span><span class="hljs-number">1</span> <span class="hljs-operator">-</span> p<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> lower.tail <span class="hljs-operator">=</span> <span class="hljs-literal">FALSE</span><span class="hljs-punctuation">)</span><br>  Rsqr <span class="hljs-operator">&lt;-</span> 1 <span class="hljs-operator">-</span> <span class="hljs-punctuation">(</span><span class="hljs-built_in">sum</span><span class="hljs-punctuation">(</span><span class="hljs-punctuation">(</span>freq <span class="hljs-operator">-</span> freq.pred<span class="hljs-punctuation">)</span><span class="hljs-operator">^</span><span class="hljs-number">2</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">/</span> <span class="hljs-punctuation">(</span><span class="hljs-built_in">sum</span><span class="hljs-punctuation">(</span><span class="hljs-punctuation">(</span>freq <span class="hljs-operator">-</span> mean<span class="hljs-punctuation">(</span>freq<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-operator">^</span><span class="hljs-number">2</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>  RMSE <span class="hljs-operator">&lt;-</span> <span class="hljs-built_in">sqrt</span><span class="hljs-punctuation">(</span><span class="hljs-built_in">sum</span><span class="hljs-punctuation">(</span><span class="hljs-punctuation">(</span>freq <span class="hljs-operator">-</span> freq.pred<span class="hljs-punctuation">)</span><span class="hljs-operator">^</span><span class="hljs-number">2</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">/</span> <span class="hljs-punctuation">(</span><span class="hljs-built_in">length</span><span class="hljs-punctuation">(</span>freq<span class="hljs-punctuation">)</span> <span class="hljs-operator">-</span> <span class="hljs-number">1</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br><br>  pred.ci <span class="hljs-operator">&lt;-</span> binconf<span class="hljs-punctuation">(</span>freq.pred <span class="hljs-operator">*</span> nrow<span class="hljs-punctuation">(</span>spp<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> nrow<span class="hljs-punctuation">(</span>spp<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> alpha <span class="hljs-operator">=</span> <span class="hljs-number">0.05</span><span class="hljs-punctuation">,</span> method <span class="hljs-operator">=</span> <span class="hljs-string">"wilson"</span><span class="hljs-punctuation">,</span> return.df <span class="hljs-operator">=</span> <span class="hljs-literal">TRUE</span><span class="hljs-punctuation">)</span><br><br>  <span class="hljs-comment">## Calculate AIC for binomial model</span><br>  bino.LL <span class="hljs-operator">&lt;-</span> <span class="hljs-keyword">function</span><span class="hljs-punctuation">(</span>mu<span class="hljs-punctuation">,</span> sigma<span class="hljs-punctuation">)</span> <span class="hljs-punctuation">{</span><br>    R <span class="hljs-operator">&lt;-</span> freq <span class="hljs-operator">-</span> pbinom<span class="hljs-punctuation">(</span>d<span class="hljs-punctuation">,</span> N<span class="hljs-punctuation">,</span> p<span class="hljs-punctuation">,</span> lower.tail <span class="hljs-operator">=</span> <span class="hljs-literal">FALSE</span><span class="hljs-punctuation">)</span><br>    R <span class="hljs-operator">&lt;-</span> dnorm<span class="hljs-punctuation">(</span>R<span class="hljs-punctuation">,</span> mu<span class="hljs-punctuation">,</span> sigma<span class="hljs-punctuation">)</span><br>    <span class="hljs-operator">-</span><span class="hljs-built_in">sum</span><span class="hljs-punctuation">(</span><span class="hljs-built_in">log</span><span class="hljs-punctuation">(</span>R<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>  <span class="hljs-punctuation">}</span><br>  bino.mle <span class="hljs-operator">&lt;-</span> mle<span class="hljs-punctuation">(</span>bino.LL<span class="hljs-punctuation">,</span> start <span class="hljs-operator">=</span> <span class="hljs-built_in">list</span><span class="hljs-punctuation">(</span>mu <span class="hljs-operator">=</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span> sigma <span class="hljs-operator">=</span> <span class="hljs-number">0.1</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> nobs <span class="hljs-operator">=</span> <span class="hljs-built_in">length</span><span class="hljs-punctuation">(</span>p<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br><br>  aic.bino <span class="hljs-operator">&lt;-</span> AIC<span class="hljs-punctuation">(</span>bino.mle<span class="hljs-punctuation">,</span> k <span class="hljs-operator">=</span> <span class="hljs-number">2</span><span class="hljs-punctuation">)</span><br>  bic.bino <span class="hljs-operator">&lt;-</span> BIC<span class="hljs-punctuation">(</span>bino.mle<span class="hljs-punctuation">)</span><br><br>  <span class="hljs-comment">## Goodness of fit for binomial model</span><br>  bino.pred <span class="hljs-operator">&lt;-</span> pbinom<span class="hljs-punctuation">(</span>d<span class="hljs-punctuation">,</span> N<span class="hljs-punctuation">,</span> p<span class="hljs-punctuation">,</span> lower.tail <span class="hljs-operator">=</span> <span class="hljs-literal">FALSE</span><span class="hljs-punctuation">)</span><br>  Rsqr.bino <span class="hljs-operator">&lt;-</span> 1 <span class="hljs-operator">-</span> <span class="hljs-punctuation">(</span><span class="hljs-built_in">sum</span><span class="hljs-punctuation">(</span><span class="hljs-punctuation">(</span>freq <span class="hljs-operator">-</span> bino.pred<span class="hljs-punctuation">)</span><span class="hljs-operator">^</span><span class="hljs-number">2</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">/</span> <span class="hljs-punctuation">(</span><span class="hljs-built_in">sum</span><span class="hljs-punctuation">(</span><span class="hljs-punctuation">(</span>freq <span class="hljs-operator">-</span> mean<span class="hljs-punctuation">(</span>freq<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-operator">^</span><span class="hljs-number">2</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>  RMSE.bino <span class="hljs-operator">&lt;-</span> <span class="hljs-built_in">sqrt</span><span class="hljs-punctuation">(</span><span class="hljs-built_in">sum</span><span class="hljs-punctuation">(</span><span class="hljs-punctuation">(</span>freq <span class="hljs-operator">-</span> bino.pred<span class="hljs-punctuation">)</span><span class="hljs-operator">^</span><span class="hljs-number">2</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">/</span> <span class="hljs-punctuation">(</span><span class="hljs-built_in">length</span><span class="hljs-punctuation">(</span>freq<span class="hljs-punctuation">)</span> <span class="hljs-operator">-</span> <span class="hljs-number">1</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br><br>  bino.pred.ci <span class="hljs-operator">&lt;-</span> binconf<span class="hljs-punctuation">(</span>bino.pred <span class="hljs-operator">*</span> nrow<span class="hljs-punctuation">(</span>spp<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> nrow<span class="hljs-punctuation">(</span>spp<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> alpha <span class="hljs-operator">=</span> <span class="hljs-number">0.05</span><span class="hljs-punctuation">,</span> method <span class="hljs-operator">=</span> <span class="hljs-string">"wilson"</span><span class="hljs-punctuation">,</span> return.df <span class="hljs-operator">=</span> <span class="hljs-literal">TRUE</span><span class="hljs-punctuation">)</span><br><br>  <span class="hljs-comment">## Calculate AIC for Poisson model</span><br>  pois.LL <span class="hljs-operator">&lt;-</span> <span class="hljs-keyword">function</span><span class="hljs-punctuation">(</span>mu<span class="hljs-punctuation">,</span> sigma<span class="hljs-punctuation">)</span> <span class="hljs-punctuation">{</span><br>    R <span class="hljs-operator">&lt;-</span> freq <span class="hljs-operator">-</span> ppois<span class="hljs-punctuation">(</span>d<span class="hljs-punctuation">,</span> N <span class="hljs-operator">*</span> p<span class="hljs-punctuation">,</span> lower.tail <span class="hljs-operator">=</span> <span class="hljs-literal">FALSE</span><span class="hljs-punctuation">)</span><br>    R <span class="hljs-operator">&lt;-</span> dnorm<span class="hljs-punctuation">(</span>R<span class="hljs-punctuation">,</span> mu<span class="hljs-punctuation">,</span> sigma<span class="hljs-punctuation">)</span><br>    <span class="hljs-operator">-</span><span class="hljs-built_in">sum</span><span class="hljs-punctuation">(</span><span class="hljs-built_in">log</span><span class="hljs-punctuation">(</span>R<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>  <span class="hljs-punctuation">}</span><br>  pois.mle <span class="hljs-operator">&lt;-</span> mle<span class="hljs-punctuation">(</span>pois.LL<span class="hljs-punctuation">,</span> start <span class="hljs-operator">=</span> <span class="hljs-built_in">list</span><span class="hljs-punctuation">(</span>mu <span class="hljs-operator">=</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span> sigma <span class="hljs-operator">=</span> <span class="hljs-number">0.1</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> nobs <span class="hljs-operator">=</span> <span class="hljs-built_in">length</span><span class="hljs-punctuation">(</span>p<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br><br>  aic.pois <span class="hljs-operator">&lt;-</span> AIC<span class="hljs-punctuation">(</span>pois.mle<span class="hljs-punctuation">,</span> k <span class="hljs-operator">=</span> <span class="hljs-number">2</span><span class="hljs-punctuation">)</span><br>  bic.pois <span class="hljs-operator">&lt;-</span> BIC<span class="hljs-punctuation">(</span>pois.mle<span class="hljs-punctuation">)</span><br><br>  <span class="hljs-comment">## Goodness of fit for Poisson model</span><br>  pois.pred <span class="hljs-operator">&lt;-</span> ppois<span class="hljs-punctuation">(</span>d<span class="hljs-punctuation">,</span> N <span class="hljs-operator">*</span> p<span class="hljs-punctuation">,</span> lower.tail <span class="hljs-operator">=</span> <span class="hljs-literal">FALSE</span><span class="hljs-punctuation">)</span><br>  Rsqr.pois <span class="hljs-operator">&lt;-</span> 1 <span class="hljs-operator">-</span> <span class="hljs-punctuation">(</span><span class="hljs-built_in">sum</span><span class="hljs-punctuation">(</span><span class="hljs-punctuation">(</span>freq <span class="hljs-operator">-</span> pois.pred<span class="hljs-punctuation">)</span><span class="hljs-operator">^</span><span class="hljs-number">2</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">/</span> <span class="hljs-punctuation">(</span><span class="hljs-built_in">sum</span><span class="hljs-punctuation">(</span><span class="hljs-punctuation">(</span>freq <span class="hljs-operator">-</span> mean<span class="hljs-punctuation">(</span>freq<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-operator">^</span><span class="hljs-number">2</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>  RMSE.pois <span class="hljs-operator">&lt;-</span> <span class="hljs-built_in">sqrt</span><span class="hljs-punctuation">(</span><span class="hljs-built_in">sum</span><span class="hljs-punctuation">(</span><span class="hljs-punctuation">(</span>freq <span class="hljs-operator">-</span> pois.pred<span class="hljs-punctuation">)</span><span class="hljs-operator">^</span><span class="hljs-number">2</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">/</span> <span class="hljs-punctuation">(</span><span class="hljs-built_in">length</span><span class="hljs-punctuation">(</span>freq<span class="hljs-punctuation">)</span> <span class="hljs-operator">-</span> <span class="hljs-number">1</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br><br>  pois.pred.ci <span class="hljs-operator">&lt;-</span> binconf<span class="hljs-punctuation">(</span>pois.pred <span class="hljs-operator">*</span> nrow<span class="hljs-punctuation">(</span>spp<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> nrow<span class="hljs-punctuation">(</span>spp<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> alpha <span class="hljs-operator">=</span> <span class="hljs-number">0.05</span><span class="hljs-punctuation">,</span> method <span class="hljs-operator">=</span> <span class="hljs-string">"wilson"</span><span class="hljs-punctuation">,</span> return.df <span class="hljs-operator">=</span> <span class="hljs-literal">TRUE</span><span class="hljs-punctuation">)</span><br><br>  <span class="hljs-comment">## Results</span><br>  <span class="hljs-keyword">if</span> <span class="hljs-punctuation">(</span>stats <span class="hljs-operator">==</span> <span class="hljs-literal">TRUE</span><span class="hljs-punctuation">)</span> <span class="hljs-punctuation">{</span><br>    fitstats <span class="hljs-operator">&lt;-</span> data.frame<span class="hljs-punctuation">(</span>m <span class="hljs-operator">=</span> numeric<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> m.ci <span class="hljs-operator">=</span> numeric<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> m.mle <span class="hljs-operator">=</span> numeric<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> maxLL <span class="hljs-operator">=</span> numeric<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> binoLL <span class="hljs-operator">=</span> numeric<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> poisLL <span class="hljs-operator">=</span> numeric<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> Rsqr <span class="hljs-operator">=</span> numeric<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> Rsqr.bino <span class="hljs-operator">=</span> numeric<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> Rsqr.pois <span class="hljs-operator">=</span> numeric<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> RMSE <span class="hljs-operator">=</span> numeric<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> RMSE.bino <span class="hljs-operator">=</span> numeric<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> RMSE.pois <span class="hljs-operator">=</span> numeric<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> AIC <span class="hljs-operator">=</span> numeric<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> BIC <span class="hljs-operator">=</span> numeric<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> AIC.bino <span class="hljs-operator">=</span> numeric<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> BIC.bino <span class="hljs-operator">=</span> numeric<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> AIC.pois <span class="hljs-operator">=</span> numeric<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> BIC.pois <span class="hljs-operator">=</span> numeric<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> N <span class="hljs-operator">=</span> numeric<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> Samples <span class="hljs-operator">=</span> numeric<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> Richness <span class="hljs-operator">=</span> numeric<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> Detect <span class="hljs-operator">=</span> numeric<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>    fitstats<span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-punctuation">,</span> <span class="hljs-punctuation">]</span> <span class="hljs-operator">&lt;-</span> <span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span>coef<span class="hljs-punctuation">(</span>m.fit<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> coef<span class="hljs-punctuation">(</span>m.fit<span class="hljs-punctuation">)</span> <span class="hljs-operator">-</span> m.ci<span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> m.mle<span class="hljs-operator">@</span>coef<span class="hljs-punctuation">[</span><span class="hljs-string">"m"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> m.mle<span class="hljs-operator">@</span>details<span class="hljs-operator">$</span>value<span class="hljs-punctuation">,</span> bino.mle<span class="hljs-operator">@</span>details<span class="hljs-operator">$</span>value<span class="hljs-punctuation">,</span> pois.mle<span class="hljs-operator">@</span>details<span class="hljs-operator">$</span>value<span class="hljs-punctuation">,</span> Rsqr<span class="hljs-punctuation">,</span> Rsqr.bino<span class="hljs-punctuation">,</span> Rsqr.pois<span class="hljs-punctuation">,</span> RMSE<span class="hljs-punctuation">,</span> RMSE.bino<span class="hljs-punctuation">,</span> RMSE.pois<span class="hljs-punctuation">,</span> aic.fit<span class="hljs-punctuation">,</span> bic.fit<span class="hljs-punctuation">,</span> aic.bino<span class="hljs-punctuation">,</span> bic.bino<span class="hljs-punctuation">,</span> aic.pois<span class="hljs-punctuation">,</span> bic.pois<span class="hljs-punctuation">,</span> N<span class="hljs-punctuation">,</span> nrow<span class="hljs-punctuation">(</span>spp<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> <span class="hljs-built_in">length</span><span class="hljs-punctuation">(</span>p<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> d<span class="hljs-punctuation">)</span><br>    <span class="hljs-built_in">return</span><span class="hljs-punctuation">(</span>fitstats<span class="hljs-punctuation">)</span><br>  <span class="hljs-punctuation">}</span> <span class="hljs-keyword">else</span> <span class="hljs-punctuation">{</span><br>    A <span class="hljs-operator">&lt;-</span> cbind<span class="hljs-punctuation">(</span>p<span class="hljs-punctuation">,</span> freq<span class="hljs-punctuation">,</span> freq.pred<span class="hljs-punctuation">,</span> pred.ci<span class="hljs-punctuation">[</span><span class="hljs-punctuation">,</span> <span class="hljs-number">2</span><span class="hljs-operator">:</span><span class="hljs-number">3</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> bino.pred<span class="hljs-punctuation">,</span> bino.pred.ci<span class="hljs-punctuation">[</span><span class="hljs-punctuation">,</span> <span class="hljs-number">2</span><span class="hljs-operator">:</span><span class="hljs-number">3</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">)</span><br>    A <span class="hljs-operator">&lt;-</span> as.data.frame<span class="hljs-punctuation">(</span>A<span class="hljs-punctuation">)</span><br>    colnames<span class="hljs-punctuation">(</span>A<span class="hljs-punctuation">)</span> <span class="hljs-operator">&lt;-</span> <span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"p"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"freq"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"freq.pred"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"pred.lwr"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"pred.upr"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"bino.pred"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"bino.lwr"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"bino.upr"</span><span class="hljs-punctuation">)</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-punctuation">(</span><span class="hljs-built_in">is.null</span><span class="hljs-punctuation">(</span>taxon<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-punctuation">{</span><br>      B <span class="hljs-operator">&lt;-</span> A<span class="hljs-punctuation">[</span>order<span class="hljs-punctuation">(</span>A<span class="hljs-punctuation">[</span><span class="hljs-punctuation">,</span> <span class="hljs-number">1</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> <span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">}</span> <span class="hljs-keyword">else</span> <span class="hljs-punctuation">{</span><br>      B <span class="hljs-operator">&lt;-</span> merge<span class="hljs-punctuation">(</span>A<span class="hljs-punctuation">,</span> taxon<span class="hljs-punctuation">,</span> by <span class="hljs-operator">=</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-built_in">all</span> <span class="hljs-operator">=</span> <span class="hljs-literal">TRUE</span><span class="hljs-punctuation">)</span><br>      row.names<span class="hljs-punctuation">(</span>B<span class="hljs-punctuation">)</span> <span class="hljs-operator">&lt;-</span> B<span class="hljs-punctuation">[</span><span class="hljs-punctuation">,</span> <span class="hljs-number">1</span><span class="hljs-punctuation">]</span><br>      B <span class="hljs-operator">&lt;-</span> B<span class="hljs-punctuation">[</span><span class="hljs-punctuation">,</span> <span class="hljs-operator">-</span><span class="hljs-number">1</span><span class="hljs-punctuation">]</span><br>      B <span class="hljs-operator">&lt;-</span> B<span class="hljs-punctuation">[</span>order<span class="hljs-punctuation">(</span>B<span class="hljs-punctuation">[</span><span class="hljs-punctuation">,</span> <span class="hljs-number">1</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> <span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">}</span><br>    <span class="hljs-built_in">return</span><span class="hljs-punctuation">(</span>B<span class="hljs-punctuation">)</span><br>  <span class="hljs-punctuation">}</span><br><span class="hljs-punctuation">}</span><br><br><span class="hljs-comment">##############################################################################</span><br><span class="hljs-comment">########################### 时间序列核心微生物 ###############################</span><br><span class="hljs-comment">##############################################################################</span><br><br>df.otu <span class="hljs-operator">&lt;-</span> readr<span class="hljs-operator">::</span>read_rds<span class="hljs-punctuation">(</span><span class="hljs-string">"./data/switchgrassOTUtable.rds"</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  as.data.frame<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br><br>df.meta <span class="hljs-operator">&lt;-</span> readr<span class="hljs-operator">::</span>read_rds<span class="hljs-punctuation">(</span><span class="hljs-string">"./data/switchgrassMAPtable.rds"</span><span class="hljs-punctuation">)</span><br><br><span class="hljs-comment"># 使用tidyverse重写原来的代码</span><br>df.otu <span class="hljs-operator">%&gt;%</span><br>  vegan<span class="hljs-operator">::</span>decostand<span class="hljs-punctuation">(</span>method <span class="hljs-operator">=</span> <span class="hljs-string">"total"</span><span class="hljs-punctuation">,</span> MARGIN <span class="hljs-operator">=</span> <span class="hljs-number">2</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  apply<span class="hljs-punctuation">(</span><span class="hljs-number">1</span><span class="hljs-punctuation">,</span> mean<span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  as.data.frame<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  magrittr<span class="hljs-operator">::</span>set_names<span class="hljs-punctuation">(</span><span class="hljs-string">"otu.occ"</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">-&gt;</span> lx<br><br>otu.rel <span class="hljs-operator">&lt;-</span> apply<span class="hljs-punctuation">(</span>decostand<span class="hljs-punctuation">(</span>df.otu<span class="hljs-punctuation">,</span> method <span class="hljs-operator">=</span> <span class="hljs-string">"total"</span><span class="hljs-punctuation">,</span> MARGIN <span class="hljs-operator">=</span> <span class="hljs-number">2</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span> mean<span class="hljs-punctuation">)</span><br><br><br>df.otu <span class="hljs-operator">%&gt;%</span><br>  tibble<span class="hljs-operator">::</span>rownames_to_column<span class="hljs-punctuation">(</span>var <span class="hljs-operator">=</span> <span class="hljs-string">"otu"</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  tidyr<span class="hljs-operator">::</span>pivot_longer<span class="hljs-punctuation">(</span>cols <span class="hljs-operator">=</span> <span class="hljs-number">2</span><span class="hljs-operator">:</span>ncol<span class="hljs-punctuation">(</span>.<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  <span class="hljs-comment"># 存在-不存在鉴定，将丰度大于0的标记为1，丰度为0的标记为0</span><br>  dplyr<span class="hljs-operator">::</span>mutate<span class="hljs-punctuation">(</span><br>    otu.pa <span class="hljs-operator">=</span> case_when<span class="hljs-punctuation">(</span><br>      value <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span> <span class="hljs-operator">~</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-literal">TRUE</span> <span class="hljs-operator">~</span> <span class="hljs-number">0</span><br>    <span class="hljs-punctuation">)</span><br>  <span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  dplyr<span class="hljs-operator">::</span>group_by<span class="hljs-punctuation">(</span>otu<span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  dplyr<span class="hljs-operator">::</span>mutate<span class="hljs-punctuation">(</span>otu.sum <span class="hljs-operator">=</span> <span class="hljs-built_in">sum</span><span class="hljs-punctuation">(</span>otu.pa<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  dplyr<span class="hljs-operator">::</span>ungroup<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  dplyr<span class="hljs-operator">::</span>group_by<span class="hljs-punctuation">(</span>name<span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  <span class="hljs-comment"># 计算OTU存在的频率，也就是在多少样本里面出现过</span><br>  dplyr<span class="hljs-operator">::</span>mutate<span class="hljs-punctuation">(</span><br>    n.sample <span class="hljs-operator">=</span> ncol<span class="hljs-punctuation">(</span>df.otu<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>    sum.sample <span class="hljs-operator">=</span> <span class="hljs-built_in">sum</span><span class="hljs-punctuation">(</span>value<span class="hljs-punctuation">)</span><br>  <span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  dplyr<span class="hljs-operator">::</span>mutate<span class="hljs-punctuation">(</span><br>    otu.occ <span class="hljs-operator">=</span> otu.sum <span class="hljs-operator">/</span> n.sample<span class="hljs-punctuation">,</span><br>    decostand <span class="hljs-operator">=</span> value <span class="hljs-operator">/</span> sum.sample<br>  <span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  dplyr<span class="hljs-operator">::</span>ungroup<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  dplyr<span class="hljs-operator">::</span>group_by<span class="hljs-punctuation">(</span>otu<span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  <span class="hljs-comment"># 计算每个OTU的平均相对丰度</span><br>  dplyr<span class="hljs-operator">::</span>mutate<span class="hljs-punctuation">(</span>otu.rel <span class="hljs-operator">=</span> mean<span class="hljs-punctuation">(</span>decostand<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  dplyr<span class="hljs-operator">::</span>ungroup<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">-&gt;</span> df.otu.new<br><br><span class="hljs-comment"># 绘图</span><br>df.otu.new <span class="hljs-operator">%&gt;%</span><br>  dplyr<span class="hljs-operator">::</span>select<span class="hljs-punctuation">(</span>otu.rel<span class="hljs-punctuation">,</span> otu.occ<span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  dplyr<span class="hljs-operator">::</span>distinct_all<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  ggplot<span class="hljs-punctuation">(</span>aes<span class="hljs-punctuation">(</span>x <span class="hljs-operator">=</span> log10<span class="hljs-punctuation">(</span>otu.rel<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> y <span class="hljs-operator">=</span> otu.occ<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_point<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  labs<span class="hljs-punctuation">(</span>x <span class="hljs-operator">=</span> <span class="hljs-string">"log10(mean relative abundance)"</span><span class="hljs-punctuation">,</span> y <span class="hljs-operator">=</span> <span class="hljs-string">"Occupancy"</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  pac4xiang<span class="hljs-operator">::</span>mytheme<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br><br><span class="hljs-comment"># 基于出现频率对OTU进行排序</span><br>df.otu <span class="hljs-operator">%&gt;%</span><br>  tibble<span class="hljs-operator">::</span>rownames_to_column<span class="hljs-punctuation">(</span>var <span class="hljs-operator">=</span> <span class="hljs-string">"otu"</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  dplyr<span class="hljs-operator">::</span>mutate<span class="hljs-punctuation">(</span>otu <span class="hljs-operator">=</span> factor<span class="hljs-punctuation">(</span>otu<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  tidyr<span class="hljs-operator">::</span>pivot_longer<span class="hljs-punctuation">(</span><br>    cols <span class="hljs-operator">=</span> <span class="hljs-number">2</span><span class="hljs-operator">:</span>ncol<span class="hljs-punctuation">(</span>.<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>    names_to <span class="hljs-operator">=</span> <span class="hljs-string">"sequence_name"</span><span class="hljs-punctuation">,</span> values_to <span class="hljs-operator">=</span> <span class="hljs-string">"abun"</span><br>  <span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  dplyr<span class="hljs-operator">::</span>left_join<span class="hljs-punctuation">(</span>df.meta<span class="hljs-punctuation">,</span> by <span class="hljs-operator">=</span> <span class="hljs-string">"sequence_name"</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  dplyr<span class="hljs-operator">::</span>group_by<span class="hljs-punctuation">(</span>otu<span class="hljs-punctuation">,</span> sampling_date<span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  summarise<span class="hljs-punctuation">(</span><br>    time_freq <span class="hljs-operator">=</span> <span class="hljs-built_in">sum</span><span class="hljs-punctuation">(</span>abun <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">/</span> <span class="hljs-built_in">length</span><span class="hljs-punctuation">(</span>abun<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> <span class="hljs-comment"># frequency of detection between time points</span><br>    coreTime <span class="hljs-operator">=</span> ifelse<span class="hljs-punctuation">(</span>time_freq <span class="hljs-operator">==</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span> <span class="hljs-number">0</span><span class="hljs-punctuation">)</span><br>  <span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  group_by<span class="hljs-punctuation">(</span>otu<span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  summarise<span class="hljs-punctuation">(</span><br>    sumF <span class="hljs-operator">=</span> <span class="hljs-built_in">sum</span><span class="hljs-punctuation">(</span>time_freq<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>    sumG <span class="hljs-operator">=</span> <span class="hljs-built_in">sum</span><span class="hljs-punctuation">(</span>coreTime<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>    nS <span class="hljs-operator">=</span> <span class="hljs-built_in">length</span><span class="hljs-punctuation">(</span>sampling_date<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>    Index <span class="hljs-operator">=</span> <span class="hljs-punctuation">(</span>sumF <span class="hljs-operator">+</span> sumG<span class="hljs-punctuation">)</span> <span class="hljs-operator">/</span> nS<br>  <span class="hljs-punctuation">)</span> <span class="hljs-operator">-&gt;</span> PresenceSum<br><br>df.otu.new <span class="hljs-operator">%&gt;%</span><br>  dplyr<span class="hljs-operator">::</span>select<span class="hljs-punctuation">(</span>otu<span class="hljs-punctuation">,</span> otu.rel<span class="hljs-punctuation">,</span> otu.occ<span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  dplyr<span class="hljs-operator">::</span>distinct_all<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  dplyr<span class="hljs-operator">::</span>left_join<span class="hljs-punctuation">(</span>PresenceSum<span class="hljs-punctuation">,</span> by <span class="hljs-operator">=</span> <span class="hljs-string">"otu"</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  dplyr<span class="hljs-operator">::</span>transmute<span class="hljs-punctuation">(</span><br>    otu <span class="hljs-operator">=</span> otu<span class="hljs-punctuation">,</span><br>    rank <span class="hljs-operator">=</span> Index<br>  <span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  dplyr<span class="hljs-operator">::</span>arrange<span class="hljs-punctuation">(</span>desc<span class="hljs-punctuation">(</span>rank<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">-&gt;</span> otu.ranked<br><br><br><span class="hljs-comment"># 计算OTU的贡献度</span><br>BCaddition <span class="hljs-operator">&lt;-</span> <span class="hljs-literal">NULL</span><br><br>otu.start <span class="hljs-operator">&lt;-</span> otu.ranked<span class="hljs-operator">$</span>otu<span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-punctuation">]</span><br>start.matrix <span class="hljs-operator">&lt;-</span> df.otu<span class="hljs-punctuation">[</span>otu.start<span class="hljs-punctuation">,</span> <span class="hljs-punctuation">]</span> <span class="hljs-operator">%&gt;%</span> as.matrix<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br>x <span class="hljs-operator">&lt;-</span> apply<span class="hljs-punctuation">(</span>combn<span class="hljs-punctuation">(</span>ncol<span class="hljs-punctuation">(</span>start.matrix<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> <span class="hljs-number">2</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span> <span class="hljs-keyword">function</span><span class="hljs-punctuation">(</span>x<span class="hljs-punctuation">)</span> <span class="hljs-built_in">sum</span><span class="hljs-punctuation">(</span><span class="hljs-built_in">abs</span><span class="hljs-punctuation">(</span>start.matrix<span class="hljs-punctuation">[</span><span class="hljs-punctuation">,</span> x<span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">]</span> <span class="hljs-operator">-</span> start.matrix<span class="hljs-punctuation">[</span><span class="hljs-punctuation">,</span> x<span class="hljs-punctuation">[</span><span class="hljs-number">2</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">/</span> <span class="hljs-punctuation">(</span><span class="hljs-number">2</span> <span class="hljs-operator">*</span> colSums<span class="hljs-punctuation">(</span>df.otu<span class="hljs-punctuation">)</span><span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>x.names <span class="hljs-operator">&lt;-</span> apply<span class="hljs-punctuation">(</span>combn<span class="hljs-punctuation">(</span>ncol<span class="hljs-punctuation">(</span>start.matrix<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> <span class="hljs-number">2</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span> <span class="hljs-keyword">function</span><span class="hljs-punctuation">(</span>x<span class="hljs-punctuation">)</span> paste<span class="hljs-punctuation">(</span>colnames<span class="hljs-punctuation">(</span>start.matrix<span class="hljs-punctuation">)</span><span class="hljs-punctuation">[</span>x<span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> collapse <span class="hljs-operator">=</span> <span class="hljs-string">" - "</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br><br>data.frame<span class="hljs-punctuation">(</span>x.names<span class="hljs-punctuation">,</span> x<span class="hljs-punctuation">)</span> <span class="hljs-operator">-&gt;</span> df.s<br><span class="hljs-built_in">names</span><span class="hljs-punctuation">(</span>df.s<span class="hljs-punctuation">)</span><span class="hljs-punctuation">[</span><span class="hljs-number">2</span><span class="hljs-punctuation">]</span> <span class="hljs-operator">&lt;-</span> <span class="hljs-number">1</span><br>BCaddition <span class="hljs-operator">&lt;-</span> rbind<span class="hljs-punctuation">(</span>BCaddition<span class="hljs-punctuation">,</span> df.s<span class="hljs-punctuation">)</span><br><br><span class="hljs-comment"># length(otu.ranked$otu)</span><br><span class="hljs-keyword">for</span> <span class="hljs-punctuation">(</span>i <span class="hljs-keyword">in</span> <span class="hljs-number">2</span><span class="hljs-operator">:</span><span class="hljs-number">500</span><span class="hljs-punctuation">)</span> <span class="hljs-punctuation">{</span><br>  otu.add <span class="hljs-operator">&lt;-</span> otu.ranked<span class="hljs-operator">$</span>otu<span class="hljs-punctuation">[</span>i<span class="hljs-punctuation">]</span><br>  add.matrix <span class="hljs-operator">&lt;-</span> df.otu<span class="hljs-punctuation">[</span>otu.add<span class="hljs-punctuation">,</span> <span class="hljs-punctuation">]</span> <span class="hljs-operator">%&gt;%</span> as.matrix<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br>  start.matrix <span class="hljs-operator">&lt;-</span> rbind<span class="hljs-punctuation">(</span>start.matrix<span class="hljs-punctuation">,</span> add.matrix<span class="hljs-punctuation">)</span><br>  x <span class="hljs-operator">&lt;-</span> apply<span class="hljs-punctuation">(</span>combn<span class="hljs-punctuation">(</span>ncol<span class="hljs-punctuation">(</span>start.matrix<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> <span class="hljs-number">2</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span> <span class="hljs-keyword">function</span><span class="hljs-punctuation">(</span>x<span class="hljs-punctuation">)</span> <span class="hljs-built_in">sum</span><span class="hljs-punctuation">(</span><span class="hljs-built_in">abs</span><span class="hljs-punctuation">(</span>start.matrix<span class="hljs-punctuation">[</span><span class="hljs-punctuation">,</span> x<span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">]</span> <span class="hljs-operator">-</span> start.matrix<span class="hljs-punctuation">[</span><span class="hljs-punctuation">,</span> x<span class="hljs-punctuation">[</span><span class="hljs-number">2</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">/</span> <span class="hljs-punctuation">(</span><span class="hljs-number">2</span> <span class="hljs-operator">*</span> colSums<span class="hljs-punctuation">(</span>df.otu<span class="hljs-punctuation">)</span><span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>  x.names <span class="hljs-operator">&lt;-</span> apply<span class="hljs-punctuation">(</span>combn<span class="hljs-punctuation">(</span>ncol<span class="hljs-punctuation">(</span>start.matrix<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> <span class="hljs-number">2</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span> <span class="hljs-keyword">function</span><span class="hljs-punctuation">(</span>x<span class="hljs-punctuation">)</span> paste<span class="hljs-punctuation">(</span>colnames<span class="hljs-punctuation">(</span>start.matrix<span class="hljs-punctuation">)</span><span class="hljs-punctuation">[</span>x<span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> collapse <span class="hljs-operator">=</span> <span class="hljs-string">" - "</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>  df.a <span class="hljs-operator">&lt;-</span> data.frame<span class="hljs-punctuation">(</span>x.names<span class="hljs-punctuation">,</span> x<span class="hljs-punctuation">)</span><br>  <span class="hljs-built_in">names</span><span class="hljs-punctuation">(</span>df.a<span class="hljs-punctuation">)</span><span class="hljs-punctuation">[</span><span class="hljs-number">2</span><span class="hljs-punctuation">]</span> <span class="hljs-operator">&lt;-</span> i<br>  BCaddition <span class="hljs-operator">&lt;-</span> dplyr<span class="hljs-operator">::</span>left_join<span class="hljs-punctuation">(</span>BCaddition<span class="hljs-punctuation">,</span> df.a<span class="hljs-punctuation">,</span> by <span class="hljs-operator">=</span> <span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"x.names"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br><span class="hljs-punctuation">}</span><br><br><span class="hljs-comment"># 计算整个群落的贡献度</span><br>x <span class="hljs-operator">&lt;-</span> apply<span class="hljs-punctuation">(</span>combn<span class="hljs-punctuation">(</span>ncol<span class="hljs-punctuation">(</span>df.otu<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> <span class="hljs-number">2</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span> <span class="hljs-keyword">function</span><span class="hljs-punctuation">(</span>x<span class="hljs-punctuation">)</span> <span class="hljs-built_in">sum</span><span class="hljs-punctuation">(</span><span class="hljs-built_in">abs</span><span class="hljs-punctuation">(</span>df.otu<span class="hljs-punctuation">[</span><span class="hljs-punctuation">,</span> x<span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">]</span> <span class="hljs-operator">-</span> df.otu<span class="hljs-punctuation">[</span><span class="hljs-punctuation">,</span> x<span class="hljs-punctuation">[</span><span class="hljs-number">2</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">/</span> <span class="hljs-punctuation">(</span><span class="hljs-number">2</span> <span class="hljs-operator">*</span> colSums<span class="hljs-punctuation">(</span>df.otu<span class="hljs-punctuation">)</span><span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>x.names <span class="hljs-operator">&lt;-</span> apply<span class="hljs-punctuation">(</span>combn<span class="hljs-punctuation">(</span>ncol<span class="hljs-punctuation">(</span>df.otu<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> <span class="hljs-number">2</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span> <span class="hljs-keyword">function</span><span class="hljs-punctuation">(</span>x<span class="hljs-punctuation">)</span> paste<span class="hljs-punctuation">(</span>colnames<span class="hljs-punctuation">(</span>df.otu<span class="hljs-punctuation">)</span><span class="hljs-punctuation">[</span>x<span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> collapse <span class="hljs-operator">=</span> <span class="hljs-string">" - "</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>df.full <span class="hljs-operator">&lt;-</span> data.frame<span class="hljs-punctuation">(</span>x.names<span class="hljs-punctuation">,</span> x<span class="hljs-punctuation">)</span><br><span class="hljs-built_in">names</span><span class="hljs-punctuation">(</span>df.full<span class="hljs-punctuation">)</span><span class="hljs-punctuation">[</span><span class="hljs-number">2</span><span class="hljs-punctuation">]</span> <span class="hljs-operator">&lt;-</span> <span class="hljs-built_in">length</span><span class="hljs-punctuation">(</span>rownames<span class="hljs-punctuation">(</span>df.otu<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>BCfull <span class="hljs-operator">&lt;-</span> dplyr<span class="hljs-operator">::</span>left_join<span class="hljs-punctuation">(</span>BCaddition<span class="hljs-punctuation">,</span> df.full<span class="hljs-punctuation">,</span> by <span class="hljs-operator">=</span> <span class="hljs-string">"x.names"</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  tibble<span class="hljs-operator">::</span>column_to_rownames<span class="hljs-punctuation">(</span>var <span class="hljs-operator">=</span> <span class="hljs-string">"x.names"</span><span class="hljs-punctuation">)</span><br><br>temp_BC <span class="hljs-operator">&lt;-</span> BCfull<br>temp_BC<span class="hljs-operator">$</span>x_names <span class="hljs-operator">&lt;-</span> <span class="hljs-literal">NULL</span><br>temp_BC_matrix <span class="hljs-operator">&lt;-</span> as.matrix<span class="hljs-punctuation">(</span>temp_BC<span class="hljs-punctuation">)</span><br><br>BC_ranked <span class="hljs-operator">&lt;-</span> data.frame<span class="hljs-punctuation">(</span>rank <span class="hljs-operator">=</span> as.factor<span class="hljs-punctuation">(</span>row.names<span class="hljs-punctuation">(</span>t<span class="hljs-punctuation">(</span>temp_BC_matrix<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> t<span class="hljs-punctuation">(</span>temp_BC_matrix<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  gather<span class="hljs-punctuation">(</span>comparison<span class="hljs-punctuation">,</span> BC<span class="hljs-punctuation">,</span> <span class="hljs-operator">-</span>rank<span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  group_by<span class="hljs-punctuation">(</span>rank<span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  summarise<span class="hljs-punctuation">(</span>MeanBC <span class="hljs-operator">=</span> mean<span class="hljs-punctuation">(</span>BC<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> <span class="hljs-comment"># mean Bray-Curtis dissimilarity</span><br>  arrange<span class="hljs-punctuation">(</span>desc<span class="hljs-punctuation">(</span><span class="hljs-operator">-</span>MeanBC<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  mutate<span class="hljs-punctuation">(</span>proportionBC <span class="hljs-operator">=</span> MeanBC <span class="hljs-operator">/</span> <span class="hljs-built_in">max</span><span class="hljs-punctuation">(</span>MeanBC<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-comment"># proportion of the dissimilarity explained by the n number of ranked OTUs</span><br>Increase <span class="hljs-operator">&lt;-</span> BC_ranked<span class="hljs-operator">$</span>MeanBC<span class="hljs-punctuation">[</span><span class="hljs-operator">-</span><span class="hljs-number">1</span><span class="hljs-punctuation">]</span> <span class="hljs-operator">/</span> BC_ranked<span class="hljs-operator">$</span>MeanBC<span class="hljs-punctuation">[</span><span class="hljs-operator">-</span><span class="hljs-built_in">length</span><span class="hljs-punctuation">(</span>BC_ranked<span class="hljs-operator">$</span>MeanBC<span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span><br>increaseDF <span class="hljs-operator">&lt;-</span> data.frame<span class="hljs-punctuation">(</span>IncreaseBC <span class="hljs-operator">=</span> <span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-punctuation">(</span>Increase<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> rank <span class="hljs-operator">=</span> factor<span class="hljs-punctuation">(</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-number">1</span><span class="hljs-operator">:</span><span class="hljs-punctuation">(</span><span class="hljs-built_in">length</span><span class="hljs-punctuation">(</span>Increase<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <span class="hljs-number">1</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>BC_ranked <span class="hljs-operator">&lt;-</span> dplyr<span class="hljs-operator">::</span>left_join<span class="hljs-punctuation">(</span>BC_ranked<span class="hljs-punctuation">,</span> increaseDF<span class="hljs-punctuation">)</span><br>BC_ranked <span class="hljs-operator">&lt;-</span> BC_ranked<span class="hljs-punctuation">[</span><span class="hljs-operator">-</span>nrow<span class="hljs-punctuation">(</span>BC_ranked<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> <span class="hljs-punctuation">]</span><br><br><span class="hljs-comment"># 设置阈值进行筛选</span><br><br><span class="hljs-comment"># 方法一：Elbow method (first order difference)</span><br><br>fo_difference <span class="hljs-operator">&lt;-</span> <span class="hljs-keyword">function</span><span class="hljs-punctuation">(</span>pos<span class="hljs-punctuation">)</span> <span class="hljs-punctuation">{</span><br>  left <span class="hljs-operator">&lt;-</span> <span class="hljs-punctuation">(</span>BC_ranked<span class="hljs-punctuation">[</span>pos<span class="hljs-punctuation">,</span> <span class="hljs-number">2</span><span class="hljs-punctuation">]</span> <span class="hljs-operator">-</span> BC_ranked<span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-punctuation">,</span> <span class="hljs-number">2</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">/</span> pos<br>  right <span class="hljs-operator">&lt;-</span> <span class="hljs-punctuation">(</span>BC_ranked<span class="hljs-punctuation">[</span>nrow<span class="hljs-punctuation">(</span>BC_ranked<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> <span class="hljs-number">2</span><span class="hljs-punctuation">]</span> <span class="hljs-operator">-</span> BC_ranked<span class="hljs-punctuation">[</span>pos<span class="hljs-punctuation">,</span> <span class="hljs-number">2</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">/</span> <span class="hljs-punctuation">(</span>nrow<span class="hljs-punctuation">(</span>BC_ranked<span class="hljs-punctuation">)</span> <span class="hljs-operator">-</span> pos<span class="hljs-punctuation">)</span><br>  <span class="hljs-built_in">return</span><span class="hljs-punctuation">(</span>left <span class="hljs-operator">-</span> right<span class="hljs-punctuation">)</span><br><span class="hljs-punctuation">}</span><br><br>BC_ranked<span class="hljs-operator">$</span>fo_diffs <span class="hljs-operator">&lt;-</span> sapply<span class="hljs-punctuation">(</span><span class="hljs-number">1</span><span class="hljs-operator">:</span>nrow<span class="hljs-punctuation">(</span>BC_ranked<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> fo_difference<span class="hljs-punctuation">)</span><br><br>elbow <span class="hljs-operator">&lt;-</span> which.max<span class="hljs-punctuation">(</span>BC_ranked<span class="hljs-operator">$</span>fo_diffs<span class="hljs-punctuation">)</span><br><br><span class="hljs-comment"># 方法二：Final increase in BC similarity of equal or greater then 2%</span><br>lastCall <span class="hljs-operator">&lt;-</span> last<span class="hljs-punctuation">(</span><span class="hljs-built_in">as.numeric</span><span class="hljs-punctuation">(</span><span class="hljs-built_in">as.character</span><span class="hljs-punctuation">(</span>BC_ranked<span class="hljs-operator">$</span>rank<span class="hljs-punctuation">[</span><span class="hljs-punctuation">(</span>BC_ranked<span class="hljs-operator">$</span>IncreaseBC <span class="hljs-operator">&gt;=</span> <span class="hljs-number">1.02</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br><br><span class="hljs-comment"># 绘图</span><br>thread <span class="hljs-operator">&lt;-</span> BC_ranked<span class="hljs-punctuation">[</span>BC_ranked<span class="hljs-operator">$</span>rank <span class="hljs-operator">==</span> lastCall<span class="hljs-punctuation">,</span> <span class="hljs-punctuation">]</span><span class="hljs-operator">$</span>proportionBC<br><br>BC_ranked <span class="hljs-operator">%&gt;%</span><br>  dplyr<span class="hljs-operator">::</span>slice<span class="hljs-punctuation">(</span><span class="hljs-number">1</span><span class="hljs-operator">:</span><span class="hljs-number">100</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  dplyr<span class="hljs-operator">::</span>mutate<span class="hljs-punctuation">(</span>rank <span class="hljs-operator">=</span> <span class="hljs-built_in">as.numeric</span><span class="hljs-punctuation">(</span>rank<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  dplyr<span class="hljs-operator">::</span>mutate<span class="hljs-punctuation">(</span>col <span class="hljs-operator">=</span> case_when<span class="hljs-punctuation">(</span><br>    proportionBC <span class="hljs-operator">&lt;</span> thread <span class="hljs-operator">~</span> <span class="hljs-string">"Core"</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-literal">TRUE</span> <span class="hljs-operator">~</span> <span class="hljs-string">"Non-core"</span><br>  <span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  dplyr<span class="hljs-operator">::</span>mutate<span class="hljs-punctuation">(</span>rank <span class="hljs-operator">=</span> factor<span class="hljs-punctuation">(</span>rank<span class="hljs-punctuation">,</span> levels <span class="hljs-operator">=</span> rank<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  ggplot<span class="hljs-punctuation">(</span>aes<span class="hljs-punctuation">(</span>rank<span class="hljs-punctuation">,</span> proportionBC<span class="hljs-punctuation">,</span> color <span class="hljs-operator">=</span> col<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_point<span class="hljs-punctuation">(</span>size <span class="hljs-operator">=</span> <span class="hljs-number">2</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_vline<span class="hljs-punctuation">(</span>xintercept <span class="hljs-operator">=</span> elbow<span class="hljs-punctuation">,</span> lty <span class="hljs-operator">=</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span> col <span class="hljs-operator">=</span> <span class="hljs-string">"red"</span><span class="hljs-punctuation">,</span> cex <span class="hljs-operator">=</span> <span class="hljs-number">.5</span><span class="hljs-punctuation">,</span> linewidth <span class="hljs-operator">=</span> <span class="hljs-number">1</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_vline<span class="hljs-punctuation">(</span>xintercept <span class="hljs-operator">=</span> lastCall<span class="hljs-punctuation">,</span> lty <span class="hljs-operator">=</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span> col <span class="hljs-operator">=</span> <span class="hljs-string">"blue"</span><span class="hljs-punctuation">,</span> cex <span class="hljs-operator">=</span> <span class="hljs-number">.5</span><span class="hljs-punctuation">,</span> linewidth <span class="hljs-operator">=</span> <span class="hljs-number">1</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  annotate<span class="hljs-punctuation">(</span><br>    geom <span class="hljs-operator">=</span> <span class="hljs-string">"text"</span><span class="hljs-punctuation">,</span> x <span class="hljs-operator">=</span> elbow <span class="hljs-operator">+</span> <span class="hljs-number">14</span><span class="hljs-punctuation">,</span> y <span class="hljs-operator">=</span> <span class="hljs-number">.1</span><span class="hljs-punctuation">,</span><br>    label <span class="hljs-operator">=</span> paste<span class="hljs-punctuation">(</span><span class="hljs-string">"Elbow method"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">" ("</span><span class="hljs-punctuation">,</span> elbow<span class="hljs-punctuation">,</span> <span class="hljs-string">")"</span><span class="hljs-punctuation">,</span> sep <span class="hljs-operator">=</span> <span class="hljs-string">""</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> color <span class="hljs-operator">=</span> <span class="hljs-string">"red"</span><br>  <span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  annotate<span class="hljs-punctuation">(</span><br>    geom <span class="hljs-operator">=</span> <span class="hljs-string">"text"</span><span class="hljs-punctuation">,</span> x <span class="hljs-operator">=</span> lastCall <span class="hljs-operator">+</span> <span class="hljs-number">15</span><span class="hljs-punctuation">,</span> y <span class="hljs-operator">=</span> <span class="hljs-number">.5</span><span class="hljs-punctuation">,</span><br>    label <span class="hljs-operator">=</span> paste<span class="hljs-punctuation">(</span><span class="hljs-string">"Last 2% increase ("</span><span class="hljs-punctuation">,</span> lastCall<span class="hljs-punctuation">,</span> <span class="hljs-string">")"</span><span class="hljs-punctuation">,</span> sep <span class="hljs-operator">=</span> <span class="hljs-string">""</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> color <span class="hljs-operator">=</span> <span class="hljs-string">"blue"</span><br>  <span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  scale_y_continuous<span class="hljs-punctuation">(</span><br>    limits <span class="hljs-operator">=</span> <span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-number">1</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>    breaks <span class="hljs-operator">=</span> seq<span class="hljs-punctuation">(</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span> <span class="hljs-number">0.1</span><span class="hljs-punctuation">)</span><br>  <span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  labs<span class="hljs-punctuation">(</span>x <span class="hljs-operator">=</span> <span class="hljs-string">"ranked OTUs"</span><span class="hljs-punctuation">,</span> y <span class="hljs-operator">=</span> <span class="hljs-string">"Bray-Curtis similarity"</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  scale_color_aaas<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  pac4xiang<span class="hljs-operator">::</span>mytheme<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  theme<span class="hljs-punctuation">(</span><br>    panel.grid.major <span class="hljs-operator">=</span> element_blank<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>    panel.grid.minor <span class="hljs-operator">=</span> element_blank<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>    strip.background <span class="hljs-operator">=</span> element_blank<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>    axis.text.x <span class="hljs-operator">=</span> element_blank<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>    axis.ticks.x <span class="hljs-operator">=</span> element_blank<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>    legend.position <span class="hljs-operator">=</span> <span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-number">0.8</span><span class="hljs-punctuation">,</span> <span class="hljs-number">0.2</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>    legend.title <span class="hljs-operator">=</span> element_blank<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>    legend.text <span class="hljs-operator">=</span> element_text<span class="hljs-punctuation">(</span>size <span class="hljs-operator">=</span> <span class="hljs-number">20</span><span class="hljs-punctuation">)</span><br>  <span class="hljs-punctuation">)</span><br><br>ggsave<span class="hljs-punctuation">(</span>file <span class="hljs-operator">=</span> <span class="hljs-string">"rankedOTUs.png"</span><span class="hljs-punctuation">,</span> width <span class="hljs-operator">=</span> <span class="hljs-number">8</span><span class="hljs-punctuation">,</span> height <span class="hljs-operator">=</span> <span class="hljs-number">6</span><span class="hljs-punctuation">,</span> dpi <span class="hljs-operator">=</span> <span class="hljs-number">500</span><span class="hljs-punctuation">)</span><br><br><br><span class="hljs-comment"># 另外一种展示方式</span><br><span class="hljs-comment"># 基于中性模型</span><br><span class="hljs-comment"># Use Sloan neutral model to prioritize OTUs</span><br><span class="hljs-comment"># Fitting neutral model (Burns et al., 2016 (ISME J) - functions are in the sncm.fit.R)</span><br>spp <span class="hljs-operator">&lt;-</span> t<span class="hljs-punctuation">(</span>df.otu<span class="hljs-punctuation">)</span><br>taxon <span class="hljs-operator">&lt;-</span> as.vector<span class="hljs-punctuation">(</span>rownames<span class="hljs-punctuation">(</span>df.otu<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br><br><span class="hljs-comment"># Models for the whole community</span><br>obs.np <span class="hljs-operator">&lt;-</span> sncm.fit<span class="hljs-punctuation">(</span>spp<span class="hljs-punctuation">,</span> taxon<span class="hljs-punctuation">,</span> stats <span class="hljs-operator">=</span> <span class="hljs-literal">FALSE</span><span class="hljs-punctuation">,</span> pool <span class="hljs-operator">=</span> <span class="hljs-literal">NULL</span><span class="hljs-punctuation">)</span><br>sta.np <span class="hljs-operator">&lt;-</span> sncm.fit<span class="hljs-punctuation">(</span>spp<span class="hljs-punctuation">,</span> taxon<span class="hljs-punctuation">,</span> stats <span class="hljs-operator">=</span> <span class="hljs-literal">TRUE</span><span class="hljs-punctuation">,</span> pool <span class="hljs-operator">=</span> <span class="hljs-literal">NULL</span><span class="hljs-punctuation">)</span><br><br>above.pred <span class="hljs-operator">&lt;-</span> <span class="hljs-built_in">sum</span><span class="hljs-punctuation">(</span>obs.np<span class="hljs-operator">$</span>freq <span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">(</span>obs.np<span class="hljs-operator">$</span>pred.upr<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> na.rm <span class="hljs-operator">=</span> <span class="hljs-literal">TRUE</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">/</span> sta.np<span class="hljs-operator">$</span>Richness <span class="hljs-comment"># fraction of OTUs above prediction</span><br>below.pred <span class="hljs-operator">&lt;-</span> <span class="hljs-built_in">sum</span><span class="hljs-punctuation">(</span>obs.np<span class="hljs-operator">$</span>freq <span class="hljs-operator">&lt;</span> <span class="hljs-punctuation">(</span>obs.np<span class="hljs-operator">$</span>pred.lwr<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> na.rm <span class="hljs-operator">=</span> <span class="hljs-literal">TRUE</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">/</span> sta.np<span class="hljs-operator">$</span>Richness <span class="hljs-comment"># fraction of OTUs below prediction</span><br><br><span class="hljs-comment"># Create a column defining "core" OTUs</span><br>df.otu.new <span class="hljs-operator">%&gt;%</span><br>  dplyr<span class="hljs-operator">::</span>mutate<span class="hljs-punctuation">(</span>fill <span class="hljs-operator">=</span> case_when<span class="hljs-punctuation">(</span><br>    otu <span class="hljs-operator">%in%</span> otu.ranked<span class="hljs-operator">$</span>otu<span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-operator">:</span>lastCall<span class="hljs-punctuation">]</span> <span class="hljs-operator">~</span> <span class="hljs-string">"Core"</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-literal">TRUE</span> <span class="hljs-operator">~</span> <span class="hljs-string">"Non-core"</span><br>  <span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  dplyr<span class="hljs-operator">::</span>select<span class="hljs-punctuation">(</span>otu.rel<span class="hljs-punctuation">,</span> otu.occ<span class="hljs-punctuation">,</span> fill<span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  dplyr<span class="hljs-operator">::</span>distinct_all<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  ggplot<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_point<span class="hljs-punctuation">(</span>aes<span class="hljs-punctuation">(</span>log10<span class="hljs-punctuation">(</span>otu.rel<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> otu.occ<span class="hljs-punctuation">,</span> color <span class="hljs-operator">=</span> fill<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> size <span class="hljs-operator">=</span> <span class="hljs-number">4</span><span class="hljs-punctuation">,</span> alpha <span class="hljs-operator">=</span> <span class="hljs-number">0.8</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_line<span class="hljs-punctuation">(</span><br>    color <span class="hljs-operator">=</span> <span class="hljs-string">"black"</span><span class="hljs-punctuation">,</span> data <span class="hljs-operator">=</span> obs.np<span class="hljs-punctuation">,</span> size <span class="hljs-operator">=</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>    aes<span class="hljs-punctuation">(</span>y <span class="hljs-operator">=</span> obs.np<span class="hljs-operator">$</span>freq.pred<span class="hljs-punctuation">,</span> x <span class="hljs-operator">=</span> log10<span class="hljs-punctuation">(</span>obs.np<span class="hljs-operator">$</span>p<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> alpha <span class="hljs-operator">=</span> <span class="hljs-number">.25</span><br>  <span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_line<span class="hljs-punctuation">(</span><br>    color <span class="hljs-operator">=</span> <span class="hljs-string">"black"</span><span class="hljs-punctuation">,</span> lty <span class="hljs-operator">=</span> <span class="hljs-string">"twodash"</span><span class="hljs-punctuation">,</span> size <span class="hljs-operator">=</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span> data <span class="hljs-operator">=</span> obs.np<span class="hljs-punctuation">,</span><br>    aes<span class="hljs-punctuation">(</span>y <span class="hljs-operator">=</span> obs.np<span class="hljs-operator">$</span>pred.upr<span class="hljs-punctuation">,</span> x <span class="hljs-operator">=</span> log10<span class="hljs-punctuation">(</span>obs.np<span class="hljs-operator">$</span>p<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> alpha <span class="hljs-operator">=</span> <span class="hljs-number">.25</span><br>  <span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_line<span class="hljs-punctuation">(</span><br>    color <span class="hljs-operator">=</span> <span class="hljs-string">"black"</span><span class="hljs-punctuation">,</span> lty <span class="hljs-operator">=</span> <span class="hljs-string">"twodash"</span><span class="hljs-punctuation">,</span> size <span class="hljs-operator">=</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span> data <span class="hljs-operator">=</span> obs.np<span class="hljs-punctuation">,</span><br>    aes<span class="hljs-punctuation">(</span>y <span class="hljs-operator">=</span> obs.np<span class="hljs-operator">$</span>pred.lwr<span class="hljs-punctuation">,</span> x <span class="hljs-operator">=</span> log10<span class="hljs-punctuation">(</span>obs.np<span class="hljs-operator">$</span>p<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> alpha <span class="hljs-operator">=</span> <span class="hljs-number">.25</span><br>  <span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  labs<span class="hljs-punctuation">(</span>x <span class="hljs-operator">=</span> <span class="hljs-string">"log10(mean relative abundance)"</span><span class="hljs-punctuation">,</span> y <span class="hljs-operator">=</span> <span class="hljs-string">"Occupancy"</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  scale_y_continuous<span class="hljs-punctuation">(</span><br>    limits <span class="hljs-operator">=</span> <span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-number">1</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>    breaks <span class="hljs-operator">=</span> seq<span class="hljs-punctuation">(</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span> <span class="hljs-number">0.1</span><span class="hljs-punctuation">)</span><br>  <span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  scale_color_aaas<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  pac4xiang<span class="hljs-operator">::</span>mytheme<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  theme<span class="hljs-punctuation">(</span><br>    panel.grid.major <span class="hljs-operator">=</span> element_blank<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>    panel.grid.minor <span class="hljs-operator">=</span> element_blank<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>    strip.background <span class="hljs-operator">=</span> element_blank<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>    legend.position <span class="hljs-operator">=</span> <span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-number">0.2</span><span class="hljs-punctuation">,</span> <span class="hljs-number">0.8</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>    legend.title <span class="hljs-operator">=</span> element_blank<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>    legend.text <span class="hljs-operator">=</span> element_text<span class="hljs-punctuation">(</span>size <span class="hljs-operator">=</span> <span class="hljs-number">20</span><span class="hljs-punctuation">)</span><br>  <span class="hljs-punctuation">)</span><br>ggsave<span class="hljs-punctuation">(</span>file <span class="hljs-operator">=</span> <span class="hljs-string">"results.png"</span><span class="hljs-punctuation">,</span> width <span class="hljs-operator">=</span> <span class="hljs-number">8</span><span class="hljs-punctuation">,</span> height <span class="hljs-operator">=</span> <span class="hljs-number">6</span><span class="hljs-punctuation">,</span> dpi <span class="hljs-operator">=</span> <span class="hljs-number">500</span><span class="hljs-punctuation">)</span><br><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202306081140194.png" srcset="/img/loading.gif" lazyload alt="rankedOTUs"></p>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202306081140602.png" srcset="/img/loading.gif" lazyload alt="results"></p>
<p>写了个函数：</p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs R">source<span class="hljs-punctuation">(</span><span class="hljs-string">"D:/MyData/Program/pac4xiang/R/getCoreMicrobiome.R"</span><span class="hljs-punctuation">)</span><br>source<span class="hljs-punctuation">(</span><span class="hljs-string">"D:/MyData/Program/pac4xiang/R/mytheme.R"</span><span class="hljs-punctuation">)</span><br><br>df.otu <span class="hljs-operator">&lt;-</span> readr<span class="hljs-operator">::</span>read_rds<span class="hljs-punctuation">(</span><span class="hljs-string">"./data/switchgrassOTUtable.rds"</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  as.data.frame<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br><br>df.meta <span class="hljs-operator">&lt;-</span> readr<span class="hljs-operator">::</span>read_rds<span class="hljs-punctuation">(</span><span class="hljs-string">"./data/switchgrassMAPtable.rds"</span><span class="hljs-punctuation">)</span><br><br>lx <span class="hljs-operator">=</span> getCoreMicrobiome<span class="hljs-punctuation">(</span>otu <span class="hljs-operator">=</span> df.otu<span class="hljs-punctuation">,</span><br>                       meta <span class="hljs-operator">=</span> df.meta<span class="hljs-punctuation">,</span><br>                       sample.name <span class="hljs-operator">=</span> <span class="hljs-string">"sequence_name"</span><span class="hljs-punctuation">,</span><br>                       group <span class="hljs-operator">=</span> <span class="hljs-string">"sampling_date"</span><span class="hljs-punctuation">,</span><br>                       top <span class="hljs-operator">=</span> <span class="hljs-number">500</span><span class="hljs-punctuation">)</span><br><br><span class="hljs-comment"># 排序图</span><br>lx<span class="hljs-operator">$</span>df.rankedOTUs <span class="hljs-operator">%&gt;%</span> <br>  ggplot<span class="hljs-punctuation">(</span>aes<span class="hljs-punctuation">(</span>rank<span class="hljs-punctuation">,</span> proportionBC<span class="hljs-punctuation">,</span> color <span class="hljs-operator">=</span> col<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_point<span class="hljs-punctuation">(</span>size <span class="hljs-operator">=</span> <span class="hljs-number">2</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_vline<span class="hljs-punctuation">(</span>xintercept <span class="hljs-operator">=</span> lx<span class="hljs-operator">$</span>elbow<span class="hljs-punctuation">,</span> lty <span class="hljs-operator">=</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span> col <span class="hljs-operator">=</span> <span class="hljs-string">"red"</span><span class="hljs-punctuation">,</span> cex <span class="hljs-operator">=</span> <span class="hljs-number">.5</span><span class="hljs-punctuation">,</span> linewidth <span class="hljs-operator">=</span> <span class="hljs-number">1</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_vline<span class="hljs-punctuation">(</span>xintercept <span class="hljs-operator">=</span> lx<span class="hljs-operator">$</span>lastCall<span class="hljs-punctuation">,</span> lty <span class="hljs-operator">=</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span> col <span class="hljs-operator">=</span> <span class="hljs-string">"blue"</span><span class="hljs-punctuation">,</span> cex <span class="hljs-operator">=</span> <span class="hljs-number">.5</span><span class="hljs-punctuation">,</span> linewidth <span class="hljs-operator">=</span> <span class="hljs-number">1</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  annotate<span class="hljs-punctuation">(</span><br>    geom <span class="hljs-operator">=</span> <span class="hljs-string">"text"</span><span class="hljs-punctuation">,</span> x <span class="hljs-operator">=</span> lx<span class="hljs-operator">$</span>elbow <span class="hljs-operator">+</span> <span class="hljs-number">14</span><span class="hljs-punctuation">,</span> y <span class="hljs-operator">=</span> <span class="hljs-number">.1</span><span class="hljs-punctuation">,</span><br>    label <span class="hljs-operator">=</span> paste<span class="hljs-punctuation">(</span><span class="hljs-string">"Elbow method"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">" ("</span><span class="hljs-punctuation">,</span> lx<span class="hljs-operator">$</span>elbow<span class="hljs-punctuation">,</span> <span class="hljs-string">")"</span><span class="hljs-punctuation">,</span> sep <span class="hljs-operator">=</span> <span class="hljs-string">""</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> color <span class="hljs-operator">=</span> <span class="hljs-string">"red"</span><br>  <span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  annotate<span class="hljs-punctuation">(</span><br>    geom <span class="hljs-operator">=</span> <span class="hljs-string">"text"</span><span class="hljs-punctuation">,</span> x <span class="hljs-operator">=</span> lx<span class="hljs-operator">$</span>lastCall <span class="hljs-operator">+</span> <span class="hljs-number">15</span><span class="hljs-punctuation">,</span> y <span class="hljs-operator">=</span> <span class="hljs-number">.5</span><span class="hljs-punctuation">,</span><br>    label <span class="hljs-operator">=</span> paste<span class="hljs-punctuation">(</span><span class="hljs-string">"Last 2% increase ("</span><span class="hljs-punctuation">,</span> lx<span class="hljs-operator">$</span>lastCall<span class="hljs-punctuation">,</span> <span class="hljs-string">")"</span><span class="hljs-punctuation">,</span> sep <span class="hljs-operator">=</span> <span class="hljs-string">""</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> color <span class="hljs-operator">=</span> <span class="hljs-string">"blue"</span><br>  <span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  scale_y_continuous<span class="hljs-punctuation">(</span><br>    limits <span class="hljs-operator">=</span> <span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-number">1</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>    breaks <span class="hljs-operator">=</span> seq<span class="hljs-punctuation">(</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span> <span class="hljs-number">0.1</span><span class="hljs-punctuation">)</span><br>  <span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  labs<span class="hljs-punctuation">(</span>x <span class="hljs-operator">=</span> <span class="hljs-string">"ranked OTUs"</span><span class="hljs-punctuation">,</span> y <span class="hljs-operator">=</span> <span class="hljs-string">"Bray-Curtis similarity"</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  scale_color_aaas<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  mytheme<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  theme<span class="hljs-punctuation">(</span><br>    panel.grid.major <span class="hljs-operator">=</span> element_blank<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>    panel.grid.minor <span class="hljs-operator">=</span> element_blank<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>    strip.background <span class="hljs-operator">=</span> element_blank<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>    axis.text.x <span class="hljs-operator">=</span> element_blank<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>    axis.ticks.x <span class="hljs-operator">=</span> element_blank<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>    legend.position <span class="hljs-operator">=</span> <span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-number">0.8</span><span class="hljs-punctuation">,</span> <span class="hljs-number">0.2</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>    legend.title <span class="hljs-operator">=</span> element_blank<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>    legend.text <span class="hljs-operator">=</span> element_text<span class="hljs-punctuation">(</span>size <span class="hljs-operator">=</span> <span class="hljs-number">20</span><span class="hljs-punctuation">)</span><br>  <span class="hljs-punctuation">)</span><br><br><br><span class="hljs-comment"># 拟合图</span><br>obs.np <span class="hljs-operator">=</span> lx<span class="hljs-operator">$</span>obs.np<br><br>lx<span class="hljs-operator">$</span>df.fitting.results <span class="hljs-operator">%&gt;%</span> <br>ggplot<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_point<span class="hljs-punctuation">(</span>aes<span class="hljs-punctuation">(</span>log10<span class="hljs-punctuation">(</span>otu.rel<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> otu.occ<span class="hljs-punctuation">,</span> color <span class="hljs-operator">=</span> fill<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> size <span class="hljs-operator">=</span> <span class="hljs-number">4</span><span class="hljs-punctuation">,</span> alpha <span class="hljs-operator">=</span> <span class="hljs-number">0.8</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_line<span class="hljs-punctuation">(</span><br>    color <span class="hljs-operator">=</span> <span class="hljs-string">"black"</span><span class="hljs-punctuation">,</span> data <span class="hljs-operator">=</span> obs.np<span class="hljs-punctuation">,</span> size <span class="hljs-operator">=</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>    aes<span class="hljs-punctuation">(</span>y <span class="hljs-operator">=</span> obs.np<span class="hljs-operator">$</span>freq.pred<span class="hljs-punctuation">,</span> x <span class="hljs-operator">=</span> log10<span class="hljs-punctuation">(</span>obs.np<span class="hljs-operator">$</span>p<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> alpha <span class="hljs-operator">=</span> <span class="hljs-number">.25</span><br>  <span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_line<span class="hljs-punctuation">(</span><br>    color <span class="hljs-operator">=</span> <span class="hljs-string">"black"</span><span class="hljs-punctuation">,</span> lty <span class="hljs-operator">=</span> <span class="hljs-string">"twodash"</span><span class="hljs-punctuation">,</span> size <span class="hljs-operator">=</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span> data <span class="hljs-operator">=</span> obs.np<span class="hljs-punctuation">,</span><br>    aes<span class="hljs-punctuation">(</span>y <span class="hljs-operator">=</span> obs.np<span class="hljs-operator">$</span>pred.upr<span class="hljs-punctuation">,</span> x <span class="hljs-operator">=</span> log10<span class="hljs-punctuation">(</span>obs.np<span class="hljs-operator">$</span>p<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> alpha <span class="hljs-operator">=</span> <span class="hljs-number">.25</span><br>  <span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_line<span class="hljs-punctuation">(</span><br>    color <span class="hljs-operator">=</span> <span class="hljs-string">"black"</span><span class="hljs-punctuation">,</span> lty <span class="hljs-operator">=</span> <span class="hljs-string">"twodash"</span><span class="hljs-punctuation">,</span> size <span class="hljs-operator">=</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span> data <span class="hljs-operator">=</span> obs.np<span class="hljs-punctuation">,</span><br>    aes<span class="hljs-punctuation">(</span>y <span class="hljs-operator">=</span> obs.np<span class="hljs-operator">$</span>pred.lwr<span class="hljs-punctuation">,</span> x <span class="hljs-operator">=</span> log10<span class="hljs-punctuation">(</span>obs.np<span class="hljs-operator">$</span>p<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> alpha <span class="hljs-operator">=</span> <span class="hljs-number">.25</span><br>  <span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  labs<span class="hljs-punctuation">(</span>x <span class="hljs-operator">=</span> <span class="hljs-string">"log10(mean relative abundance)"</span><span class="hljs-punctuation">,</span> y <span class="hljs-operator">=</span> <span class="hljs-string">"Occupancy"</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  scale_y_continuous<span class="hljs-punctuation">(</span><br>    limits <span class="hljs-operator">=</span> <span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-number">1</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>    breaks <span class="hljs-operator">=</span> seq<span class="hljs-punctuation">(</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span> <span class="hljs-number">0.1</span><span class="hljs-punctuation">)</span><br>  <span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  scale_color_aaas<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  mytheme<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  theme<span class="hljs-punctuation">(</span><br>    panel.grid.major <span class="hljs-operator">=</span> element_blank<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>    panel.grid.minor <span class="hljs-operator">=</span> element_blank<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>    strip.background <span class="hljs-operator">=</span> element_blank<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>    legend.position <span class="hljs-operator">=</span> <span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-number">0.2</span><span class="hljs-punctuation">,</span> <span class="hljs-number">0.8</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>    legend.title <span class="hljs-operator">=</span> element_blank<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>    legend.text <span class="hljs-operator">=</span> element_text<span class="hljs-punctuation">(</span>size <span class="hljs-operator">=</span> <span class="hljs-number">20</span><span class="hljs-punctuation">)</span><br>  <span class="hljs-punctuation">)</span><br><br></code></pre></td></tr></tbody></table></figure>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF%E5%AD%A6/" class="category-chain-item">生物信息学</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF%E5%AD%A6/" class="print-no-link">#生物信息学</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>一种核心微生物的鉴定方法</div>
      <div>https://lixiang117423.github.io/article/coremicrobiome/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>李详【Xiang LI】</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2023年6月8日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/article/metaphlan4/" title="MetaPhlAn4宏基因组数据分析流程学习笔记">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">MetaPhlAn4宏基因组数据分析流程学习笔记</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/article/rstudoserverploterror/" title="Rstudio-server绘图报错">
                        <span class="hidden-mobile">Rstudio-server绘图报错</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
    <!-- 备案信息 ICP for China -->
    <div class="beian">
  <span>
    <a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">
      滇ICP备2021000708号-4
    </a>
  </span>
  
</div>

  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    
      <script  src="/js/img-lazyload.js" ></script>
    
  




  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
