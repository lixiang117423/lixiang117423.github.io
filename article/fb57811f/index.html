

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="小蓝哥">
  <meta name="keywords" content="">
  <meta name="google-site-verification" content="W0bd7QAXqv4_2p37UlvKzRbXgPQWZun5DbrUuQtdSI4">
  
    <meta name="description" content="写在前面Y叔的ggtree $^{[1]}$ 毫无疑问是当前绘制美化系统发育树（下文简称进化树）的最佳工具，一直想学习，但是都没有真真正正学习过，一是因为网上关于gtree的中文资源较少，另外一个原因是感觉到自己用不上，就没认真学习。春节在家，实在无聊，下定决心学一遍ggtree。下面的内容来自Y叔的博客$^{[2]}$ ，若有不当之处，恳请批评指正。 关于进化树进化树怎么看进化树展示的是进化关系">
<meta property="og:type" content="article">
<meta property="og:title" content="ggtree学习笔记">
<meta property="og:url" content="https://lixiang117423.github.io/article/fb57811f/index.html">
<meta property="og:site_name" content="小蓝哥的知识荒原">
<meta property="og:description" content="写在前面Y叔的ggtree $^{[1]}$ 毫无疑问是当前绘制美化系统发育树（下文简称进化树）的最佳工具，一直想学习，但是都没有真真正正学习过，一是因为网上关于gtree的中文资源较少，另外一个原因是感觉到自己用不上，就没认真学习。春节在家，实在无聊，下定决心学一遍ggtree。下面的内容来自Y叔的博客$^{[2]}$ ，若有不当之处，恳请批评指正。 关于进化树进化树怎么看进化树展示的是进化关系">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071517854.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071515615.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071517024.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071517116.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071517688.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071517669.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071518040.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071518343.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071518019.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071518696.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071518111.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071518520.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071518765.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071518191.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071518168.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071518452.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071518454.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071518270.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071518888.png">
<meta property="og:image" content="https://lixiang117423.github.io/article/fb57811f/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/19.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071519612.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071519537.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071519693.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071519795.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071519411.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071519108.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071519298.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071519968.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071519933.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071519773.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071519919.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071519551.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071519474.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071519203.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071520792.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071520761.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071520383.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071520979.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071520310.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071520498.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071520554.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071520705.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071520744.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071520908.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071520371.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071520415.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071520969.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071520333.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071520974.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071520220.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071520608.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071520293.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071521102.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071521792.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071521274.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071521726.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071521756.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071521771.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071521044.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071521659.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071521711.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071521751.png">
<meta property="og:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071521939.png">
<meta property="article:published_time" content="2021-02-15T02:35:58.000Z">
<meta property="article:modified_time" content="2025-11-14T08:27:55.593Z">
<meta property="article:author" content="小蓝哥">
<meta property="article:tag" content="R语言">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071517854.png">
  
  
  
  <title>ggtree学习笔记 - 小蓝哥的知识荒原</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"lixiang117423.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":true,"offset_factor":3},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="小蓝哥的知识荒原" type="application/atom+xml">
</head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>小蓝哥的知识荒原</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://bing.biturl.top/?resolution=1920&format=image&index=0&mkt=zh-CN') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="ggtree学习笔记"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2021-02-15 10:35" pubdate>
          2021年2月15日 上午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          9k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          75 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">ggtree学习笔记</h1>
            
            
              <div class="markdown-body">
                
                <h2 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h2><p>Y叔的ggtree $^{[1]}$ 毫无疑问是当前绘制美化系统发育树（下文简称<code>进化树</code>）的最佳工具，一直想学习，但是都没有真真正正学习过，一是因为网上关于<code>gtree</code>的中文资源较少，另外一个原因是感觉到自己用不上，就没认真学习。春节在家，实在无聊，下定决心学一遍<code>ggtree</code>。下面的内容来自Y叔的博客$^{[2]}$ ，若有不当之处，恳请批评指正。</p>
<h2 id="关于进化树"><a href="#关于进化树" class="headerlink" title="关于进化树"></a>关于进化树</h2><h3 id="进化树怎么看"><a href="#进化树怎么看" class="headerlink" title="进化树怎么看"></a>进化树怎么看</h3><p>进化树展示的是进化关系，简单说就是亲缘关系，通常是使用物种的遗传序列（如DNA序列、氨基酸序列等）来构建的。进化树看起来和层次聚类很像，这两者有木有区别呢？Y叔在<code>统计之都</code>上的文章$^{[3]}$ 是这样描述的：</p>
<blockquote>
<p>层次聚类的侧重点在于分类，把距离近的聚在一起。而进化树的构建可以说也是一个聚类过程，但侧重点在于推测进化关系和进化距离 (evolutionary distance)。</p>
</blockquote>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071517854.png" srcset="/img/loading.gif" lazyload alt=""></p>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071515615.png" srcset="/img/loading.gif" lazyload alt=""></p>
<p>上图展示的是典型的系统发育树。图中绿色、蓝色和红色的点都是<code>nodes</code>，也就是节点（个人理解），其中最外层绿色的点表示的是每个<code>sample</code>，这时绿色的点也叫<code>tips</code>；蓝色的点表示的是<code>父节点</code>，也就是从外往内两两<code>sample</code>的共有节点，可以理解成<code>祖先（ancestor）</code>，祖先之间还可以继续往上溯源，最终就汇集到红色的点，这个红色的点也就是<code>root</code>，需要注意的是有根树才具有<code>root</code>节点；横线叫做<code>分支(branches)</code>，这些横线表示的是进化变化（evolutionary changes），线的长短表示的是以时间或遗传变异为单位的进化变化。</p>
<h3 id="进化树数据格式"><a href="#进化树数据格式" class="headerlink" title="进化树数据格式"></a>进化树数据格式</h3><p>进化树的数据格式有多种，常见的有<code>Newick</code>、<code>NEXUS</code>及<code>Phylip</code>。</p>
<h4 id="Newick格式"><a href="#Newick格式" class="headerlink" title="Newick格式"></a>Newick格式</h4><p><code>Newick</code>格式是最常见的使用最广泛的进化树数据格式。</p>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071517024.png" srcset="/img/loading.gif" lazyload alt=""></p>
<p>上图是一个标准的进化树图，其对应的<code>Newick</code>格式为：</p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs R"><span class="hljs-punctuation">(</span><span class="hljs-punctuation">(</span>t2<span class="hljs-operator">:</span><span class="hljs-number">0.04</span><span class="hljs-punctuation">,</span>t1<span class="hljs-operator">:</span><span class="hljs-number">0.34</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span><span class="hljs-number">0.89</span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">(</span>t5<span class="hljs-operator">:</span><span class="hljs-number">0.37</span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">(</span>t4<span class="hljs-operator">:</span><span class="hljs-number">0.03</span><span class="hljs-punctuation">,</span>t3<span class="hljs-operator">:</span><span class="hljs-number">0.67</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span><span class="hljs-number">0.9</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span><span class="hljs-number">0.59</span><span class="hljs-punctuation">)</span>; <br></code></pre></td></tr></tbody></table></figure>
<p>数据格式和图是一一对应的，假如我们看图的时候是从外到内，那<code>t3</code>和<code>t4</code>是最近的，在数据中，<code>t3</code>和<code>t4</code>也是在一个括号里面的，数据的最小单位是一对<code>()</code>，就像剥洋葱那样顺着括号一层一层往外剥的时候，就能得到上图的那种样式。冒号后面对应的是横线上的“距离”，父节点的“距离”是两个“子节点”共有的，因此，需要表示“父节点”的“距离”时，需要将“距离”放在“子节点“的括号外。</p>
<h4 id="NEXUS格式"><a href="#NEXUS格式" class="headerlink" title="NEXUS格式"></a>NEXUS格式</h4><p><code>NEXUS</code>格式是<code>Newick</code>格式的拓展，以<code>blocks</code>为单位将进化树的元素分开。</p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs R"><span class="hljs-comment">#NEXUS</span><br><span class="hljs-punctuation">[</span>R<span class="hljs-operator">-</span>package APE<span class="hljs-punctuation">,</span> Wed Nov  <span class="hljs-number">9</span> <span class="hljs-number">11</span><span class="hljs-operator">:</span><span class="hljs-number">46</span><span class="hljs-operator">:</span><span class="hljs-number">32</span> <span class="hljs-number">2016</span><span class="hljs-punctuation">]</span><br><br>BEGIN TAXA;<br>    DIMENSIONS NTAX <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;<br>    TAXLABELS<br>        t5<br>        t4<br>        t1<br>        t2<br>        t3<br>    ;<br>END;<br>BEGIN TREES;<br>    TRANSLATE<br>        <span class="hljs-number">1</span>   t5<span class="hljs-punctuation">,</span><br>        <span class="hljs-number">2</span>   t4<span class="hljs-punctuation">,</span><br>        <span class="hljs-number">3</span>   t1<span class="hljs-punctuation">,</span><br>        <span class="hljs-number">4</span>   t2<span class="hljs-punctuation">,</span><br>        <span class="hljs-number">5</span>   t3<br>    ;<br>    TREE <span class="hljs-operator">*</span> UNTITLED <span class="hljs-operator">=</span> <span class="hljs-punctuation">[</span><span class="hljs-operator">&amp;</span>R<span class="hljs-punctuation">]</span> <span class="hljs-punctuation">(</span><span class="hljs-number">1</span><span class="hljs-operator">:</span><span class="hljs-number">0.89</span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">(</span><span class="hljs-punctuation">(</span><span class="hljs-number">2</span><span class="hljs-operator">:</span><span class="hljs-number">0.59</span><span class="hljs-punctuation">,</span><span class="hljs-number">3</span><span class="hljs-operator">:</span><span class="hljs-number">0.37</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span><span class="hljs-number">0.34</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">(</span><span class="hljs-number">4</span><span class="hljs-operator">:</span><span class="hljs-number">0.03</span><span class="hljs-punctuation">,</span><span class="hljs-number">5</span><span class="hljs-operator">:</span><span class="hljs-number">0.67</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span><span class="hljs-number">0.9</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span><span class="hljs-number">0.04</span><span class="hljs-punctuation">)</span>;<br>END;<br></code></pre></td></tr></tbody></table></figure>
<h4 id="其他格式"><a href="#其他格式" class="headerlink" title="其他格式"></a>其他格式</h4><p>进化树的存储格式还有很多种，更多请参照Y叔的博客$^{[4]}$。</p>
<h2 id="进化树数据处理"><a href="#进化树数据处理" class="headerlink" title="进化树数据处理"></a>进化树数据处理</h2><p>进化树数据可以使用<code>treeio</code>$^{[5]}$ 这个包进行合并等操作，然后可以将其他信息利用<code>tidytree</code>$^{[6]}$ 这个包将树文件转换成R里面常见的数据框格式，这种格式也可以再次转化成树文件，利用<code>ggtree</code>进行可视化。</p>
<h3 id="phylo对象"><a href="#phylo对象" class="headerlink" title="phylo对象"></a><code>phylo</code>对象</h3><p><code>phylo</code>格式是R包<code>ape</code>支持的格式，在R中的很多包都依赖于这种格式。<code>tidytree</code>中的函数<code>as_tibble</code>可以将<code>phylo</code>转换成数据框，此时的数据框是个<code>tbl_tree</code>对象。</p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs R">library<span class="hljs-punctuation">(</span>ggtree<span class="hljs-punctuation">)</span><br>library<span class="hljs-punctuation">(</span>ape<span class="hljs-punctuation">)</span><br><br>set.seed<span class="hljs-punctuation">(</span><span class="hljs-number">2017</span><span class="hljs-punctuation">)</span><br>tree <span class="hljs-operator">&lt;-</span> rtree<span class="hljs-punctuation">(</span><span class="hljs-number">4</span><span class="hljs-punctuation">)</span><br>tree<br></code></pre></td></tr></tbody></table></figure>
<p>此时得到的是<code>phylo</code>对象：</p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs R"><span class="hljs-comment">## </span><br><span class="hljs-comment">## Phylogenetic tree with 4 tips and 3 internal nodes.</span><br><span class="hljs-comment">## </span><br><span class="hljs-comment">## Tip labels:</span><br><span class="hljs-comment">##   t4, t1, t3, t2</span><br><span class="hljs-comment">## </span><br><span class="hljs-comment">## Rooted; includes branch lengths.</span><br></code></pre></td></tr></tbody></table></figure>
<p>现在将其转化成数据框：</p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs R">library<span class="hljs-punctuation">(</span>tidytree<span class="hljs-punctuation">)</span><br>x <span class="hljs-operator">&lt;-</span> as_tibble<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">)</span><br>x<br></code></pre></td></tr></tbody></table></figure>
<figure class="highlight clean"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs clean">## # A tibble: <span class="hljs-number">7</span> x <span class="hljs-number">4</span><br>##   parent  node branch.length label<br>##    &lt;int&gt; &lt;int&gt;         &lt;dbl&gt; &lt;chr&gt;<br>## <span class="hljs-number">1</span>      <span class="hljs-number">5</span>     <span class="hljs-number">1</span>       <span class="hljs-number">0.435</span>   t4   <br>## <span class="hljs-number">2</span>      <span class="hljs-number">7</span>     <span class="hljs-number">2</span>       <span class="hljs-number">0.674</span>   t1   <br>## <span class="hljs-number">3</span>      <span class="hljs-number">7</span>     <span class="hljs-number">3</span>       <span class="hljs-number">0.00202</span> t3   <br>## <span class="hljs-number">4</span>      <span class="hljs-number">6</span>     <span class="hljs-number">4</span>       <span class="hljs-number">0.0251</span>  t2   <br>## <span class="hljs-number">5</span>      <span class="hljs-number">5</span>     <span class="hljs-number">5</span>      NA       &lt;NA&gt; <br>## <span class="hljs-number">6</span>      <span class="hljs-number">5</span>     <span class="hljs-number">6</span>       <span class="hljs-number">0.472</span>   &lt;NA&gt; <br>## <span class="hljs-number">7</span>      <span class="hljs-number">6</span>     <span class="hljs-number">7</span>       <span class="hljs-number">0.274</span>   &lt;NA&gt;<br></code></pre></td></tr></tbody></table></figure>
<p>看图更直观：</p>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071517116.png" srcset="/img/loading.gif" lazyload alt=""></p>
<p>可以清楚地看到进化树的全部信息，包括父节点、节点、分支长度及<code>tips</code>的标签等。</p>
<p>使用<code>as.phylo(x)</code>就能将数据框转换成<code>phylo</code>:</p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs R">as.phylo<span class="hljs-punctuation">(</span>x<span class="hljs-punctuation">)</span><br><span class="hljs-comment">## </span><br><span class="hljs-comment">## Phylogenetic tree with 4 tips and 3 internal nodes.</span><br><span class="hljs-comment">## </span><br><span class="hljs-comment">## Tip labels:</span><br><span class="hljs-comment">##   t4, t1, t3, t2</span><br><span class="hljs-comment">## </span><br><span class="hljs-comment">## Rooted; includes branch lengths.</span><br></code></pre></td></tr></tbody></table></figure>
<p>如果此时我们需要添加信息的话，在原始文件上添加信息是比较麻烦的，但是可以团购先构建数据框，然后将两个数据框<code>join</code>在一起就可以了：</p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs R">d <span class="hljs-operator">&lt;-</span> tibble<span class="hljs-punctuation">(</span>label <span class="hljs-operator">=</span> paste0<span class="hljs-punctuation">(</span><span class="hljs-string">'t'</span><span class="hljs-punctuation">,</span> <span class="hljs-number">1</span><span class="hljs-operator">:</span><span class="hljs-number">4</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>            trait <span class="hljs-operator">=</span> rnorm<span class="hljs-punctuation">(</span><span class="hljs-number">4</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br><br>y <span class="hljs-operator">&lt;-</span> full_join<span class="hljs-punctuation">(</span>x<span class="hljs-punctuation">,</span> d<span class="hljs-punctuation">,</span> by <span class="hljs-operator">=</span> <span class="hljs-string">'label'</span><span class="hljs-punctuation">)</span><br>y<br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071517688.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h3 id="treedata对象"><a href="#treedata对象" class="headerlink" title="treedata对象"></a><code>treedata</code>对象</h3><p><code>tidytree</code>默认的格式是<code>treedata</code>，函数<code>as.treedata</code>可以将前面的数据框转换成<code>treedata</code>对象：</p>
<figure class="highlight actionscript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs actionscript"><span class="hljs-keyword">as</span>.treedata(y)<br></code></pre></td></tr></tbody></table></figure>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs R"><span class="hljs-comment">## 'treedata' S4 object'.</span><br><span class="hljs-comment">## </span><br><span class="hljs-comment">## ...@ phylo: </span><br><span class="hljs-comment">## Phylogenetic tree with 4 tips and 3 internal nodes.</span><br><span class="hljs-comment">## </span><br><span class="hljs-comment">## Tip labels:</span><br><span class="hljs-comment">##   t4, t1, t3, t2</span><br><span class="hljs-comment">## </span><br><span class="hljs-comment">## Rooted; includes branch lengths.</span><br><span class="hljs-comment">## </span><br><span class="hljs-comment">## with the following features available:</span><br><span class="hljs-comment">##  'trait'.</span><br></code></pre></td></tr></tbody></table></figure>
<p>同样也可以通过<code>as_tibble</code>将<code>treedata</code>转换成数据框格式：</p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs R">y <span class="hljs-operator">%&gt;%</span> as.treedata <span class="hljs-operator">%&gt;%</span> as_tibble<br></code></pre></td></tr></tbody></table></figure>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs R"><span class="hljs-comment">## # A tibble: 7 x 5</span><br><span class="hljs-comment">##   parent  node branch.length label  trait</span><br><span class="hljs-comment">##    &lt;int&gt; &lt;int&gt;         &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt;</span><br><span class="hljs-comment">## 1      5     1       0.435   t4     0.943</span><br><span class="hljs-comment">## 2      7     2       0.674   t1    -0.171</span><br><span class="hljs-comment">## 3      7     3       0.00202 t3     0.570</span><br><span class="hljs-comment">## 4      6     4       0.0251  t2    -0.283</span><br><span class="hljs-comment">## 5      5     5      NA       &lt;NA&gt;  NA    </span><br><span class="hljs-comment">## 6      5     6       0.472   &lt;NA&gt;  NA    </span><br><span class="hljs-comment">## 7      6     7       0.274   &lt;NA&gt;  NA</span><br></code></pre></td></tr></tbody></table></figure>
<h3 id="树文件融合"><a href="#树文件融合" class="headerlink" title="树文件融合"></a>树文件融合</h3><p><code>treeio</code>同的函数<code>merge_tree()</code>可以对多个树文件进行合并，原理是以<code>node/branches</code>为`key进行数据合并，如：</p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs R">library<span class="hljs-punctuation">(</span>treeio<span class="hljs-punctuation">)</span><br>beast_file <span class="hljs-operator">&lt;-</span> system.file<span class="hljs-punctuation">(</span><span class="hljs-string">"examples/MCC_FluA_H3.tree"</span><span class="hljs-punctuation">,</span> package<span class="hljs-operator">=</span><span class="hljs-string">"ggtree"</span><span class="hljs-punctuation">)</span><br>rst_file <span class="hljs-operator">&lt;-</span> system.file<span class="hljs-punctuation">(</span><span class="hljs-string">"examples/rst"</span><span class="hljs-punctuation">,</span> package<span class="hljs-operator">=</span><span class="hljs-string">"ggtree"</span><span class="hljs-punctuation">)</span><br>mlc_file <span class="hljs-operator">&lt;-</span> system.file<span class="hljs-punctuation">(</span><span class="hljs-string">"examples/mlc"</span><span class="hljs-punctuation">,</span> package<span class="hljs-operator">=</span><span class="hljs-string">"ggtree"</span><span class="hljs-punctuation">)</span><br>beast_tree <span class="hljs-operator">&lt;-</span> read.beast<span class="hljs-punctuation">(</span>beast_file<span class="hljs-punctuation">)</span><br>codeml_tree <span class="hljs-operator">&lt;-</span> read.codeml<span class="hljs-punctuation">(</span>rst_file<span class="hljs-punctuation">,</span> mlc_file<span class="hljs-punctuation">)</span><br><br>merged_tree <span class="hljs-operator">&lt;-</span> merge_tree<span class="hljs-punctuation">(</span>beast_tree<span class="hljs-punctuation">,</span> codeml_tree<span class="hljs-punctuation">)</span><br>merged_tree<br></code></pre></td></tr></tbody></table></figure>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs R"><span class="hljs-comment">## 'treedata' S4 object that stored information of</span><br><span class="hljs-comment">##  '/home/ygc/R/library/ggtree/examples/MCC_FluA_H3.tree',</span><br><span class="hljs-comment">##  '/home/ygc/R/library/ggtree/examples/rst',</span><br><span class="hljs-comment">##  '/home/ygc/R/library/ggtree/examples/mlc'.</span><br><span class="hljs-comment">## </span><br><span class="hljs-comment">## ...@ phylo: </span><br><span class="hljs-comment">## Phylogenetic tree with 76 tips and 75 internal nodes.</span><br><span class="hljs-comment">## </span><br><span class="hljs-comment">## Tip labels:</span><br><span class="hljs-comment">##   A/Hokkaido/30-1-a/2013, A/New_York/334/2004, A/New_York/463/2005, A/New_York/452/1999, A/New_York/238/2005, A/New_York/523/1998, ...</span><br><span class="hljs-comment">## </span><br><span class="hljs-comment">## Rooted; includes branch lengths.</span><br><span class="hljs-comment">## </span><br><span class="hljs-comment">## with the following features available:</span><br><span class="hljs-comment">##  'height',   'height_0.95_HPD',  'height_median',</span><br><span class="hljs-comment">##  'height_range', 'length',   'length_0.95_HPD',</span><br><span class="hljs-comment">##  'length_median',    'length_range', 'posterior',    'rate',</span><br><span class="hljs-comment">##  'rate_0.95_HPD',    'rate_median',  'rate_range',   'subs',</span><br><span class="hljs-comment">##  'AA_subs',  't',    'N',    'S',    'dN_vs_dS', 'dN',   'dS',   'N_x_dN',</span><br><span class="hljs-comment">##  'S_x_dS'.</span><br></code></pre></td></tr></tbody></table></figure>
<p>合并后的树文件，除开<code>node</code>和<code>branches</code>外，其余的所有附加信息都变成了变量。</p>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071517669.png" srcset="/img/loading.gif" lazyload alt=""></p>
<p>既然是个数据框，那就可以对这些数据进行可视化：</p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs R">library<span class="hljs-punctuation">(</span>dplyr<span class="hljs-punctuation">)</span><br>df <span class="hljs-operator">&lt;-</span> merged_tree <span class="hljs-operator">%&gt;%</span> <br>  as_tibble<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  select<span class="hljs-punctuation">(</span>dN_vs_dS<span class="hljs-punctuation">,</span> dN<span class="hljs-punctuation">,</span> dS<span class="hljs-punctuation">,</span> rate<span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  subset<span class="hljs-punctuation">(</span>dN_vs_dS <span class="hljs-operator">&gt;=</span><span class="hljs-number">0</span> <span class="hljs-operator">&amp;</span> dN_vs_dS <span class="hljs-operator">&lt;=</span> <span class="hljs-number">1.5</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  tidyr<span class="hljs-operator">::</span>gather<span class="hljs-punctuation">(</span>type<span class="hljs-punctuation">,</span> value<span class="hljs-punctuation">,</span> dN_vs_dS<span class="hljs-operator">:</span>dS<span class="hljs-punctuation">)</span><br>df<span class="hljs-operator">$</span>type<span class="hljs-punctuation">[</span>df<span class="hljs-operator">$</span>type <span class="hljs-operator">==</span> <span class="hljs-string">'dN_vs_dS'</span><span class="hljs-punctuation">]</span> <span class="hljs-operator">&lt;-</span> <span class="hljs-string">'dN/dS'</span><br>df<span class="hljs-operator">$</span>type <span class="hljs-operator">&lt;-</span> factor<span class="hljs-punctuation">(</span>df<span class="hljs-operator">$</span>type<span class="hljs-punctuation">,</span> levels<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"dN/dS"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"dN"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"dS"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>ggplot<span class="hljs-punctuation">(</span>df<span class="hljs-punctuation">,</span> aes<span class="hljs-punctuation">(</span>rate<span class="hljs-punctuation">,</span> value<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> geom_hex<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  facet_wrap<span class="hljs-punctuation">(</span><span class="hljs-operator">~</span>type<span class="hljs-punctuation">,</span> scale<span class="hljs-operator">=</span><span class="hljs-string">'free_y'</span><span class="hljs-punctuation">)</span> <br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071518040.png" srcset="/img/loading.gif" lazyload alt=""></p>
<p>还可以利用该函数比较不同软件的分析结果：</p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs R">phylo <span class="hljs-operator">&lt;-</span> as.phylo<span class="hljs-punctuation">(</span>beast_tree<span class="hljs-punctuation">)</span><br>N <span class="hljs-operator">&lt;-</span> Nnode2<span class="hljs-punctuation">(</span>phylo<span class="hljs-punctuation">)</span><br>d <span class="hljs-operator">&lt;-</span> tibble<span class="hljs-punctuation">(</span>node <span class="hljs-operator">=</span> <span class="hljs-number">1</span><span class="hljs-operator">:</span>N<span class="hljs-punctuation">,</span> fake_trait <span class="hljs-operator">=</span> rnorm<span class="hljs-punctuation">(</span>N<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> another_trait <span class="hljs-operator">=</span> runif<span class="hljs-punctuation">(</span>N<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>fake_tree <span class="hljs-operator">&lt;-</span> treedata<span class="hljs-punctuation">(</span>phylo <span class="hljs-operator">=</span> phylo<span class="hljs-punctuation">,</span> data <span class="hljs-operator">=</span> d<span class="hljs-punctuation">)</span><br>triple_tree <span class="hljs-operator">&lt;-</span> merge_tree<span class="hljs-punctuation">(</span>merged_tree<span class="hljs-punctuation">,</span> fake_tree<span class="hljs-punctuation">)</span><br>triple_tree<br></code></pre></td></tr></tbody></table></figure>
<h3 id="链接外部数据"><a href="#链接外部数据" class="headerlink" title="链接外部数据"></a>链接外部数据</h3><p>进化树能够展示的东西不仅仅是进化关系，还可以增添许多信息，如基因表达量啥的。<code>treeio</code>的函数<code>full_join()</code>能够通过<code>node</code>或<code>tips</code>进行数据融合：</p>
<ul>
<li><p>通过<code>node</code>：</p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs R">library<span class="hljs-punctuation">(</span>ape<span class="hljs-punctuation">)</span><br>data<span class="hljs-punctuation">(</span>woodmouse<span class="hljs-punctuation">)</span><br>d <span class="hljs-operator">&lt;-</span> dist.dna<span class="hljs-punctuation">(</span>woodmouse<span class="hljs-punctuation">)</span><br>tr <span class="hljs-operator">&lt;-</span> nj<span class="hljs-punctuation">(</span>d<span class="hljs-punctuation">)</span><br>bp <span class="hljs-operator">&lt;-</span> boot.phylo<span class="hljs-punctuation">(</span>tr<span class="hljs-punctuation">,</span> <br>                 woodmouse<span class="hljs-punctuation">,</span> <br>                 <span class="hljs-keyword">function</span><span class="hljs-punctuation">(</span>x<span class="hljs-punctuation">)</span> nj<span class="hljs-punctuation">(</span>dist.dna<span class="hljs-punctuation">(</span>x<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br><br>bp2 <span class="hljs-operator">&lt;-</span> tibble<span class="hljs-punctuation">(</span>node<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-operator">:</span>Nnode<span class="hljs-punctuation">(</span>tr<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <span class="hljs-comment"># 计算父节点数</span><br>                Ntip<span class="hljs-punctuation">(</span>tr<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> <span class="hljs-comment"># 计算tip数</span><br>              bootstrap <span class="hljs-operator">=</span> bp<span class="hljs-punctuation">)</span><br>full_join<span class="hljs-punctuation">(</span>tr<span class="hljs-punctuation">,</span> bp2<span class="hljs-punctuation">,</span> by<span class="hljs-operator">=</span><span class="hljs-string">"node"</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></tbody></table></figure>
</li>
<li><p>通过<code>tips</code>：</p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs R">file <span class="hljs-operator">&lt;-</span> system.file<span class="hljs-punctuation">(</span><span class="hljs-string">"extdata/BEAST"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"beast_mcc.tree"</span><span class="hljs-punctuation">,</span> package<span class="hljs-operator">=</span><span class="hljs-string">"treeio"</span><span class="hljs-punctuation">)</span><br>beast <span class="hljs-operator">&lt;-</span> read.beast<span class="hljs-punctuation">(</span>file<span class="hljs-punctuation">)</span><br>x <span class="hljs-operator">&lt;-</span> tibble<span class="hljs-punctuation">(</span>label <span class="hljs-operator">=</span> as.phylo<span class="hljs-punctuation">(</span>beast<span class="hljs-punctuation">)</span><span class="hljs-operator">$</span>tip.label<span class="hljs-punctuation">,</span> trait <span class="hljs-operator">=</span> rnorm<span class="hljs-punctuation">(</span>Ntip<span class="hljs-punctuation">(</span>beast<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>full_join<span class="hljs-punctuation">(</span>beast<span class="hljs-punctuation">,</span> x<span class="hljs-punctuation">,</span> by<span class="hljs-operator">=</span><span class="hljs-string">"label"</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></tbody></table></figure>
</li>
</ul>
<h3 id="如何找到想要的node"><a href="#如何找到想要的node" class="headerlink" title="如何找到想要的node"></a>如何找到想要的<code>node</code></h3><figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs R">library<span class="hljs-punctuation">(</span>ggtree<span class="hljs-punctuation">)</span><br>library<span class="hljs-punctuation">(</span>ggplot2<span class="hljs-punctuation">)</span><br><br>set.seed<span class="hljs-punctuation">(</span><span class="hljs-number">1</span><span class="hljs-punctuation">)</span><br>tr <span class="hljs-operator">=</span> rtree<span class="hljs-punctuation">(</span><span class="hljs-number">10</span><span class="hljs-punctuation">)</span><br><br>p  <span class="hljs-operator">+</span> <br>  geom_label<span class="hljs-punctuation">(</span>aes<span class="hljs-punctuation">(</span>x<span class="hljs-operator">=</span>branch<span class="hljs-punctuation">,</span> label<span class="hljs-operator">=</span>node<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-operator">+</span><br>  geom_hilight<span class="hljs-punctuation">(</span>node<span class="hljs-operator">=</span><span class="hljs-number">12</span><span class="hljs-punctuation">,</span> fill<span class="hljs-operator">=</span><span class="hljs-string">"steelblue"</span><span class="hljs-punctuation">,</span> alpha<span class="hljs-operator">=</span><span class="hljs-number">.6</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></tbody></table></figure>
<h3 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h3><p><code>treeio</code>中的函数 <code>groupOTU()</code> 和 <code>groupClade()</code> 可以用于分组。</p>
<h4 id="groupClade"><a href="#groupClade" class="headerlink" title="groupClade"></a><code>groupClade</code></h4><figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs R">nwk <span class="hljs-operator">&lt;-</span> <span class="hljs-string">'(((((((A:4,B:4):6,C:5):8,D:6):3,E:21):10,((F:4,G:12):14,H:8):13):13,((I:5,J:2):30,(K:11,L:11):2):17):4,M:56);'</span><br>tree <span class="hljs-operator">&lt;-</span> read.tree<span class="hljs-punctuation">(</span>text<span class="hljs-operator">=</span>nwk<span class="hljs-punctuation">)</span><br><br>groupClade<span class="hljs-punctuation">(</span>as_tibble<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> <span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-number">17</span><span class="hljs-punctuation">,</span> <span class="hljs-number">21</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></tbody></table></figure>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs R"><span class="hljs-comment">## # A tibble: 25 x 5</span><br><span class="hljs-comment">##    parent  node branch.length label group</span><br><span class="hljs-comment">##     &lt;int&gt; &lt;int&gt;         &lt;dbl&gt; &lt;chr&gt; &lt;fct&gt;</span><br><span class="hljs-comment">##  1     20     1             4 A     1    </span><br><span class="hljs-comment">##  2     20     2             4 B     1    </span><br><span class="hljs-comment">##  3     19     3             5 C     1    </span><br><span class="hljs-comment">##  4     18     4             6 D     1    </span><br><span class="hljs-comment">##  5     17     5            21 E     1    </span><br><span class="hljs-comment">##  6     22     6             4 F     2    </span><br><span class="hljs-comment">##  7     22     7            12 G     2    </span><br><span class="hljs-comment">##  8     21     8             8 H     2    </span><br><span class="hljs-comment">##  9     24     9             5 I     0    </span><br><span class="hljs-comment">## 10     24    10             2 J     0    </span><br><span class="hljs-comment">## # … with 15 more rows</span><br></code></pre></td></tr></tbody></table></figure>
<p>以<code>node17</code>和<code>node21</code>为界将<code>clade</code>进行分组。这两个函数可以作用于<code>tbl_tree</code>、<code>phylo</code> 、 <code>treedata</code>及 <code>ggtree</code> 这些对象。</p>
<h4 id="groupOTU"><a href="#groupOTU" class="headerlink" title="groupOTU"></a><code>groupOTU</code></h4><figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs R">set.seed<span class="hljs-punctuation">(</span><span class="hljs-number">2017</span><span class="hljs-punctuation">)</span><br>tr <span class="hljs-operator">&lt;-</span> rtree<span class="hljs-punctuation">(</span><span class="hljs-number">4</span><span class="hljs-punctuation">)</span><br>x <span class="hljs-operator">&lt;-</span> as_tibble<span class="hljs-punctuation">(</span>tr<span class="hljs-punctuation">)</span><br><span class="hljs-comment">## 输入的节点可以是节点ID，也可以是Label</span><br>groupOTU<span class="hljs-punctuation">(</span>x<span class="hljs-punctuation">,</span> <span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">'t1'</span><span class="hljs-punctuation">,</span> <span class="hljs-string">'t4'</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> group_name <span class="hljs-operator">=</span> <span class="hljs-string">"fake_group"</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></tbody></table></figure>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs R"><span class="hljs-comment">## # A tibble: 7 x 5</span><br><span class="hljs-comment">##   parent  node branch.length label fake_group</span><br><span class="hljs-comment">##    &lt;int&gt; &lt;int&gt;         &lt;dbl&gt; &lt;chr&gt; &lt;fct&gt;     </span><br><span class="hljs-comment">## 1      5     1       0.435   t4    1         </span><br><span class="hljs-comment">## 2      7     2       0.674   t1    1         </span><br><span class="hljs-comment">## 3      7     3       0.00202 t3    0         </span><br><span class="hljs-comment">## 4      6     4       0.0251  t2    0         </span><br><span class="hljs-comment">## 5      5     5      NA       &lt;NA&gt;  1         </span><br><span class="hljs-comment">## 6      5     6       0.472   &lt;NA&gt;  1         </span><br><span class="hljs-comment">## 7      6     7       0.274   &lt;NA&gt;  1</span><br></code></pre></td></tr></tbody></table></figure>
<p>更常见的分组方法是直接命名分组：</p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs R">cls <span class="hljs-operator">&lt;-</span> <span class="hljs-built_in">list</span><span class="hljs-punctuation">(</span>c1<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"A"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"B"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"C"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"D"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"E"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>            c2<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"F"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"G"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"H"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>            c3<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"L"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"K"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"I"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"J"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>            c4<span class="hljs-operator">=</span><span class="hljs-string">"M"</span><span class="hljs-punctuation">)</span><br><br>as_tibble<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> groupOTU<span class="hljs-punctuation">(</span>cls<span class="hljs-punctuation">)</span><br></code></pre></td></tr></tbody></table></figure>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs R"><span class="hljs-comment">## # A tibble: 25 x 5</span><br><span class="hljs-comment">##    parent  node branch.length label group</span><br><span class="hljs-comment">##     &lt;int&gt; &lt;int&gt;         &lt;dbl&gt; &lt;chr&gt; &lt;fct&gt;</span><br><span class="hljs-comment">##  1     20     1             4 A     c1   </span><br><span class="hljs-comment">##  2     20     2             4 B     c1   </span><br><span class="hljs-comment">##  3     19     3             5 C     c1   </span><br><span class="hljs-comment">##  4     18     4             6 D     c1   </span><br><span class="hljs-comment">##  5     17     5            21 E     c1   </span><br><span class="hljs-comment">##  6     22     6             4 F     c2   </span><br><span class="hljs-comment">##  7     22     7            12 G     c2   </span><br><span class="hljs-comment">##  8     21     8             8 H     c2   </span><br><span class="hljs-comment">##  9     24     9             5 I     c3   </span><br><span class="hljs-comment">## 10     24    10             2 J     c3   </span><br><span class="hljs-comment">## # … with 15 more rows</span><br></code></pre></td></tr></tbody></table></figure>
<h3 id="重新标准化分支"><a href="#重新标准化分支" class="headerlink" title="重新标准化分支"></a>重新标准化分支</h3><p>不同的进化树可以进行合并，原始的分支长度可能单位不一样，这时候就可以用合并后的其他参数对分支长度进行标准化。</p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs R">p1 <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>merged_tree<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> theme_tree2<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br>p2 <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>rescale_tree<span class="hljs-punctuation">(</span>merged_tree<span class="hljs-punctuation">,</span> <span class="hljs-string">'dN'</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> theme_tree2<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br>p3 <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>rescale_tree<span class="hljs-punctuation">(</span>merged_tree<span class="hljs-punctuation">,</span> <span class="hljs-string">'rate'</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> theme_tree2<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br><br>cowplot<span class="hljs-operator">::</span>plot_grid<span class="hljs-punctuation">(</span>p1<span class="hljs-punctuation">,</span> p2<span class="hljs-punctuation">,</span> p3<span class="hljs-punctuation">,</span> ncol<span class="hljs-operator">=</span><span class="hljs-number">3</span><span class="hljs-punctuation">,</span> labels <span class="hljs-operator">=</span> <span class="hljs-built_in">LETTERS</span><span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-operator">:</span><span class="hljs-number">3</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071518343.png" srcset="/img/loading.gif" lazyload alt=""></p>
<p>从上图可以看到的是，三个图的“横坐标”范围不一样，第一个图是原始的分支单位，第二个是以<code>dN</code>进行标准化的结果，第三个是以<code>rate</code>进行标准化的结果。</p>
<h3 id="子集操作"><a href="#子集操作" class="headerlink" title="子集操作"></a>子集操作</h3><h4 id="从树中除去tips"><a href="#从树中除去tips" class="headerlink" title="从树中除去tips"></a>从树中除去<code>tips</code></h4><p>有些时候出于某些原因（如序列质量、组装质量、比对错误等），我们会将某些<code>tips</code>（样本）从树里面剔除，函数<code>drop.tip()</code>可以实现这一功能：</p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs R">f <span class="hljs-operator">&lt;-</span> system.file<span class="hljs-punctuation">(</span><span class="hljs-string">"extdata/NHX"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"phyldog.nhx"</span><span class="hljs-punctuation">,</span> package<span class="hljs-operator">=</span><span class="hljs-string">"treeio"</span><span class="hljs-punctuation">)</span><br>nhx <span class="hljs-operator">&lt;-</span> read.nhx<span class="hljs-punctuation">(</span>f<span class="hljs-punctuation">)</span><br>to_drop <span class="hljs-operator">&lt;-</span> <span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"Physonect_sp_@2066767"</span><span class="hljs-punctuation">,</span><br>             <span class="hljs-string">"Lychnagalma_utricularia@2253871"</span><span class="hljs-punctuation">,</span><br>             <span class="hljs-string">"Kephyes_ovata@2606431"</span><span class="hljs-punctuation">)</span><br>p1 <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>nhx<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> geom_tiplab<span class="hljs-punctuation">(</span>aes<span class="hljs-punctuation">(</span>color <span class="hljs-operator">=</span> label <span class="hljs-operator">%in%</span> to_drop<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  scale_color_manual<span class="hljs-punctuation">(</span>values<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"black"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"red"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> xlim<span class="hljs-punctuation">(</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-number">0.8</span><span class="hljs-punctuation">)</span><br><br>nhx_reduced <span class="hljs-operator">&lt;-</span> drop.tip<span class="hljs-punctuation">(</span>as.phylo<span class="hljs-punctuation">(</span>nhx<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> to_drop<span class="hljs-punctuation">)</span> <span class="hljs-comment"># 发现需要转换成phylo对象才行</span><br>p2 <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>nhx_reduced<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> geom_tiplab<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> xlim<span class="hljs-punctuation">(</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-number">0.8</span><span class="hljs-punctuation">)</span>  <br>cowplot<span class="hljs-operator">::</span>plot_grid<span class="hljs-punctuation">(</span>p1<span class="hljs-punctuation">,</span> p2<span class="hljs-punctuation">,</span> ncol<span class="hljs-operator">=</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span> labels <span class="hljs-operator">=</span> <span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"A"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"B"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071518019.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h4 id="根据tips取子集"><a href="#根据tips取子集" class="headerlink" title="根据tips取子集"></a>根据<code>tips</code>取子集</h4><p>如果一个进化树很复杂的话，要看我们感兴趣的部分就很难，这时候就需要将我们感兴趣的部分提取出来。<code>treeio</code>中的函数<code>tree_subset()</code>能够完成这一功能，即使是提取出来的子集，结构还是和原来的一样，不会发生变化。</p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs R">beast_file <span class="hljs-operator">&lt;-</span> system.file<span class="hljs-punctuation">(</span><span class="hljs-string">"examples/MCC_FluA_H3.tree"</span><span class="hljs-punctuation">,</span> package<span class="hljs-operator">=</span><span class="hljs-string">"ggtree"</span><span class="hljs-punctuation">)</span><br>beast_tree <span class="hljs-operator">&lt;-</span> read.beast<span class="hljs-punctuation">(</span>beast_file<span class="hljs-punctuation">)</span><br><br>p1 <span class="hljs-operator">=</span> ggtree<span class="hljs-punctuation">(</span>beast_tree<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  geom_tiplab<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span>  <br>  ggtitle<span class="hljs-punctuation">(</span><span class="hljs-string">'原始树'</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  xlim<span class="hljs-punctuation">(</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-number">40</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> theme_tree2<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br><br>tree2 <span class="hljs-operator">=</span> tree_subset<span class="hljs-punctuation">(</span>beast_tree<span class="hljs-punctuation">,</span> <span class="hljs-string">"A/Swine/HK/168/2012"</span><span class="hljs-punctuation">,</span> levels_back<span class="hljs-operator">=</span><span class="hljs-number">4</span><span class="hljs-punctuation">)</span>  <br>p2 <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>tree2<span class="hljs-punctuation">,</span> aes<span class="hljs-punctuation">(</span>color<span class="hljs-operator">=</span>group<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  ggtitle<span class="hljs-punctuation">(</span><span class="hljs-string">'取子集'</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  scale_color_manual<span class="hljs-punctuation">(</span>values <span class="hljs-operator">=</span> <span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"black"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"red"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_tiplab<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span>  xlim<span class="hljs-punctuation">(</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-number">4</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> theme_tree2<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <br><br>p3 <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>tree2<span class="hljs-punctuation">,</span> aes<span class="hljs-punctuation">(</span>color<span class="hljs-operator">=</span>group<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_tiplab<span class="hljs-punctuation">(</span>hjust <span class="hljs-operator">=</span> <span class="hljs-operator">-</span><span class="hljs-number">.1</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> xlim<span class="hljs-punctuation">(</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-number">5</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  geom_point<span class="hljs-punctuation">(</span>aes<span class="hljs-punctuation">(</span>fill <span class="hljs-operator">=</span> rate<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> shape <span class="hljs-operator">=</span> <span class="hljs-number">21</span><span class="hljs-punctuation">,</span> size <span class="hljs-operator">=</span> <span class="hljs-number">4</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  ggtitle<span class="hljs-punctuation">(</span><span class="hljs-string">'用rate这个变量控制颜色'</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  scale_color_manual<span class="hljs-punctuation">(</span>values <span class="hljs-operator">=</span> <span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"black"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"red"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> guide <span class="hljs-operator">=</span> <span class="hljs-literal">FALSE</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  scale_fill_continuous<span class="hljs-punctuation">(</span>low <span class="hljs-operator">=</span> <span class="hljs-string">'blue'</span><span class="hljs-punctuation">,</span> high <span class="hljs-operator">=</span> <span class="hljs-string">'red'</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  theme_tree2<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> theme<span class="hljs-punctuation">(</span>legend.position <span class="hljs-operator">=</span> <span class="hljs-string">'right'</span><span class="hljs-punctuation">)</span><br><br><br>p4 <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>tree2<span class="hljs-punctuation">,</span> aes<span class="hljs-punctuation">(</span>color<span class="hljs-operator">=</span>group<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> <br>             root.position <span class="hljs-operator">=</span> as.phylo<span class="hljs-punctuation">(</span>tree2<span class="hljs-punctuation">)</span><span class="hljs-operator">$</span>root.edge<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_tiplab<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> xlim<span class="hljs-punctuation">(</span><span class="hljs-number">18</span><span class="hljs-punctuation">,</span> <span class="hljs-number">24</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  ggtitle<span class="hljs-punctuation">(</span><span class="hljs-string">'添加根节点但不显示'</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  scale_color_manual<span class="hljs-punctuation">(</span>values <span class="hljs-operator">=</span> <span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"black"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"red"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  theme_tree2<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br><br>p5 <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>tree2<span class="hljs-punctuation">,</span> aes<span class="hljs-punctuation">(</span>color<span class="hljs-operator">=</span>group<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> <br>             root.position <span class="hljs-operator">=</span> as.phylo<span class="hljs-punctuation">(</span>tree2<span class="hljs-punctuation">)</span><span class="hljs-operator">$</span>root.edge<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_rootedge<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> geom_tiplab<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> xlim<span class="hljs-punctuation">(</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-number">40</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  ggtitle<span class="hljs-punctuation">(</span><span class="hljs-string">'添加根节点且显示'</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  scale_color_manual<span class="hljs-punctuation">(</span>values <span class="hljs-operator">=</span> <span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"black"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"red"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  theme_tree2<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br><br>plot_grid<span class="hljs-punctuation">(</span>p2<span class="hljs-punctuation">,</span> p3<span class="hljs-punctuation">,</span> p4<span class="hljs-punctuation">,</span> p5<span class="hljs-punctuation">,</span> ncol<span class="hljs-operator">=</span><span class="hljs-number">2</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  plot_grid<span class="hljs-punctuation">(</span>p1<span class="hljs-punctuation">,</span> .<span class="hljs-punctuation">,</span> ncol<span class="hljs-operator">=</span><span class="hljs-number">2</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071518696.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h4 id="根据内部节点编号取子集"><a href="#根据内部节点编号取子集" class="headerlink" title="根据内部节点编号取子集"></a>根据内部节点编号取子集</h4><p>如果我们对特定的进化分支（clade）感兴趣，那也可以通过<code>tree_subset()</code>函数将感兴趣的分支进行放大展示，但是这个时候需要我们知道感兴趣的进化分支所对应的<code>node</code>编号才行。</p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs R">clade <span class="hljs-operator">&lt;-</span> tree_subset<span class="hljs-punctuation">(</span>beast_tree<span class="hljs-punctuation">,</span> node<span class="hljs-operator">=</span><span class="hljs-number">121</span><span class="hljs-punctuation">,</span> levels_back<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-punctuation">)</span><br>clade2 <span class="hljs-operator">&lt;-</span> tree_subset<span class="hljs-punctuation">(</span>beast_tree<span class="hljs-punctuation">,</span> node<span class="hljs-operator">=</span><span class="hljs-number">121</span><span class="hljs-punctuation">,</span> levels_back<span class="hljs-operator">=</span><span class="hljs-number">2</span><span class="hljs-punctuation">)</span><br>p1 <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>clade<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  ggtitle<span class="hljs-punctuation">(</span><span class="hljs-string">'感兴趣的整个分支'</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_tiplab<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> xlim<span class="hljs-punctuation">(</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-number">5</span><span class="hljs-punctuation">)</span><br>p2 <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>clade2<span class="hljs-punctuation">,</span> aes<span class="hljs-punctuation">(</span>color<span class="hljs-operator">=</span>group<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  ggtitle<span class="hljs-punctuation">(</span><span class="hljs-string">'感兴趣的整个分支 + 回退两个节点'</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_tiplab<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  xlim<span class="hljs-punctuation">(</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-number">8</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> scale_color_manual<span class="hljs-punctuation">(</span>values<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"black"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"red"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br><br><br>library<span class="hljs-punctuation">(</span>ape<span class="hljs-punctuation">)</span><br>library<span class="hljs-punctuation">(</span>tidytree<span class="hljs-punctuation">)</span><br>library<span class="hljs-punctuation">(</span>treeio<span class="hljs-punctuation">)</span><br>data<span class="hljs-punctuation">(</span>chiroptera<span class="hljs-punctuation">)</span><br><br><span class="hljs-comment"># 如果不知道node的时候，就直接进行匹配</span><br>nodes <span class="hljs-operator">&lt;-</span> grep<span class="hljs-punctuation">(</span><span class="hljs-string">"Plecotus"</span><span class="hljs-punctuation">,</span> chiroptera<span class="hljs-operator">$</span>tip.label<span class="hljs-punctuation">)</span><br>chiroptera <span class="hljs-operator">&lt;-</span> groupOTU<span class="hljs-punctuation">(</span>chiroptera<span class="hljs-punctuation">,</span> nodes<span class="hljs-punctuation">)</span><br><br>p3 <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>chiroptera<span class="hljs-punctuation">,</span> aes<span class="hljs-punctuation">(</span>colour <span class="hljs-operator">=</span> group<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  ggtitle<span class="hljs-punctuation">(</span><span class="hljs-string">'整个进化树中选择感兴趣的整个分支'</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  scale_color_manual<span class="hljs-punctuation">(</span>values<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"black"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"red"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  theme<span class="hljs-punctuation">(</span>legend.position <span class="hljs-operator">=</span> <span class="hljs-string">"none"</span><span class="hljs-punctuation">)</span><br><br>clade <span class="hljs-operator">&lt;-</span> MRCA<span class="hljs-punctuation">(</span>chiroptera<span class="hljs-punctuation">,</span> nodes<span class="hljs-punctuation">)</span> <span class="hljs-comment"># 最近的父节点</span><br>x <span class="hljs-operator">&lt;-</span> tree_subset<span class="hljs-punctuation">(</span>chiroptera<span class="hljs-punctuation">,</span> clade<span class="hljs-punctuation">,</span> levels_back <span class="hljs-operator">=</span> <span class="hljs-number">0</span><span class="hljs-punctuation">)</span><br>p4 <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>x<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  ggtitle<span class="hljs-punctuation">(</span><span class="hljs-string">'感兴趣的特有分支'</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_tiplab<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> xlim<span class="hljs-punctuation">(</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-number">5</span><span class="hljs-punctuation">)</span><br><br>plot_grid<span class="hljs-punctuation">(</span>p1<span class="hljs-punctuation">,</span> p2<span class="hljs-punctuation">,</span> p3<span class="hljs-punctuation">,</span> p4<span class="hljs-punctuation">,</span>ncol<span class="hljs-operator">=</span><span class="hljs-number">2</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071518111.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h3 id="导出数据"><a href="#导出数据" class="headerlink" title="导出数据"></a>导出数据</h3><p><code>treeio</code>这个R包可以导出多种格式的文件，这个比较简单，详情参照：<a target="_blank" rel="noopener" href="https://yulab-smu.top/treedata-book/chapter3.html">https://yulab-smu.top/treedata-book/chapter3.html</a></p>
<h2 id="进化树可视化"><a href="#进化树可视化" class="headerlink" title="进化树可视化"></a>进化树可视化</h2><h3 id="基础方法"><a href="#基础方法" class="headerlink" title="基础方法"></a>基础方法</h3><p><code>ggtree</code>对进化树进行可视化的方法有两种：</p>
<ul>
<li><code>ggplot()</code> + <code>geom_tree()</code> + <code>theme_tree()</code></li>
<li><code>ggtree()</code></li>
</ul>
<p>第二种方法是第一种方法的“缩写版”。</p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs R">library<span class="hljs-punctuation">(</span>treeio<span class="hljs-punctuation">)</span><br>library<span class="hljs-punctuation">(</span>ggtree<span class="hljs-punctuation">)</span><br><br>nwk <span class="hljs-operator">&lt;-</span> system.file<span class="hljs-punctuation">(</span><span class="hljs-string">"extdata"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"sample.nwk"</span><span class="hljs-punctuation">,</span> package<span class="hljs-operator">=</span><span class="hljs-string">"treeio"</span><span class="hljs-punctuation">)</span><br>tree <span class="hljs-operator">&lt;-</span> read.tree<span class="hljs-punctuation">(</span>nwk<span class="hljs-punctuation">)</span><br><br>ggplot<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">,</span> aes<span class="hljs-punctuation">(</span>x<span class="hljs-punctuation">,</span> y<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> geom_tree<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> theme_tree<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br>ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">)</span><br></code></pre></td></tr></tbody></table></figure>
<p>这两种方法得到的结果是一样的：</p>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071518520.png" srcset="/img/loading.gif" lazyload alt=""></p>
<p><code>ggtree</code>支持<code>ggplot2</code>的图形语法，因此，也可以在<code>ggtree</code>中对颜色性状等进行修改：</p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs R">library<span class="hljs-punctuation">(</span>ggplot2<span class="hljs-punctuation">)</span><br>library<span class="hljs-punctuation">(</span>treeio<span class="hljs-punctuation">)</span><br>library<span class="hljs-punctuation">(</span>ggtree<span class="hljs-punctuation">)</span><br><br>nwk <span class="hljs-operator">&lt;-</span> system.file<span class="hljs-punctuation">(</span><span class="hljs-string">"extdata"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"sample.nwk"</span><span class="hljs-punctuation">,</span> package<span class="hljs-operator">=</span><span class="hljs-string">"treeio"</span><span class="hljs-punctuation">)</span><br>tree <span class="hljs-operator">&lt;-</span> read.tree<span class="hljs-punctuation">(</span>nwk<span class="hljs-punctuation">)</span><br><br>ggplot<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">,</span> aes<span class="hljs-punctuation">(</span>x<span class="hljs-punctuation">,</span> y<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> geom_tree<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> theme_tree<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br>ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">)</span><br><br>p1 <span class="hljs-operator">=</span> ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">,</span> color<span class="hljs-operator">=</span><span class="hljs-string">"firebrick"</span><span class="hljs-punctuation">,</span> size<span class="hljs-operator">=</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span> linetype<span class="hljs-operator">=</span><span class="hljs-string">"dotted"</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  ggtitle<span class="hljs-punctuation">(</span><span class="hljs-string">'阶梯化'</span><span class="hljs-punctuation">)</span><br>p2 <span class="hljs-operator">=</span> ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">,</span> color<span class="hljs-operator">=</span><span class="hljs-string">"firebrick"</span><span class="hljs-punctuation">,</span> size<span class="hljs-operator">=</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span> linetype<span class="hljs-operator">=</span><span class="hljs-string">"dotted"</span><span class="hljs-punctuation">,</span> ladderize<span class="hljs-operator">=</span><span class="hljs-literal">FALSE</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  ggtitle<span class="hljs-punctuation">(</span><span class="hljs-string">'非阶梯化'</span><span class="hljs-punctuation">)</span><br><br>cowplot<span class="hljs-operator">::</span>plot_grid<span class="hljs-punctuation">(</span>p1<span class="hljs-punctuation">,</span>p2<span class="hljs-punctuation">)</span>v<br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071518765.png" srcset="/img/loading.gif" lazyload alt=""></p>
<p>可以使用参数<code>branch.length</code>对egde进行标准化，如果参数为<code>none</code>，则是这样：</p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs R">ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">,</span> branch.length<span class="hljs-operator">=</span><span class="hljs-string">"none"</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071518191.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h3 id="输出样式"><a href="#输出样式" class="headerlink" title="输出样式"></a>输出样式</h3><p><code>ggtree</code>支持多种输出样式：</p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs R">library<span class="hljs-punctuation">(</span>ggtree<span class="hljs-punctuation">)</span><br>set.seed<span class="hljs-punctuation">(</span><span class="hljs-number">2017</span><span class="hljs-operator">-</span><span class="hljs-number">02</span><span class="hljs-operator">-</span><span class="hljs-number">16</span><span class="hljs-punctuation">)</span><br>tree <span class="hljs-operator">&lt;-</span> rtree<span class="hljs-punctuation">(</span><span class="hljs-number">50</span><span class="hljs-punctuation">)</span><br>p1 <span class="hljs-operator">=</span> ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  ggtitle<span class="hljs-punctuation">(</span><span class="hljs-string">'默认'</span><span class="hljs-punctuation">)</span><br>p2 <span class="hljs-operator">=</span> ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">,</span> layout<span class="hljs-operator">=</span><span class="hljs-string">"roundrect"</span><span class="hljs-punctuation">)</span>  <span class="hljs-operator">+</span><br>  ggtitle<span class="hljs-punctuation">(</span><span class="hljs-string">'roundrect'</span><span class="hljs-punctuation">)</span><br>p3 <span class="hljs-operator">=</span> ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">,</span> layout<span class="hljs-operator">=</span><span class="hljs-string">"slanted"</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  ggtitle<span class="hljs-punctuation">(</span><span class="hljs-string">'slanted'</span><span class="hljs-punctuation">)</span><br>p4 <span class="hljs-operator">=</span> ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">,</span> layout<span class="hljs-operator">=</span><span class="hljs-string">"ellipse"</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  ggtitle<span class="hljs-punctuation">(</span><span class="hljs-string">'ellipse'</span><span class="hljs-punctuation">)</span><br>p5 <span class="hljs-operator">=</span> ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">,</span> layout<span class="hljs-operator">=</span><span class="hljs-string">"circular"</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  ggtitle<span class="hljs-punctuation">(</span><span class="hljs-string">'circular'</span><span class="hljs-punctuation">)</span><br>p6 <span class="hljs-operator">=</span> ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">,</span> layout<span class="hljs-operator">=</span><span class="hljs-string">"fan"</span><span class="hljs-punctuation">,</span> open.angle<span class="hljs-operator">=</span><span class="hljs-number">120</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  ggtitle<span class="hljs-punctuation">(</span><span class="hljs-string">'fan'</span><span class="hljs-punctuation">)</span><br>p7 <span class="hljs-operator">=</span> ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">,</span> layout<span class="hljs-operator">=</span><span class="hljs-string">"equal_angle"</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  ggtitle<span class="hljs-punctuation">(</span><span class="hljs-string">'equal_angle'</span><span class="hljs-punctuation">)</span><br>p8 <span class="hljs-operator">=</span> ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">,</span> layout<span class="hljs-operator">=</span><span class="hljs-string">"daylight"</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  ggtitle<span class="hljs-punctuation">(</span><span class="hljs-string">'daylight'</span><span class="hljs-punctuation">)</span><br>p9 <span class="hljs-operator">=</span> ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">,</span> branch.length<span class="hljs-operator">=</span><span class="hljs-string">'none'</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  ggtitle<span class="hljs-punctuation">(</span><span class="hljs-string">'none'</span><span class="hljs-punctuation">)</span><br>p10 <span class="hljs-operator">=</span> ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">,</span> layout<span class="hljs-operator">=</span><span class="hljs-string">"ellipse"</span><span class="hljs-punctuation">,</span> branch.length<span class="hljs-operator">=</span><span class="hljs-string">"none"</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  ggtitle<span class="hljs-punctuation">(</span><span class="hljs-string">'ellipse对齐'</span><span class="hljs-punctuation">)</span><br>p11 <span class="hljs-operator">=</span> ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">,</span> branch.length<span class="hljs-operator">=</span><span class="hljs-string">'none'</span><span class="hljs-punctuation">,</span> layout<span class="hljs-operator">=</span><span class="hljs-string">'circular'</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  ggtitle<span class="hljs-punctuation">(</span><span class="hljs-string">'circular对齐'</span><span class="hljs-punctuation">)</span><br>p12 <span class="hljs-operator">=</span> ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">,</span> layout<span class="hljs-operator">=</span><span class="hljs-string">"daylight"</span><span class="hljs-punctuation">,</span> branch.length <span class="hljs-operator">=</span> <span class="hljs-string">'none'</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  ggtitle<span class="hljs-punctuation">(</span><span class="hljs-string">'daylight对齐'</span><span class="hljs-punctuation">)</span><br><br>cowplot<span class="hljs-operator">::</span>plot_grid<span class="hljs-punctuation">(</span>p1<span class="hljs-punctuation">,</span>p2<span class="hljs-punctuation">,</span>p3<span class="hljs-punctuation">,</span>p4<span class="hljs-punctuation">,</span>p5<span class="hljs-punctuation">,</span>p6<span class="hljs-punctuation">,</span>p7<span class="hljs-punctuation">,</span>p8<span class="hljs-punctuation">,</span>p9<span class="hljs-punctuation">,</span>p10<span class="hljs-punctuation">,</span>p11<span class="hljs-punctuation">,</span>p12<span class="hljs-punctuation">,</span> ncol <span class="hljs-operator">=</span> <span class="hljs-number">4</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071518168.png" srcset="/img/loading.gif" lazyload alt=""></p>
<p>当只是展示树结构而没有分支长度标尺的时候，就用最下面这4种。</p>
<p>还有其他的多种对齐方式：</p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs R">ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> scale_x_reverse<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br>ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> coord_flip<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br>ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> layout_dendrogram<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br>ggplotify<span class="hljs-operator">::</span>as.ggplot<span class="hljs-punctuation">(</span>ggtree<span class="hljs-punctuation">(</span>x<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> angle<span class="hljs-operator">=</span><span class="hljs-operator">-</span><span class="hljs-number">30</span><span class="hljs-punctuation">,</span> scale<span class="hljs-operator">=</span><span class="hljs-number">.9</span><span class="hljs-punctuation">)</span><br>ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">,</span> layout<span class="hljs-operator">=</span><span class="hljs-string">'slanted'</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> coord_flip<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br>ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">,</span> layout<span class="hljs-operator">=</span><span class="hljs-string">'slanted'</span><span class="hljs-punctuation">,</span> branch.length<span class="hljs-operator">=</span><span class="hljs-string">'none'</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> layout_dendrogram<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br>ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">,</span> layout<span class="hljs-operator">=</span><span class="hljs-string">'circular'</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> xlim<span class="hljs-punctuation">(</span><span class="hljs-operator">-</span><span class="hljs-number">10</span><span class="hljs-punctuation">,</span> <span class="hljs-literal">NA</span><span class="hljs-punctuation">)</span><br>ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> layout_inward_circular<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br>ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> layout_inward_circular<span class="hljs-punctuation">(</span>xlim<span class="hljs-operator">=</span><span class="hljs-number">15</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071518452.png" srcset="/img/loading.gif" lazyload alt=""></p>
<p>如果是时间范围数据的话，则需要调用参数<code>mrsd</code>（most recent sample data）：</p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs R">beast_file <span class="hljs-operator">&lt;-</span> system.file<span class="hljs-punctuation">(</span><span class="hljs-string">"examples/MCC_FluA_H3.tree"</span><span class="hljs-punctuation">,</span> <br>                          package<span class="hljs-operator">=</span><span class="hljs-string">"ggtree"</span><span class="hljs-punctuation">)</span><br>beast_tree <span class="hljs-operator">&lt;-</span> read.beast<span class="hljs-punctuation">(</span>beast_file<span class="hljs-punctuation">)</span><br>ggtree<span class="hljs-punctuation">(</span>beast_tree<span class="hljs-punctuation">,</span> mrsd<span class="hljs-operator">=</span><span class="hljs-string">"2013-01-01"</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> theme_tree2<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071518454.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h3 id="展示相关元素"><a href="#展示相关元素" class="headerlink" title="展示相关元素"></a>展示相关元素</h3><h4 id="展示进化距离"><a href="#展示进化距离" class="headerlink" title="展示进化距离"></a>展示进化距离</h4><p>函数<code>geom_treescale()</code>用于展示进化距离。</p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs R">p1 <span class="hljs-operator">=</span> ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> geom_treescale<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> ggtitle<span class="hljs-punctuation">(</span><span class="hljs-string">'默认'</span><span class="hljs-punctuation">)</span><br>p2 <span class="hljs-operator">=</span> ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> geom_treescale<span class="hljs-punctuation">(</span>x<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span> y<span class="hljs-operator">=</span><span class="hljs-number">45</span><span class="hljs-punctuation">,</span> width<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-punctuation">,</span> color<span class="hljs-operator">=</span><span class="hljs-string">'red'</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  ggtitle<span class="hljs-punctuation">(</span><span class="hljs-string">'设定位置、宽度、颜色'</span><span class="hljs-punctuation">)</span><br>p3 <span class="hljs-operator">=</span> ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> geom_treescale<span class="hljs-punctuation">(</span>fontsize<span class="hljs-operator">=</span><span class="hljs-number">6</span><span class="hljs-punctuation">,</span> linesize<span class="hljs-operator">=</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span> offset<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  ggtitle<span class="hljs-punctuation">(</span><span class="hljs-string">'设定字体大小、线条大小、缩进'</span><span class="hljs-punctuation">)</span><br>p4 <span class="hljs-operator">=</span> ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> theme_tree2<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  ggtitle<span class="hljs-punctuation">(</span><span class="hljs-string">'使用内置主题'</span><span class="hljs-punctuation">)</span><br><br>cowplot<span class="hljs-operator">::</span>plot_grid<span class="hljs-punctuation">(</span>p1<span class="hljs-punctuation">,</span>p2<span class="hljs-punctuation">,</span>p3<span class="hljs-punctuation">,</span>p4<span class="hljs-punctuation">,</span> ncol <span class="hljs-operator">=</span> <span class="hljs-number">2</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071518270.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h4 id="展示nodes-tips"><a href="#展示nodes-tips" class="headerlink" title="展示nodes/tips"></a>展示<code>nodes/tips</code></h4><figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs R">p1 <span class="hljs-operator">=</span> ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> geom_point<span class="hljs-punctuation">(</span>aes<span class="hljs-punctuation">(</span>shape<span class="hljs-operator">=</span>isTip<span class="hljs-punctuation">,</span> color<span class="hljs-operator">=</span>isTip<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> size<span class="hljs-operator">=</span><span class="hljs-number">3</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  ggtitle<span class="hljs-punctuation">(</span><span class="hljs-string">'使用geom_point()函数'</span><span class="hljs-punctuation">)</span><br><br>p2 <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> geom_nodepoint<span class="hljs-punctuation">(</span>color<span class="hljs-operator">=</span><span class="hljs-string">"#b5e521"</span><span class="hljs-punctuation">,</span> alpha<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-operator">/</span><span class="hljs-number">4</span><span class="hljs-punctuation">,</span> size<span class="hljs-operator">=</span><span class="hljs-number">10</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_tippoint<span class="hljs-punctuation">(</span>color<span class="hljs-operator">=</span><span class="hljs-string">"#FDAC4F"</span><span class="hljs-punctuation">,</span> shape<span class="hljs-operator">=</span><span class="hljs-number">8</span><span class="hljs-punctuation">,</span> size<span class="hljs-operator">=</span><span class="hljs-number">3</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  ggtitle<span class="hljs-punctuation">(</span><span class="hljs-string">'使用两个函数'</span><span class="hljs-punctuation">)</span><br><br>cowplot<span class="hljs-operator">::</span>plot_grid<span class="hljs-punctuation">(</span>p1<span class="hljs-punctuation">,</span>p2<span class="hljs-punctuation">,</span> ncol <span class="hljs-operator">=</span> <span class="hljs-number">2</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071518888.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h4 id="展示tips的标签"><a href="#展示tips的标签" class="headerlink" title="展示tips的标签"></a>展示<code>tips</code>的标签</h4><figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs R">p1 <span class="hljs-operator">=</span> ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> geom_nodepoint<span class="hljs-punctuation">(</span>color<span class="hljs-operator">=</span><span class="hljs-string">"#b5e521"</span><span class="hljs-punctuation">,</span> alpha<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-operator">/</span><span class="hljs-number">4</span><span class="hljs-punctuation">,</span> size<span class="hljs-operator">=</span><span class="hljs-number">10</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_tippoint<span class="hljs-punctuation">(</span>color<span class="hljs-operator">=</span><span class="hljs-string">"#FDAC4F"</span><span class="hljs-punctuation">,</span> shape<span class="hljs-operator">=</span><span class="hljs-number">8</span><span class="hljs-punctuation">,</span> size<span class="hljs-operator">=</span><span class="hljs-number">3</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  geom_tiplab<span class="hljs-punctuation">(</span>size<span class="hljs-operator">=</span><span class="hljs-number">3</span><span class="hljs-punctuation">,</span> color<span class="hljs-operator">=</span><span class="hljs-string">"purple"</span><span class="hljs-punctuation">)</span><br><br>p2 <span class="hljs-operator">=</span> ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">,</span> layout<span class="hljs-operator">=</span><span class="hljs-string">"circular"</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  geom_tiplab<span class="hljs-punctuation">(</span>aes<span class="hljs-punctuation">(</span>angle<span class="hljs-operator">=</span>angle<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> color<span class="hljs-operator">=</span><span class="hljs-string">'blue'</span><span class="hljs-punctuation">)</span><br><br>p3 <span class="hljs-operator">=</span> ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">,</span> branch.length <span class="hljs-operator">=</span> <span class="hljs-string">'none'</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  geom_tiplab<span class="hljs-punctuation">(</span>as_ylab<span class="hljs-operator">=</span><span class="hljs-literal">TRUE</span><span class="hljs-punctuation">,</span> color<span class="hljs-operator">=</span><span class="hljs-string">'firebrick'</span><span class="hljs-punctuation">)</span><br><br>cowplot<span class="hljs-operator">::</span>plot_grid<span class="hljs-punctuation">(</span>p1<span class="hljs-punctuation">,</span> p2<span class="hljs-punctuation">,</span>p3<span class="hljs-punctuation">,</span> ncol <span class="hljs-operator">=</span> <span class="hljs-number">3</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="ggtree学习笔记/19.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h4 id="展示根节点"><a href="#展示根节点" class="headerlink" title="展示根节点"></a>展示根节点</h4><figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs R"><span class="hljs-comment">## with root edge = 1</span><br>tree1 <span class="hljs-operator">&lt;-</span> read.tree<span class="hljs-punctuation">(</span>text<span class="hljs-operator">=</span><span class="hljs-string">'((A:1,B:2):3,C:2):1;'</span><span class="hljs-punctuation">)</span><br>p1 <span class="hljs-operator">=</span> ggtree<span class="hljs-punctuation">(</span>tree1<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> geom_tiplab<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> geom_rootedge<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  ggtitle<span class="hljs-punctuation">(</span><span class="hljs-string">'有根节点信息'</span><span class="hljs-punctuation">)</span><br><br><span class="hljs-comment">## without root edge</span><br>tree2 <span class="hljs-operator">&lt;-</span> read.tree<span class="hljs-punctuation">(</span>text<span class="hljs-operator">=</span><span class="hljs-string">'((A:1,B:2):3,C:2);'</span><span class="hljs-punctuation">)</span><br>p2 <span class="hljs-operator">=</span> ggtree<span class="hljs-punctuation">(</span>tree2<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> geom_tiplab<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> geom_rootedge<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  ggtitle<span class="hljs-punctuation">(</span><span class="hljs-string">'无根节点信息，默认无'</span><span class="hljs-punctuation">)</span><br><br><span class="hljs-comment">## setting root edge</span><br>tree2<span class="hljs-operator">$</span>root.edge <span class="hljs-operator">&lt;-</span> 2<br>p3 <span class="hljs-operator">=</span> ggtree<span class="hljs-punctuation">(</span>tree2<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> geom_tiplab<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> geom_rootedge<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  ggtitle<span class="hljs-punctuation">(</span><span class="hljs-string">'无根节点信息，添加信息'</span><span class="hljs-punctuation">)</span><br><br><span class="hljs-comment">## specify length of root edge for just plotting</span><br><span class="hljs-comment">## this will ignore tree$root.edge</span><br>p4 <span class="hljs-operator">=</span> ggtree<span class="hljs-punctuation">(</span>tree2<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> geom_tiplab<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> geom_rootedge<span class="hljs-punctuation">(</span>rootedge <span class="hljs-operator">=</span> <span class="hljs-number">3</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  ggtitle<span class="hljs-punctuation">(</span><span class="hljs-string">'无根节点信息，设置信息'</span><span class="hljs-punctuation">)</span><br><br>cowplot<span class="hljs-operator">::</span>plot_grid<span class="hljs-punctuation">(</span>p1<span class="hljs-punctuation">,</span>p2<span class="hljs-punctuation">,</span>p3<span class="hljs-punctuation">,</span>p4<span class="hljs-punctuation">,</span> ncol <span class="hljs-operator">=</span> <span class="hljs-number">2</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071519612.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h4 id="上色"><a href="#上色" class="headerlink" title="上色"></a>上色</h4><p>上色直接是很简单，就像<code>ggplot2</code>那样：</p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs R">ggtree<span class="hljs-punctuation">(</span>beast_tree<span class="hljs-punctuation">,</span> aes<span class="hljs-punctuation">(</span>color<span class="hljs-operator">=</span>rate<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  scale_color_continuous<span class="hljs-punctuation">(</span>low<span class="hljs-operator">=</span><span class="hljs-string">'darkgreen'</span><span class="hljs-punctuation">,</span> high<span class="hljs-operator">=</span><span class="hljs-string">'red'</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  theme<span class="hljs-punctuation">(</span>legend.position<span class="hljs-operator">=</span><span class="hljs-string">"right"</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071519537.png" srcset="/img/loading.gif" lazyload alt=""></p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs R">anole.tree<span class="hljs-operator">&lt;-</span>read.tree<span class="hljs-punctuation">(</span><span class="hljs-string">"http://www.phytools.org/eqg2015/data/anole.tre"</span><span class="hljs-punctuation">)</span><br>svl <span class="hljs-operator">&lt;-</span> read.csv<span class="hljs-punctuation">(</span><span class="hljs-string">"http://www.phytools.org/eqg2015/data/svl.csv"</span><span class="hljs-punctuation">,</span><br>                row.names<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-punctuation">)</span><br>svl <span class="hljs-operator">&lt;-</span> as.matrix<span class="hljs-punctuation">(</span>svl<span class="hljs-punctuation">)</span><span class="hljs-punctuation">[</span><span class="hljs-punctuation">,</span><span class="hljs-number">1</span><span class="hljs-punctuation">]</span><br>fit <span class="hljs-operator">&lt;-</span> phytools<span class="hljs-operator">::</span>fastAnc<span class="hljs-punctuation">(</span>anole.tree<span class="hljs-punctuation">,</span>svl<span class="hljs-punctuation">,</span>vars<span class="hljs-operator">=</span><span class="hljs-literal">TRUE</span><span class="hljs-punctuation">,</span>CI<span class="hljs-operator">=</span><span class="hljs-literal">TRUE</span><span class="hljs-punctuation">)</span><br><br>td <span class="hljs-operator">&lt;-</span> data.frame<span class="hljs-punctuation">(</span>node <span class="hljs-operator">=</span> nodeid<span class="hljs-punctuation">(</span>anole.tree<span class="hljs-punctuation">,</span> <span class="hljs-built_in">names</span><span class="hljs-punctuation">(</span>svl<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>                 trait <span class="hljs-operator">=</span> svl<span class="hljs-punctuation">)</span><br>nd <span class="hljs-operator">&lt;-</span> data.frame<span class="hljs-punctuation">(</span>node <span class="hljs-operator">=</span> <span class="hljs-built_in">names</span><span class="hljs-punctuation">(</span>fit<span class="hljs-operator">$</span>ace<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> trait <span class="hljs-operator">=</span> fit<span class="hljs-operator">$</span>ace<span class="hljs-punctuation">)</span><br><br>d <span class="hljs-operator">&lt;-</span> rbind<span class="hljs-punctuation">(</span>td<span class="hljs-punctuation">,</span> nd<span class="hljs-punctuation">)</span><br>d<span class="hljs-operator">$</span>node <span class="hljs-operator">&lt;-</span> <span class="hljs-built_in">as.numeric</span><span class="hljs-punctuation">(</span>d<span class="hljs-operator">$</span>node<span class="hljs-punctuation">)</span><br>tree <span class="hljs-operator">&lt;-</span> full_join<span class="hljs-punctuation">(</span>anole.tree<span class="hljs-punctuation">,</span> d<span class="hljs-punctuation">,</span> by <span class="hljs-operator">=</span> <span class="hljs-string">'node'</span><span class="hljs-punctuation">)</span><br><br>p1 <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">,</span> aes<span class="hljs-punctuation">(</span>color<span class="hljs-operator">=</span>trait<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> layout <span class="hljs-operator">=</span> <span class="hljs-string">'circular'</span><span class="hljs-punctuation">,</span> <br>             ladderize <span class="hljs-operator">=</span> <span class="hljs-literal">FALSE</span><span class="hljs-punctuation">,</span> continuous <span class="hljs-operator">=</span> <span class="hljs-literal">TRUE</span><span class="hljs-punctuation">,</span> size<span class="hljs-operator">=</span><span class="hljs-number">2</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  scale_color_gradientn<span class="hljs-punctuation">(</span>colours<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"red"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">'orange'</span><span class="hljs-punctuation">,</span> <span class="hljs-string">'green'</span><span class="hljs-punctuation">,</span> <span class="hljs-string">'cyan'</span><span class="hljs-punctuation">,</span> <span class="hljs-string">'blue'</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_tiplab<span class="hljs-punctuation">(</span>hjust <span class="hljs-operator">=</span> <span class="hljs-operator">-</span><span class="hljs-number">.1</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  xlim<span class="hljs-punctuation">(</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-number">1.2</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  theme<span class="hljs-punctuation">(</span>legend.position <span class="hljs-operator">=</span> <span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-number">.05</span><span class="hljs-punctuation">,</span> <span class="hljs-number">.85</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <br><br>p2 <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">,</span> layout<span class="hljs-operator">=</span><span class="hljs-string">'circular'</span><span class="hljs-punctuation">,</span> ladderize <span class="hljs-operator">=</span> <span class="hljs-literal">FALSE</span><span class="hljs-punctuation">,</span> size<span class="hljs-operator">=</span><span class="hljs-number">2.8</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  geom_tree<span class="hljs-punctuation">(</span>aes<span class="hljs-punctuation">(</span>color<span class="hljs-operator">=</span>trait<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> continuous<span class="hljs-operator">=</span><span class="hljs-built_in">T</span><span class="hljs-punctuation">,</span> size<span class="hljs-operator">=</span><span class="hljs-number">2</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span>  <br>  scale_color_gradientn<span class="hljs-punctuation">(</span>colours<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"red"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">'orange'</span><span class="hljs-punctuation">,</span> <span class="hljs-string">'green'</span><span class="hljs-punctuation">,</span> <span class="hljs-string">'cyan'</span><span class="hljs-punctuation">,</span> <span class="hljs-string">'blue'</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_tiplab<span class="hljs-punctuation">(</span>aes<span class="hljs-punctuation">(</span>color<span class="hljs-operator">=</span>trait<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> hjust <span class="hljs-operator">=</span> <span class="hljs-operator">-</span><span class="hljs-number">.1</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  xlim<span class="hljs-punctuation">(</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-number">1.2</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  theme<span class="hljs-punctuation">(</span>legend.position <span class="hljs-operator">=</span> <span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-number">.05</span><span class="hljs-punctuation">,</span> <span class="hljs-number">.85</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <br><br>cowplot<span class="hljs-operator">::</span>plot_grid<span class="hljs-punctuation">(</span>p1<span class="hljs-punctuation">,</span> p2<span class="hljs-punctuation">,</span> ncol<span class="hljs-operator">=</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span> labels<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"分支默认边框"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"分支黑色边框"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span>    <br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071519693.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h4 id="对树进行重新标准化"><a href="#对树进行重新标准化" class="headerlink" title="对树进行重新标准化"></a>对树进行重新标准化</h4><p>多个参数对进化树进行标准化，时间序列相关的参数用<code>msrd</code>，其余的参数可以用<code>branch.length</code>。</p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs R">library<span class="hljs-punctuation">(</span>treeio<span class="hljs-punctuation">)</span><br>beast_file <span class="hljs-operator">&lt;-</span> system.file<span class="hljs-punctuation">(</span><span class="hljs-string">"examples/MCC_FluA_H3.tree"</span><span class="hljs-punctuation">,</span> package<span class="hljs-operator">=</span><span class="hljs-string">"ggtree"</span><span class="hljs-punctuation">)</span><br>beast_tree <span class="hljs-operator">&lt;-</span> read.beast<span class="hljs-punctuation">(</span>beast_file<span class="hljs-punctuation">)</span><br>beast_tree<br><br>p1 <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>beast_tree<span class="hljs-punctuation">,</span> mrsd<span class="hljs-operator">=</span><span class="hljs-string">'2013-01-01'</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> theme_tree2<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  labs<span class="hljs-punctuation">(</span>caption<span class="hljs-operator">=</span><span class="hljs-string">"时间序列"</span><span class="hljs-punctuation">)</span><br>p2 <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>beast_tree<span class="hljs-punctuation">,</span> branch.length<span class="hljs-operator">=</span><span class="hljs-string">'rate'</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> theme_tree2<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  labs<span class="hljs-punctuation">(</span>caption<span class="hljs-operator">=</span><span class="hljs-string">"取代速率"</span><span class="hljs-punctuation">)</span><br><br>mlcfile <span class="hljs-operator">&lt;-</span> system.file<span class="hljs-punctuation">(</span><span class="hljs-string">"extdata/PAML_Codeml"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"mlc"</span><span class="hljs-punctuation">,</span> package<span class="hljs-operator">=</span><span class="hljs-string">"treeio"</span><span class="hljs-punctuation">)</span><br>mlc_tree <span class="hljs-operator">&lt;-</span> read.codeml_mlc<span class="hljs-punctuation">(</span>mlcfile<span class="hljs-punctuation">)</span><br>p3 <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>mlc_tree<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> theme_tree2<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  labs<span class="hljs-punctuation">(</span>caption<span class="hljs-operator">=</span><span class="hljs-string">"单密码子核苷酸取代"</span><span class="hljs-punctuation">)</span><br>p4 <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>mlc_tree<span class="hljs-punctuation">,</span> branch.length<span class="hljs-operator">=</span><span class="hljs-string">'dN_vs_dS'</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> theme_tree2<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  labs<span class="hljs-punctuation">(</span>caption<span class="hljs-operator">=</span><span class="hljs-string">"dN/dS"</span><span class="hljs-punctuation">)</span><br><br>cowplot<span class="hljs-operator">::</span>plot_grid<span class="hljs-punctuation">(</span>p1<span class="hljs-punctuation">,</span>p2<span class="hljs-punctuation">,</span>p3<span class="hljs-punctuation">,</span>p4<span class="hljs-punctuation">,</span> ncol <span class="hljs-operator">=</span> <span class="hljs-number">2</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071519795.png" srcset="/img/loading.gif" lazyload alt=""></p>
<p>也可以用<code>rescale_tree</code>对树进行标准化：</p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R">beast_tree2 <span class="hljs-operator">&lt;-</span> rescale_tree<span class="hljs-punctuation">(</span>beast_tree<span class="hljs-punctuation">,</span> branch.length<span class="hljs-operator">=</span><span class="hljs-string">'rate'</span><span class="hljs-punctuation">)</span><br>ggtree<span class="hljs-punctuation">(</span>beast_tree2<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> theme_tree2<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071519411.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h4 id="背景色"><a href="#背景色" class="headerlink" title="背景色"></a>背景色</h4><figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs R">set.seed<span class="hljs-punctuation">(</span><span class="hljs-number">2019</span><span class="hljs-punctuation">)</span><br>x <span class="hljs-operator">&lt;-</span> rtree<span class="hljs-punctuation">(</span><span class="hljs-number">30</span><span class="hljs-punctuation">)</span><br>p1 <span class="hljs-operator">=</span> ggtree<span class="hljs-punctuation">(</span>x<span class="hljs-punctuation">,</span> color<span class="hljs-operator">=</span><span class="hljs-string">"red"</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> theme_tree<span class="hljs-punctuation">(</span><span class="hljs-string">"steelblue"</span><span class="hljs-punctuation">)</span><br>p2 <span class="hljs-operator">=</span> ggtree<span class="hljs-punctuation">(</span>x<span class="hljs-punctuation">,</span> color<span class="hljs-operator">=</span><span class="hljs-string">"white"</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> theme_tree<span class="hljs-punctuation">(</span><span class="hljs-string">"black"</span><span class="hljs-punctuation">)</span><br><br>cowplot<span class="hljs-operator">::</span>plot_grid<span class="hljs-punctuation">(</span>p1<span class="hljs-punctuation">,</span>p2<span class="hljs-punctuation">,</span> ncol <span class="hljs-operator">=</span> <span class="hljs-number">1</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071519108.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h4 id="批量建树"><a href="#批量建树" class="headerlink" title="批量建树"></a>批量建树</h4><p>批量建树就相当于<code>ggplot2</code>中的分面：</p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs R"><span class="hljs-comment">## trees &lt;- lapply(c(10, 20, 40), rtree)</span><br><span class="hljs-comment">## class(trees) &lt;- "multiPhylo"</span><br><span class="hljs-comment">## ggtree(trees) + facet_wrap(~.id, scale="free") + geom_tiplab()</span><br><br>r8s <span class="hljs-operator">&lt;-</span> read.r8s<span class="hljs-punctuation">(</span>system.file<span class="hljs-punctuation">(</span><span class="hljs-string">"extdata/r8s"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"H3_r8s_output.log"</span><span class="hljs-punctuation">,</span> package<span class="hljs-operator">=</span><span class="hljs-string">"treeio"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>ggtree<span class="hljs-punctuation">(</span>r8s<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> facet_wrap<span class="hljs-punctuation">(</span> <span class="hljs-operator">~</span>.id<span class="hljs-punctuation">,</span> scale<span class="hljs-operator">=</span><span class="hljs-string">"free"</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> theme_tree2<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071519298.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h2 id="进化树注释"><a href="#进化树注释" class="headerlink" title="进化树注释"></a>进化树注释</h2><h3 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h3><p>注释的信息很多，节点的分组、样品来源、基因表达量等都可以作为注释的信息。一个简单的例子：</p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs R">library<span class="hljs-punctuation">(</span>ggtree<span class="hljs-punctuation">)</span><br>treetext <span class="hljs-operator">=</span> <span class="hljs-string">"(((ADH2:0.1[&amp;&amp;NHX:S=human], ADH1:0.11[&amp;&amp;NHX:S=human]):</span><br><span class="hljs-string">0.05 [&amp;&amp;NHX:S=primates:D=Y:B=100],ADHY:</span><br><span class="hljs-string">0.1[&amp;&amp;NHX:S=nematode],ADHX:0.12 [&amp;&amp;NHX:S=insect]):</span><br><span class="hljs-string">0.1[&amp;&amp;NHX:S=metazoa:D=N],(ADH4:0.09[&amp;&amp;NHX:S=yeast],</span><br><span class="hljs-string">ADH3:0.13[&amp;&amp;NHX:S=yeast], ADH2:0.12[&amp;&amp;NHX:S=yeast],</span><br><span class="hljs-string">ADH1:0.11[&amp;&amp;NHX:S=yeast]):0.1[&amp;&amp;NHX:S=Fungi])[&amp;&amp;NHX:D=N];"</span><br>tree <span class="hljs-operator">&lt;-</span> read.nhx<span class="hljs-punctuation">(</span>textConnection<span class="hljs-punctuation">(</span>treetext<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> geom_tiplab<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  geom_label<span class="hljs-punctuation">(</span>aes<span class="hljs-punctuation">(</span>x<span class="hljs-operator">=</span>branch<span class="hljs-punctuation">,</span> label<span class="hljs-operator">=</span>S<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> fill<span class="hljs-operator">=</span><span class="hljs-string">'lightgreen'</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  geom_label<span class="hljs-punctuation">(</span>aes<span class="hljs-punctuation">(</span>label<span class="hljs-operator">=</span>D<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> fill<span class="hljs-operator">=</span><span class="hljs-string">'steelblue'</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  geom_text<span class="hljs-punctuation">(</span>aes<span class="hljs-punctuation">(</span>label<span class="hljs-operator">=</span>B<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> hjust<span class="hljs-operator">=</span><span class="hljs-operator">-</span><span class="hljs-number">.5</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071519968.png" srcset="/img/loading.gif" lazyload alt=""></p>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071519933.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h3 id="clade注释"><a href="#clade注释" class="headerlink" title="clade注释"></a><code>clade</code>注释</h3><figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs R">set.seed<span class="hljs-punctuation">(</span><span class="hljs-number">2015</span><span class="hljs-operator">-</span><span class="hljs-number">12</span><span class="hljs-operator">-</span><span class="hljs-number">21</span><span class="hljs-punctuation">)</span><br>tree <span class="hljs-operator">&lt;-</span> rtree<span class="hljs-punctuation">(</span><span class="hljs-number">30</span><span class="hljs-punctuation">)</span><br>p1 <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> xlim<span class="hljs-punctuation">(</span><span class="hljs-literal">NA</span><span class="hljs-punctuation">,</span> <span class="hljs-number">6</span><span class="hljs-punctuation">)</span><br><br>p2 <span class="hljs-operator">=</span> p1 <span class="hljs-operator">+</span> geom_cladelabel<span class="hljs-punctuation">(</span>node<span class="hljs-operator">=</span><span class="hljs-number">45</span><span class="hljs-punctuation">,</span> label<span class="hljs-operator">=</span><span class="hljs-string">"test label"</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_cladelabel<span class="hljs-punctuation">(</span>node<span class="hljs-operator">=</span><span class="hljs-number">34</span><span class="hljs-punctuation">,</span> label<span class="hljs-operator">=</span><span class="hljs-string">"another clade"</span><span class="hljs-punctuation">)</span><br><br>p3 <span class="hljs-operator">=</span> p1 <span class="hljs-operator">+</span> geom_cladelabel<span class="hljs-punctuation">(</span>node<span class="hljs-operator">=</span><span class="hljs-number">45</span><span class="hljs-punctuation">,</span> label<span class="hljs-operator">=</span><span class="hljs-string">"test label"</span><span class="hljs-punctuation">,</span> align<span class="hljs-operator">=</span><span class="hljs-literal">TRUE</span><span class="hljs-punctuation">,</span>  offset <span class="hljs-operator">=</span> <span class="hljs-number">.2</span><span class="hljs-punctuation">,</span> color<span class="hljs-operator">=</span><span class="hljs-string">'red'</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_cladelabel<span class="hljs-punctuation">(</span>node<span class="hljs-operator">=</span><span class="hljs-number">34</span><span class="hljs-punctuation">,</span> label<span class="hljs-operator">=</span><span class="hljs-string">"another clade"</span><span class="hljs-punctuation">,</span> align<span class="hljs-operator">=</span><span class="hljs-literal">TRUE</span><span class="hljs-punctuation">,</span> offset <span class="hljs-operator">=</span> <span class="hljs-number">.2</span><span class="hljs-punctuation">,</span> color<span class="hljs-operator">=</span><span class="hljs-string">'blue'</span><span class="hljs-punctuation">)</span><br><br>p4 <span class="hljs-operator">=</span> p1 <span class="hljs-operator">+</span> geom_cladelabel<span class="hljs-punctuation">(</span>node<span class="hljs-operator">=</span><span class="hljs-number">45</span><span class="hljs-punctuation">,</span> label<span class="hljs-operator">=</span><span class="hljs-string">"test label"</span><span class="hljs-punctuation">,</span> align<span class="hljs-operator">=</span><span class="hljs-built_in">T</span><span class="hljs-punctuation">,</span> angle<span class="hljs-operator">=</span><span class="hljs-number">270</span><span class="hljs-punctuation">,</span> hjust<span class="hljs-operator">=</span><span class="hljs-string">'center'</span><span class="hljs-punctuation">,</span> offset.text<span class="hljs-operator">=</span><span class="hljs-number">.5</span><span class="hljs-punctuation">,</span> barsize<span class="hljs-operator">=</span><span class="hljs-number">1.5</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_cladelabel<span class="hljs-punctuation">(</span>node<span class="hljs-operator">=</span><span class="hljs-number">34</span><span class="hljs-punctuation">,</span> label<span class="hljs-operator">=</span><span class="hljs-string">"another clade"</span><span class="hljs-punctuation">,</span> align<span class="hljs-operator">=</span><span class="hljs-built_in">T</span><span class="hljs-punctuation">,</span> angle<span class="hljs-operator">=</span><span class="hljs-number">45</span><span class="hljs-punctuation">,</span> fontsize<span class="hljs-operator">=</span><span class="hljs-number">8</span><span class="hljs-punctuation">)</span><br><br>p5 <span class="hljs-operator">=</span> p1 <span class="hljs-operator">+</span> geom_cladelabel<span class="hljs-punctuation">(</span>node<span class="hljs-operator">=</span><span class="hljs-number">34</span><span class="hljs-punctuation">,</span> label<span class="hljs-operator">=</span><span class="hljs-string">"another clade"</span><span class="hljs-punctuation">,</span> align<span class="hljs-operator">=</span><span class="hljs-built_in">T</span><span class="hljs-punctuation">,</span> geom<span class="hljs-operator">=</span><span class="hljs-string">'label'</span><span class="hljs-punctuation">,</span> fill<span class="hljs-operator">=</span><span class="hljs-string">'lightblue'</span><span class="hljs-punctuation">)</span><br><br>cowplot<span class="hljs-operator">::</span>plot_grid<span class="hljs-punctuation">(</span>p2<span class="hljs-punctuation">,</span>p3<span class="hljs-punctuation">,</span>p4<span class="hljs-punctuation">,</span>p5<span class="hljs-punctuation">,</span>ncol <span class="hljs-operator">=</span> <span class="hljs-number">2</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071519773.png" srcset="/img/loading.gif" lazyload alt=""></p>
<p>同样也适用于无根输出样式，可以根据<code>node</code>的编号，也可以直接用<code>tips</code>的标签（这个是真的赞啊）：</p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs R">p1 <span class="hljs-operator">=</span> ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">,</span> layout<span class="hljs-operator">=</span><span class="hljs-string">"daylight"</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  geom_cladelabel<span class="hljs-punctuation">(</span>node<span class="hljs-operator">=</span><span class="hljs-number">35</span><span class="hljs-punctuation">,</span> label<span class="hljs-operator">=</span><span class="hljs-string">"test label"</span><span class="hljs-punctuation">,</span> angle<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <br>                  fontsize<span class="hljs-operator">=</span><span class="hljs-number">8</span><span class="hljs-punctuation">,</span> offset<span class="hljs-operator">=</span><span class="hljs-number">.5</span><span class="hljs-punctuation">,</span> vjust<span class="hljs-operator">=</span><span class="hljs-number">.5</span><span class="hljs-punctuation">)</span>  <span class="hljs-operator">+</span> <br>  geom_cladelabel<span class="hljs-punctuation">(</span>node<span class="hljs-operator">=</span><span class="hljs-number">55</span><span class="hljs-punctuation">,</span> label<span class="hljs-operator">=</span><span class="hljs-string">'another clade'</span><span class="hljs-punctuation">,</span> <br>                  angle<span class="hljs-operator">=</span><span class="hljs-operator">-</span><span class="hljs-number">95</span><span class="hljs-punctuation">,</span> hjust<span class="hljs-operator">=</span><span class="hljs-number">.5</span><span class="hljs-punctuation">,</span> fontsize<span class="hljs-operator">=</span><span class="hljs-number">8</span><span class="hljs-punctuation">)</span><br><br><br>p2 <span class="hljs-operator">=</span> ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> xlim<span class="hljs-punctuation">(</span><span class="hljs-literal">NA</span><span class="hljs-punctuation">,</span> <span class="hljs-number">6</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  geom_tiplab<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  geom_strip<span class="hljs-punctuation">(</span><span class="hljs-string">'t10'</span><span class="hljs-punctuation">,</span> <span class="hljs-string">'t30'</span><span class="hljs-punctuation">,</span> barsize<span class="hljs-operator">=</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span> color<span class="hljs-operator">=</span><span class="hljs-string">'red'</span><span class="hljs-punctuation">,</span> <br>             label<span class="hljs-operator">=</span><span class="hljs-string">"associated taxa"</span><span class="hljs-punctuation">,</span> offset.text<span class="hljs-operator">=</span><span class="hljs-number">.1</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  geom_strip<span class="hljs-punctuation">(</span><span class="hljs-string">'t1'</span><span class="hljs-punctuation">,</span> <span class="hljs-string">'t18'</span><span class="hljs-punctuation">,</span> barsize<span class="hljs-operator">=</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span> color<span class="hljs-operator">=</span><span class="hljs-string">'blue'</span><span class="hljs-punctuation">,</span> <br>             label <span class="hljs-operator">=</span> <span class="hljs-string">"another label"</span><span class="hljs-punctuation">,</span> offset.text<span class="hljs-operator">=</span><span class="hljs-number">.1</span><span class="hljs-punctuation">)</span><br><br>cowplot<span class="hljs-operator">::</span>plot_grid<span class="hljs-punctuation">(</span>p1<span class="hljs-punctuation">,</span>p2<span class="hljs-punctuation">,</span>ncol <span class="hljs-operator">=</span> <span class="hljs-number">2</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071519919.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h3 id="局部高亮"><a href="#局部高亮" class="headerlink" title="局部高亮"></a>局部高亮</h3><p>局部高亮可以根据<code>node</code>编号进行高亮，也可以使用附加数据或树数据里面的数据进行高亮：</p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs R">nwk <span class="hljs-operator">&lt;-</span> system.file<span class="hljs-punctuation">(</span><span class="hljs-string">"extdata"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"sample.nwk"</span><span class="hljs-punctuation">,</span> package<span class="hljs-operator">=</span><span class="hljs-string">"treeio"</span><span class="hljs-punctuation">)</span><br>tree <span class="hljs-operator">&lt;-</span> read.tree<span class="hljs-punctuation">(</span>nwk<span class="hljs-punctuation">)</span><br><br>p1 <span class="hljs-operator">=</span> ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  geom_hilight<span class="hljs-punctuation">(</span>node<span class="hljs-operator">=</span><span class="hljs-number">21</span><span class="hljs-punctuation">,</span> fill<span class="hljs-operator">=</span><span class="hljs-string">"steelblue"</span><span class="hljs-punctuation">,</span> alpha<span class="hljs-operator">=</span><span class="hljs-number">.6</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_hilight<span class="hljs-punctuation">(</span>node<span class="hljs-operator">=</span><span class="hljs-number">17</span><span class="hljs-punctuation">,</span> fill<span class="hljs-operator">=</span><span class="hljs-string">"darkgreen"</span><span class="hljs-punctuation">,</span> alpha<span class="hljs-operator">=</span><span class="hljs-number">.6</span><span class="hljs-punctuation">)</span> <br><br>p2 <span class="hljs-operator">=</span> ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">,</span> layout<span class="hljs-operator">=</span><span class="hljs-string">"circular"</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  geom_hilight<span class="hljs-punctuation">(</span>node<span class="hljs-operator">=</span><span class="hljs-number">21</span><span class="hljs-punctuation">,</span> fill<span class="hljs-operator">=</span><span class="hljs-string">"steelblue"</span><span class="hljs-punctuation">,</span> alpha<span class="hljs-operator">=</span><span class="hljs-number">.6</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_hilight<span class="hljs-punctuation">(</span>node<span class="hljs-operator">=</span><span class="hljs-number">23</span><span class="hljs-punctuation">,</span> fill<span class="hljs-operator">=</span><span class="hljs-string">"darkgreen"</span><span class="hljs-punctuation">,</span> alpha<span class="hljs-operator">=</span><span class="hljs-number">.6</span><span class="hljs-punctuation">)</span><br><br><span class="hljs-comment">## type can be 'encircle' or 'rect'</span><br>ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">,</span> layout<span class="hljs-operator">=</span><span class="hljs-string">"daylight"</span><span class="hljs-punctuation">,</span> branch.length <span class="hljs-operator">=</span> <span class="hljs-string">'none'</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  geom_hilight<span class="hljs-punctuation">(</span>node<span class="hljs-operator">=</span><span class="hljs-number">10</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  geom_hilight<span class="hljs-punctuation">(</span>node<span class="hljs-operator">=</span><span class="hljs-number">16</span><span class="hljs-punctuation">,</span> fill<span class="hljs-operator">=</span><span class="hljs-string">'darkgreen'</span><span class="hljs-punctuation">,</span> type<span class="hljs-operator">=</span><span class="hljs-string">"rect"</span><span class="hljs-punctuation">)</span><br><br><br>ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_balance<span class="hljs-punctuation">(</span>node<span class="hljs-operator">=</span><span class="hljs-number">16</span><span class="hljs-punctuation">,</span> fill<span class="hljs-operator">=</span><span class="hljs-string">'steelblue'</span><span class="hljs-punctuation">,</span> color<span class="hljs-operator">=</span><span class="hljs-string">'white'</span><span class="hljs-punctuation">,</span> alpha<span class="hljs-operator">=</span><span class="hljs-number">0.6</span><span class="hljs-punctuation">,</span> extend<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_balance<span class="hljs-punctuation">(</span>node<span class="hljs-operator">=</span><span class="hljs-number">19</span><span class="hljs-punctuation">,</span> fill<span class="hljs-operator">=</span><span class="hljs-string">'darkgreen'</span><span class="hljs-punctuation">,</span> color<span class="hljs-operator">=</span><span class="hljs-string">'white'</span><span class="hljs-punctuation">,</span> alpha<span class="hljs-operator">=</span><span class="hljs-number">0.6</span><span class="hljs-punctuation">,</span> extend<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-punctuation">)</span> <br><br><span class="hljs-comment">## using external data</span><br>d <span class="hljs-operator">&lt;-</span> data.frame<span class="hljs-punctuation">(</span>node<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-number">17</span><span class="hljs-punctuation">,</span> <span class="hljs-number">21</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> type<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"A"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"B"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> geom_hilight<span class="hljs-punctuation">(</span>data<span class="hljs-operator">=</span>d<span class="hljs-punctuation">,</span> aes<span class="hljs-punctuation">(</span>node<span class="hljs-operator">=</span>node<span class="hljs-punctuation">,</span> fill<span class="hljs-operator">=</span>type<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br><br><span class="hljs-comment">## using data stored in tree object</span><br>x <span class="hljs-operator">&lt;-</span> read.nhx<span class="hljs-punctuation">(</span>system.file<span class="hljs-punctuation">(</span><span class="hljs-string">"extdata/NHX/ADH.nhx"</span><span class="hljs-punctuation">,</span> package<span class="hljs-operator">=</span><span class="hljs-string">"treeio"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>ggtree<span class="hljs-punctuation">(</span>x<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  geom_hilight<span class="hljs-punctuation">(</span>mapping<span class="hljs-operator">=</span>aes<span class="hljs-punctuation">(</span>subset <span class="hljs-operator">=</span> node <span class="hljs-operator">%in%</span> <span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-number">10</span><span class="hljs-punctuation">,</span> <span class="hljs-number">12</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> fill <span class="hljs-operator">=</span> S<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  scale_fill_manual<span class="hljs-punctuation">(</span>values<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"steelblue"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"darkgreen"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071519551.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h3 id="高亮不同分组"><a href="#高亮不同分组" class="headerlink" title="高亮不同分组"></a>高亮不同分组</h3><figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs R">mytree <span class="hljs-operator">&lt;-</span> read.tree<span class="hljs-punctuation">(</span><span class="hljs-string">"data/Tree 30.4.19.nwk"</span><span class="hljs-punctuation">)</span><br><br><span class="hljs-comment"># Define nodes for coloring later on</span><br>tiplab <span class="hljs-operator">&lt;-</span> mytree<span class="hljs-operator">$</span>tip.label<br>cls <span class="hljs-operator">&lt;-</span> tiplab<span class="hljs-punctuation">[</span>grep<span class="hljs-punctuation">(</span><span class="hljs-string">"^ch"</span><span class="hljs-punctuation">,</span> tiplab<span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span> <br>labeltree <span class="hljs-operator">&lt;-</span> groupOTU<span class="hljs-punctuation">(</span>mytree<span class="hljs-punctuation">,</span> cls<span class="hljs-punctuation">)</span><br><br>p <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>labeltree<span class="hljs-punctuation">,</span> aes<span class="hljs-punctuation">(</span>color<span class="hljs-operator">=</span>group<span class="hljs-punctuation">,</span> linetype<span class="hljs-operator">=</span>group<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> layout<span class="hljs-operator">=</span><span class="hljs-string">"circular"</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>    scale_color_manual<span class="hljs-punctuation">(</span>values <span class="hljs-operator">=</span> <span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"#efad29"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"#63bbd4"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>    geom_nodepoint<span class="hljs-punctuation">(</span>color<span class="hljs-operator">=</span><span class="hljs-string">"black"</span><span class="hljs-punctuation">,</span> size<span class="hljs-operator">=</span><span class="hljs-number">0.1</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>    geom_tiplab<span class="hljs-punctuation">(</span>size<span class="hljs-operator">=</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span> color<span class="hljs-operator">=</span><span class="hljs-string">"black"</span><span class="hljs-punctuation">)</span><br><br>p2 <span class="hljs-operator">&lt;-</span> flip<span class="hljs-punctuation">(</span>p<span class="hljs-punctuation">,</span> <span class="hljs-number">136</span><span class="hljs-punctuation">,</span> <span class="hljs-number">110</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> <br>    flip<span class="hljs-punctuation">(</span><span class="hljs-number">141</span><span class="hljs-punctuation">,</span> <span class="hljs-number">145</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> <br>    rotate<span class="hljs-punctuation">(</span><span class="hljs-number">141</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> <br>    rotate<span class="hljs-punctuation">(</span><span class="hljs-number">142</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> <br>    rotate<span class="hljs-punctuation">(</span><span class="hljs-number">160</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> <br>    rotate<span class="hljs-punctuation">(</span><span class="hljs-number">164</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> <br>    rotate<span class="hljs-punctuation">(</span><span class="hljs-number">131</span><span class="hljs-punctuation">)</span><br><br><span class="hljs-comment">### Group V and II coloring </span><br>p3 <span class="hljs-operator">&lt;-</span> p2 <span class="hljs-operator">+</span> geom_hilight<span class="hljs-punctuation">(</span>node <span class="hljs-operator">=</span> <span class="hljs-number">110</span><span class="hljs-punctuation">,</span> fill <span class="hljs-operator">=</span> <span class="hljs-string">"#229f8a"</span><span class="hljs-punctuation">,</span> alpha <span class="hljs-operator">=</span> <span class="hljs-number">0.2</span><span class="hljs-punctuation">,</span> extend <span class="hljs-operator">=</span> <span class="hljs-number">0.43</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span>    <br>    geom_hilight<span class="hljs-punctuation">(</span>node <span class="hljs-operator">=</span> <span class="hljs-number">88</span><span class="hljs-punctuation">,</span> fill <span class="hljs-operator">=</span> <span class="hljs-string">"#229f8a"</span><span class="hljs-punctuation">,</span> alpha <span class="hljs-operator">=</span> <span class="hljs-number">0.2</span><span class="hljs-punctuation">,</span> extend <span class="hljs-operator">=</span> <span class="hljs-number">0.445</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>    geom_hilight<span class="hljs-punctuation">(</span>node <span class="hljs-operator">=</span> <span class="hljs-number">156</span><span class="hljs-punctuation">,</span> fill <span class="hljs-operator">=</span> <span class="hljs-string">"#229f8a"</span><span class="hljs-punctuation">,</span> alpha <span class="hljs-operator">=</span> <span class="hljs-number">0.2</span><span class="hljs-punctuation">,</span> extend <span class="hljs-operator">=</span> <span class="hljs-number">0.35</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>    geom_hilight<span class="hljs-punctuation">(</span>node <span class="hljs-operator">=</span> <span class="hljs-number">136</span><span class="hljs-punctuation">,</span> fill <span class="hljs-operator">=</span> <span class="hljs-string">"#f9311f"</span><span class="hljs-punctuation">,</span> alpha <span class="hljs-operator">=</span> <span class="hljs-number">0.2</span><span class="hljs-punctuation">,</span> extend <span class="hljs-operator">=</span> <span class="hljs-number">0.512</span><span class="hljs-punctuation">)</span><br><br><span class="hljs-comment">### Putting on a label on the avian specific expansion </span><br>p4 <span class="hljs-operator">&lt;-</span> p3 <span class="hljs-operator">+</span> geom_cladelabel<span class="hljs-punctuation">(</span>node <span class="hljs-operator">=</span> <span class="hljs-number">113</span><span class="hljs-punctuation">,</span> label <span class="hljs-operator">=</span> <span class="hljs-string">"Avian-specific expansion"</span><span class="hljs-punctuation">,</span> <br>                        align <span class="hljs-operator">=</span> <span class="hljs-literal">TRUE</span><span class="hljs-punctuation">,</span> angle <span class="hljs-operator">=</span> <span class="hljs-operator">-</span><span class="hljs-number">35</span><span class="hljs-punctuation">,</span> offset.text <span class="hljs-operator">=</span> <span class="hljs-number">0.05</span><span class="hljs-punctuation">,</span> <br>                        hjust <span class="hljs-operator">=</span> <span class="hljs-string">"center"</span><span class="hljs-punctuation">,</span> fontsize <span class="hljs-operator">=</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span>  offset <span class="hljs-operator">=</span> <span class="hljs-number">0.2</span><span class="hljs-punctuation">,</span> barsize <span class="hljs-operator">=</span> <span class="hljs-number">0.2</span><span class="hljs-punctuation">)</span><br>    <br><span class="hljs-comment">### Adding the bootstrap values with subset used to remove all bootstraps &lt; 50  </span><br>p5 <span class="hljs-operator">&lt;-</span> p4 <span class="hljs-operator">+</span> geom_text2<span class="hljs-punctuation">(</span>aes<span class="hljs-punctuation">(</span>label<span class="hljs-operator">=</span>label<span class="hljs-punctuation">,</span> <br>                        subset <span class="hljs-operator">=</span> <span class="hljs-operator">!</span><span class="hljs-built_in">is.na</span><span class="hljs-punctuation">(</span><span class="hljs-built_in">as.numeric</span><span class="hljs-punctuation">(</span>label<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">&amp;</span> <span class="hljs-built_in">as.numeric</span><span class="hljs-punctuation">(</span>label<span class="hljs-punctuation">)</span> <span class="hljs-operator">&gt;</span> <span class="hljs-number">50</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> <br>                    size <span class="hljs-operator">=</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span> color <span class="hljs-operator">=</span> <span class="hljs-string">"black"</span><span class="hljs-punctuation">,</span>nudge_y <span class="hljs-operator">=</span> <span class="hljs-number">0.7</span><span class="hljs-punctuation">,</span> nudge_x <span class="hljs-operator">=</span> <span class="hljs-operator">-</span><span class="hljs-number">0.05</span><span class="hljs-punctuation">)</span><br> <br><span class="hljs-comment">### Putting labels on the subgroups </span><br>p6 <span class="hljs-operator">&lt;-</span> p5 <span class="hljs-operator">+</span> geom_cladelabel<span class="hljs-punctuation">(</span>node <span class="hljs-operator">=</span> <span class="hljs-number">114</span><span class="hljs-punctuation">,</span> label <span class="hljs-operator">=</span> <span class="hljs-string">"Subgroup A"</span><span class="hljs-punctuation">,</span> align <span class="hljs-operator">=</span> <span class="hljs-literal">TRUE</span><span class="hljs-punctuation">,</span> <br>                        angle <span class="hljs-operator">=</span> <span class="hljs-operator">-</span><span class="hljs-number">55</span><span class="hljs-punctuation">,</span> offset.text <span class="hljs-operator">=</span> <span class="hljs-number">.03</span><span class="hljs-punctuation">,</span> hjust <span class="hljs-operator">=</span> <span class="hljs-string">"center"</span><span class="hljs-punctuation">,</span> <br>                        offset <span class="hljs-operator">=</span> <span class="hljs-number">0.05</span><span class="hljs-punctuation">,</span> barsize <span class="hljs-operator">=</span> <span class="hljs-number">0.2</span><span class="hljs-punctuation">,</span> fontsize <span class="hljs-operator">=</span> <span class="hljs-number">2</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>            geom_cladelabel<span class="hljs-punctuation">(</span>node <span class="hljs-operator">=</span> <span class="hljs-number">121</span><span class="hljs-punctuation">,</span> label <span class="hljs-operator">=</span> <span class="hljs-string">"Subgroup B"</span><span class="hljs-punctuation">,</span> align <span class="hljs-operator">=</span> <span class="hljs-literal">TRUE</span><span class="hljs-punctuation">,</span> <br>                        angle <span class="hljs-operator">=</span> <span class="hljs-operator">-</span><span class="hljs-number">15</span><span class="hljs-punctuation">,</span> offset.text <span class="hljs-operator">=</span> <span class="hljs-number">.03</span><span class="hljs-punctuation">,</span> hjust <span class="hljs-operator">=</span> <span class="hljs-string">"center"</span><span class="hljs-punctuation">,</span> <br>                        offset <span class="hljs-operator">=</span> <span class="hljs-number">0.05</span><span class="hljs-punctuation">,</span> barsize <span class="hljs-operator">=</span> <span class="hljs-number">0.2</span><span class="hljs-punctuation">,</span> fontsize <span class="hljs-operator">=</span> <span class="hljs-number">2</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>            theme<span class="hljs-punctuation">(</span>legend.position<span class="hljs-operator">=</span><span class="hljs-string">"none"</span><span class="hljs-punctuation">,</span> <br>                plot.margin<span class="hljs-operator">=</span>grid<span class="hljs-operator">::</span>unit<span class="hljs-punctuation">(</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-operator">-</span><span class="hljs-number">15</span><span class="hljs-punctuation">,</span><span class="hljs-operator">-</span><span class="hljs-number">15</span><span class="hljs-punctuation">,</span><span class="hljs-operator">-</span><span class="hljs-number">15</span><span class="hljs-punctuation">,</span><span class="hljs-operator">-</span><span class="hljs-number">15</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"mm"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br><br>print<span class="hljs-punctuation">(</span>p6<span class="hljs-punctuation">)</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071519474.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h3 id="样品连接"><a href="#样品连接" class="headerlink" title="样品连接"></a>样品连接</h3><p>利用函数<code>geom_taxalink()</code>可以实现样品之间的连线，但是只支持有限的几种形式：</p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs R">p1 <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> geom_tiplab<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  geom_taxalink<span class="hljs-punctuation">(</span>taxa1<span class="hljs-operator">=</span><span class="hljs-string">'A'</span><span class="hljs-punctuation">,</span> taxa2<span class="hljs-operator">=</span><span class="hljs-string">'E'</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  geom_taxalink<span class="hljs-punctuation">(</span>taxa1<span class="hljs-operator">=</span><span class="hljs-string">'F'</span><span class="hljs-punctuation">,</span> taxa2<span class="hljs-operator">=</span><span class="hljs-string">'K'</span><span class="hljs-punctuation">,</span> <br>                color<span class="hljs-operator">=</span><span class="hljs-string">'red'</span><span class="hljs-punctuation">,</span> linetype <span class="hljs-operator">=</span> <span class="hljs-string">'dashed'</span><span class="hljs-punctuation">,</span><br>                arrow<span class="hljs-operator">=</span>arrow<span class="hljs-punctuation">(</span><span class="hljs-built_in">length</span><span class="hljs-operator">=</span>unit<span class="hljs-punctuation">(</span><span class="hljs-number">0.02</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"npc"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br><br>p2 <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">,</span> layout<span class="hljs-operator">=</span><span class="hljs-string">"circular"</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  geom_taxalink<span class="hljs-punctuation">(</span>taxa1<span class="hljs-operator">=</span><span class="hljs-string">'A'</span><span class="hljs-punctuation">,</span> taxa2<span class="hljs-operator">=</span><span class="hljs-string">'E'</span><span class="hljs-punctuation">,</span> <br>                color<span class="hljs-operator">=</span><span class="hljs-string">"grey"</span><span class="hljs-punctuation">,</span>alpha<span class="hljs-operator">=</span><span class="hljs-number">0.5</span><span class="hljs-punctuation">,</span> <br>                offset<span class="hljs-operator">=</span><span class="hljs-number">0.05</span><span class="hljs-punctuation">,</span>arrow<span class="hljs-operator">=</span>arrow<span class="hljs-punctuation">(</span><span class="hljs-built_in">length</span><span class="hljs-operator">=</span>unit<span class="hljs-punctuation">(</span><span class="hljs-number">0.01</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"npc"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  geom_taxalink<span class="hljs-punctuation">(</span>taxa1<span class="hljs-operator">=</span><span class="hljs-string">'F'</span><span class="hljs-punctuation">,</span> taxa2<span class="hljs-operator">=</span><span class="hljs-string">'K'</span><span class="hljs-punctuation">,</span> <br>                color<span class="hljs-operator">=</span><span class="hljs-string">'red'</span><span class="hljs-punctuation">,</span> linetype <span class="hljs-operator">=</span> <span class="hljs-string">'dashed'</span><span class="hljs-punctuation">,</span> <br>                alpha<span class="hljs-operator">=</span><span class="hljs-number">0.5</span><span class="hljs-punctuation">,</span> offset<span class="hljs-operator">=</span><span class="hljs-number">0.05</span><span class="hljs-punctuation">,</span><br>                arrow<span class="hljs-operator">=</span>arrow<span class="hljs-punctuation">(</span><span class="hljs-built_in">length</span><span class="hljs-operator">=</span>unit<span class="hljs-punctuation">(</span><span class="hljs-number">0.01</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"npc"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_taxalink<span class="hljs-punctuation">(</span>taxa1<span class="hljs-operator">=</span><span class="hljs-string">"L"</span><span class="hljs-punctuation">,</span> taxa2<span class="hljs-operator">=</span><span class="hljs-string">"M"</span><span class="hljs-punctuation">,</span> <br>                color<span class="hljs-operator">=</span><span class="hljs-string">"blue"</span><span class="hljs-punctuation">,</span> alpha<span class="hljs-operator">=</span><span class="hljs-number">0.5</span><span class="hljs-punctuation">,</span> <br>                offset<span class="hljs-operator">=</span><span class="hljs-number">0.05</span><span class="hljs-punctuation">,</span>hratio<span class="hljs-operator">=</span><span class="hljs-number">0.8</span><span class="hljs-punctuation">,</span> <br>                arrow<span class="hljs-operator">=</span>arrow<span class="hljs-punctuation">(</span><span class="hljs-built_in">length</span><span class="hljs-operator">=</span>unit<span class="hljs-punctuation">(</span><span class="hljs-number">0.01</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"npc"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  geom_tiplab<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br><br><span class="hljs-comment"># when the tree was created using reverse x, </span><br><span class="hljs-comment"># we can set outward to FALSE, which will generate the inward curve lines.</span><br>p3 <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">,</span> layout<span class="hljs-operator">=</span><span class="hljs-string">"inward_circular"</span><span class="hljs-punctuation">,</span> xlim<span class="hljs-operator">=</span><span class="hljs-number">150</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_taxalink<span class="hljs-punctuation">(</span>taxa1<span class="hljs-operator">=</span><span class="hljs-string">'A'</span><span class="hljs-punctuation">,</span> taxa2<span class="hljs-operator">=</span><span class="hljs-string">'E'</span><span class="hljs-punctuation">,</span> <br>                color<span class="hljs-operator">=</span><span class="hljs-string">"grey"</span><span class="hljs-punctuation">,</span> alpha<span class="hljs-operator">=</span><span class="hljs-number">0.5</span><span class="hljs-punctuation">,</span> <br>                offset<span class="hljs-operator">=</span><span class="hljs-operator">-</span><span class="hljs-number">0.2</span><span class="hljs-punctuation">,</span> <br>                outward<span class="hljs-operator">=</span><span class="hljs-literal">FALSE</span><span class="hljs-punctuation">,</span><br>                arrow<span class="hljs-operator">=</span>arrow<span class="hljs-punctuation">(</span><span class="hljs-built_in">length</span><span class="hljs-operator">=</span>unit<span class="hljs-punctuation">(</span><span class="hljs-number">0.01</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"npc"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_taxalink<span class="hljs-punctuation">(</span>taxa1<span class="hljs-operator">=</span><span class="hljs-string">'F'</span><span class="hljs-punctuation">,</span> taxa2<span class="hljs-operator">=</span><span class="hljs-string">'K'</span><span class="hljs-punctuation">,</span> <br>                color<span class="hljs-operator">=</span><span class="hljs-string">'red'</span><span class="hljs-punctuation">,</span> linetype <span class="hljs-operator">=</span> <span class="hljs-string">'dashed'</span><span class="hljs-punctuation">,</span> <br>                alpha<span class="hljs-operator">=</span><span class="hljs-number">0.5</span><span class="hljs-punctuation">,</span> offset<span class="hljs-operator">=</span><span class="hljs-operator">-</span><span class="hljs-number">0.2</span><span class="hljs-punctuation">,</span><br>                outward<span class="hljs-operator">=</span><span class="hljs-literal">FALSE</span><span class="hljs-punctuation">,</span><br>                arrow<span class="hljs-operator">=</span>arrow<span class="hljs-punctuation">(</span><span class="hljs-built_in">length</span><span class="hljs-operator">=</span>unit<span class="hljs-punctuation">(</span><span class="hljs-number">0.01</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"npc"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_taxalink<span class="hljs-punctuation">(</span>taxa1<span class="hljs-operator">=</span><span class="hljs-string">"L"</span><span class="hljs-punctuation">,</span> taxa2<span class="hljs-operator">=</span><span class="hljs-string">"M"</span><span class="hljs-punctuation">,</span> <br>                color<span class="hljs-operator">=</span><span class="hljs-string">"blue"</span><span class="hljs-punctuation">,</span> alpha<span class="hljs-operator">=</span><span class="hljs-number">0.5</span><span class="hljs-punctuation">,</span> <br>                offset<span class="hljs-operator">=</span><span class="hljs-operator">-</span><span class="hljs-number">0.2</span><span class="hljs-punctuation">,</span> <br>                outward<span class="hljs-operator">=</span><span class="hljs-literal">FALSE</span><span class="hljs-punctuation">,</span><br>                arrow<span class="hljs-operator">=</span>arrow<span class="hljs-punctuation">(</span><span class="hljs-built_in">length</span><span class="hljs-operator">=</span>unit<span class="hljs-punctuation">(</span><span class="hljs-number">0.01</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"npc"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_tiplab<span class="hljs-punctuation">(</span>hjust<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-punctuation">)</span> <br><br>dat <span class="hljs-operator">&lt;-</span> data.frame<span class="hljs-punctuation">(</span>from<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"A"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"F"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"L"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> <br>                  to<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"E"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"K"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"M"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> <br>                  h<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-number">1</span><span class="hljs-punctuation">,</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span> <span class="hljs-number">0.1</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> <br>                  type<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"t1"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"t2"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"t3"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> <br>                  s<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span> <span class="hljs-number">2</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>p4 <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">,</span> layout<span class="hljs-operator">=</span><span class="hljs-string">"inward_circular"</span><span class="hljs-punctuation">,</span> xlim<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-number">150</span><span class="hljs-punctuation">,</span> <span class="hljs-number">0</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_taxalink<span class="hljs-punctuation">(</span>data<span class="hljs-operator">=</span>dat<span class="hljs-punctuation">,</span> <br>                mapping<span class="hljs-operator">=</span>aes<span class="hljs-punctuation">(</span>taxa1<span class="hljs-operator">=</span>from<span class="hljs-punctuation">,</span> <br>                            taxa2<span class="hljs-operator">=</span>to<span class="hljs-punctuation">,</span> <br>                            color<span class="hljs-operator">=</span>type<span class="hljs-punctuation">,</span> <br>                            size<span class="hljs-operator">=</span>s<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> <br>                ncp<span class="hljs-operator">=</span><span class="hljs-number">10</span><span class="hljs-punctuation">,</span><br>                offset<span class="hljs-operator">=</span><span class="hljs-number">0.15</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  geom_tiplab<span class="hljs-punctuation">(</span>hjust<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  scale_size_continuous<span class="hljs-punctuation">(</span><span class="hljs-built_in">range</span><span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-number">1</span><span class="hljs-punctuation">,</span><span class="hljs-number">3</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>cowplot<span class="hljs-operator">::</span>plot_grid<span class="hljs-punctuation">(</span>p1<span class="hljs-punctuation">,</span> p2<span class="hljs-punctuation">,</span> p3<span class="hljs-punctuation">,</span> p4<span class="hljs-punctuation">,</span> ncol<span class="hljs-operator">=</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span> labels<span class="hljs-operator">=</span><span class="hljs-built_in">LETTERS</span><span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-operator">:</span><span class="hljs-number">4</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071519203.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h3 id="Uncertainty-of-evolutionary-inference"><a href="#Uncertainty-of-evolutionary-inference" class="headerlink" title="Uncertainty of evolutionary inference"></a>Uncertainty of evolutionary inference</h3><figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs R">file <span class="hljs-operator">&lt;-</span> system.file<span class="hljs-punctuation">(</span><span class="hljs-string">"extdata/MEGA7"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"mtCDNA_timetree.nex"</span><span class="hljs-punctuation">,</span> package <span class="hljs-operator">=</span> <span class="hljs-string">"treeio"</span><span class="hljs-punctuation">)</span><br>x <span class="hljs-operator">&lt;-</span> read.mega<span class="hljs-punctuation">(</span>file<span class="hljs-punctuation">)</span><br>p1 <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>x<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> geom_range<span class="hljs-punctuation">(</span><span class="hljs-string">'reltime_0.95_CI'</span><span class="hljs-punctuation">,</span> color<span class="hljs-operator">=</span><span class="hljs-string">'red'</span><span class="hljs-punctuation">,</span> size<span class="hljs-operator">=</span><span class="hljs-number">3</span><span class="hljs-punctuation">,</span> alpha<span class="hljs-operator">=</span><span class="hljs-number">.3</span><span class="hljs-punctuation">)</span><br>p2 <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>x<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> geom_range<span class="hljs-punctuation">(</span><span class="hljs-string">'reltime_0.95_CI'</span><span class="hljs-punctuation">,</span> color<span class="hljs-operator">=</span><span class="hljs-string">'red'</span><span class="hljs-punctuation">,</span> size<span class="hljs-operator">=</span><span class="hljs-number">3</span><span class="hljs-punctuation">,</span> alpha<span class="hljs-operator">=</span><span class="hljs-number">.3</span><span class="hljs-punctuation">,</span> center<span class="hljs-operator">=</span><span class="hljs-string">'reltime'</span><span class="hljs-punctuation">)</span>  <br>p3 <span class="hljs-operator">&lt;-</span> p2 <span class="hljs-operator">+</span> scale_x_range<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> theme_tree2<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br><br>cowplot<span class="hljs-operator">::</span>plot_grid<span class="hljs-punctuation">(</span>p1<span class="hljs-punctuation">,</span>p2<span class="hljs-punctuation">,</span>p3<span class="hljs-punctuation">,</span>ncol <span class="hljs-operator">=</span> <span class="hljs-number">3</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071520792.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h3 id="其他软件输出的结果"><a href="#其他软件输出的结果" class="headerlink" title="其他软件输出的结果"></a>其他软件输出的结果</h3><figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs R">rstfile <span class="hljs-operator">&lt;-</span> system.file<span class="hljs-punctuation">(</span><span class="hljs-string">"extdata/PAML_Codeml"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"rst"</span><span class="hljs-punctuation">,</span> <br>                       package<span class="hljs-operator">=</span><span class="hljs-string">"treeio"</span><span class="hljs-punctuation">)</span><br>mlcfile <span class="hljs-operator">&lt;-</span> system.file<span class="hljs-punctuation">(</span><span class="hljs-string">"extdata/PAML_Codeml"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"mlc"</span><span class="hljs-punctuation">,</span> <br>                       package<span class="hljs-operator">=</span><span class="hljs-string">"treeio"</span><span class="hljs-punctuation">)</span><br><br>ml <span class="hljs-operator">&lt;-</span> read.codeml<span class="hljs-punctuation">(</span>rstfile<span class="hljs-punctuation">,</span> mlcfile<span class="hljs-punctuation">)</span><br>ggtree<span class="hljs-punctuation">(</span>ml<span class="hljs-punctuation">,</span> aes<span class="hljs-punctuation">(</span>color<span class="hljs-operator">=</span>dN_vs_dS<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> branch.length<span class="hljs-operator">=</span><span class="hljs-string">'dN_vs_dS'</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  scale_color_continuous<span class="hljs-punctuation">(</span>name<span class="hljs-operator">=</span><span class="hljs-string">'dN/dS'</span><span class="hljs-punctuation">,</span> limits<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-number">1.5</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>                         oob<span class="hljs-operator">=</span>scales<span class="hljs-operator">::</span>squish<span class="hljs-punctuation">,</span><br>                         low<span class="hljs-operator">=</span><span class="hljs-string">'darkgreen'</span><span class="hljs-punctuation">,</span> high<span class="hljs-operator">=</span><span class="hljs-string">'red'</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_text<span class="hljs-punctuation">(</span>aes<span class="hljs-punctuation">(</span>x<span class="hljs-operator">=</span>branch<span class="hljs-punctuation">,</span> label<span class="hljs-operator">=</span>AA_subs<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> <br>            vjust<span class="hljs-operator">=</span><span class="hljs-operator">-</span><span class="hljs-number">.5</span><span class="hljs-punctuation">,</span> color<span class="hljs-operator">=</span><span class="hljs-string">'steelblue'</span><span class="hljs-punctuation">,</span> size<span class="hljs-operator">=</span><span class="hljs-number">2</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  theme_tree2<span class="hljs-punctuation">(</span>legend.position<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-number">.9</span><span class="hljs-punctuation">,</span> <span class="hljs-number">.3</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071520761.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h3 id="放大特定区域"><a href="#放大特定区域" class="headerlink" title="放大特定区域"></a>放大特定区域</h3><figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs R">library<span class="hljs-punctuation">(</span>ggtree<span class="hljs-punctuation">)</span><br>nwk <span class="hljs-operator">&lt;-</span> system.file<span class="hljs-punctuation">(</span><span class="hljs-string">"extdata"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"sample.nwk"</span><span class="hljs-punctuation">,</span> package<span class="hljs-operator">=</span><span class="hljs-string">"treeio"</span><span class="hljs-punctuation">)</span><br>tree <span class="hljs-operator">&lt;-</span> read.tree<span class="hljs-punctuation">(</span>nwk<span class="hljs-punctuation">)</span><br>p1 <span class="hljs-operator">=</span> ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> geom_tiplab<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br>p2 <span class="hljs-operator">=</span> viewClade<span class="hljs-punctuation">(</span>p<span class="hljs-punctuation">,</span> MRCA<span class="hljs-punctuation">(</span>p<span class="hljs-punctuation">,</span> <span class="hljs-string">"I"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"L"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br><br>cowplot<span class="hljs-operator">::</span>plot_grid<span class="hljs-punctuation">(</span>p1<span class="hljs-punctuation">,</span>p2<span class="hljs-punctuation">,</span>ncol <span class="hljs-operator">=</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span> labels <span class="hljs-operator">=</span> <span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">'原图'</span><span class="hljs-punctuation">,</span><span class="hljs-string">'特定区域'</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071520383.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h3 id="标准化选中的clade"><a href="#标准化选中的clade" class="headerlink" title="标准化选中的clade"></a>标准化选中的clade</h3><figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs R">tree2 <span class="hljs-operator">&lt;-</span> groupClade<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">,</span> <span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-number">17</span><span class="hljs-punctuation">,</span> <span class="hljs-number">21</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>p <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>tree2<span class="hljs-punctuation">,</span> aes<span class="hljs-punctuation">(</span>color<span class="hljs-operator">=</span>group<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> theme<span class="hljs-punctuation">(</span>legend.position<span class="hljs-operator">=</span><span class="hljs-string">'none'</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  scale_color_manual<span class="hljs-punctuation">(</span>values<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"black"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"firebrick"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"steelblue"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>scaleClade<span class="hljs-punctuation">(</span>p<span class="hljs-punctuation">,</span> node<span class="hljs-operator">=</span><span class="hljs-number">17</span><span class="hljs-punctuation">,</span> scale<span class="hljs-operator">=</span><span class="hljs-number">.1</span><span class="hljs-punctuation">)</span> <br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071520979.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h3 id="隐藏-展示某个clade"><a href="#隐藏-展示某个clade" class="headerlink" title="隐藏/展示某个clade"></a>隐藏/展示某个clade</h3><figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs R">p2 <span class="hljs-operator">&lt;-</span> p <span class="hljs-operator">%&gt;%</span> collapse<span class="hljs-punctuation">(</span>node<span class="hljs-operator">=</span><span class="hljs-number">21</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  geom_point2<span class="hljs-punctuation">(</span>aes<span class="hljs-punctuation">(</span>subset<span class="hljs-operator">=</span><span class="hljs-punctuation">(</span>node<span class="hljs-operator">==</span><span class="hljs-number">21</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> shape<span class="hljs-operator">=</span><span class="hljs-number">21</span><span class="hljs-punctuation">,</span> size<span class="hljs-operator">=</span><span class="hljs-number">5</span><span class="hljs-punctuation">,</span> fill<span class="hljs-operator">=</span><span class="hljs-string">'green'</span><span class="hljs-punctuation">)</span><br>p2 <span class="hljs-operator">&lt;-</span> collapse<span class="hljs-punctuation">(</span>p2<span class="hljs-punctuation">,</span> node<span class="hljs-operator">=</span><span class="hljs-number">23</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  geom_point2<span class="hljs-punctuation">(</span>aes<span class="hljs-punctuation">(</span>subset<span class="hljs-operator">=</span><span class="hljs-punctuation">(</span>node<span class="hljs-operator">==</span><span class="hljs-number">23</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> shape<span class="hljs-operator">=</span><span class="hljs-number">23</span><span class="hljs-punctuation">,</span> size<span class="hljs-operator">=</span><span class="hljs-number">5</span><span class="hljs-punctuation">,</span> fill<span class="hljs-operator">=</span><span class="hljs-string">'red'</span><span class="hljs-punctuation">)</span><br>print<span class="hljs-punctuation">(</span>p2<span class="hljs-punctuation">)</span><br>expand<span class="hljs-punctuation">(</span>p2<span class="hljs-punctuation">,</span> node<span class="hljs-operator">=</span><span class="hljs-number">23</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> expand<span class="hljs-punctuation">(</span>node<span class="hljs-operator">=</span><span class="hljs-number">21</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071520310.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h3 id="利用三角形隐藏-展示某个clade"><a href="#利用三角形隐藏-展示某个clade" class="headerlink" title="利用三角形隐藏/展示某个clade"></a>利用三角形隐藏/展示某个clade</h3><figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs R">p2 <span class="hljs-operator">&lt;-</span> p <span class="hljs-operator">+</span> geom_tiplab<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br>node <span class="hljs-operator">&lt;-</span> 21<br>collapse<span class="hljs-punctuation">(</span>p2<span class="hljs-punctuation">,</span> node<span class="hljs-punctuation">,</span> <span class="hljs-string">'max'</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> expand<span class="hljs-punctuation">(</span>node<span class="hljs-punctuation">)</span><br>collapse<span class="hljs-punctuation">(</span>p2<span class="hljs-punctuation">,</span> node<span class="hljs-punctuation">,</span> <span class="hljs-string">'min'</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> expand<span class="hljs-punctuation">(</span>node<span class="hljs-punctuation">)</span><br>collapse<span class="hljs-punctuation">(</span>p2<span class="hljs-punctuation">,</span> node<span class="hljs-punctuation">,</span> <span class="hljs-string">'mixed'</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> expand<span class="hljs-punctuation">(</span>node<span class="hljs-punctuation">)</span><br><br>collapse<span class="hljs-punctuation">(</span>p<span class="hljs-punctuation">,</span> <span class="hljs-number">21</span><span class="hljs-punctuation">,</span> <span class="hljs-string">'mixed'</span><span class="hljs-punctuation">,</span> fill<span class="hljs-operator">=</span><span class="hljs-string">'steelblue'</span><span class="hljs-punctuation">,</span> alpha<span class="hljs-operator">=</span><span class="hljs-number">.4</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> <br>  collapse<span class="hljs-punctuation">(</span><span class="hljs-number">23</span><span class="hljs-punctuation">,</span> <span class="hljs-string">'mixed'</span><span class="hljs-punctuation">,</span> fill<span class="hljs-operator">=</span><span class="hljs-string">'firebrick'</span><span class="hljs-punctuation">,</span> color<span class="hljs-operator">=</span><span class="hljs-string">'blue'</span><span class="hljs-punctuation">)</span><br>  <br>scaleClade<span class="hljs-punctuation">(</span>p<span class="hljs-punctuation">,</span> <span class="hljs-number">23</span><span class="hljs-punctuation">,</span> <span class="hljs-number">.2</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> collapse<span class="hljs-punctuation">(</span><span class="hljs-number">23</span><span class="hljs-punctuation">,</span> <span class="hljs-string">'min'</span><span class="hljs-punctuation">,</span> fill<span class="hljs-operator">=</span><span class="hljs-string">"darkgreen"</span><span class="hljs-punctuation">)</span>  <br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071520498.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h3 id="分组Taxa"><a href="#分组Taxa" class="headerlink" title="分组Taxa"></a>分组Taxa</h3><figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs R">library<span class="hljs-punctuation">(</span>ggsci<span class="hljs-punctuation">)</span><br><br>data<span class="hljs-punctuation">(</span>iris<span class="hljs-punctuation">)</span><br>rn <span class="hljs-operator">&lt;-</span> paste0<span class="hljs-punctuation">(</span>iris<span class="hljs-punctuation">[</span><span class="hljs-punctuation">,</span><span class="hljs-number">5</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"_"</span><span class="hljs-punctuation">,</span> <span class="hljs-number">1</span><span class="hljs-operator">:</span><span class="hljs-number">150</span><span class="hljs-punctuation">)</span><br>rownames<span class="hljs-punctuation">(</span>iris<span class="hljs-punctuation">)</span> <span class="hljs-operator">&lt;-</span> rn<br>d_iris <span class="hljs-operator">&lt;-</span> dist<span class="hljs-punctuation">(</span>iris<span class="hljs-punctuation">[</span><span class="hljs-punctuation">,</span><span class="hljs-operator">-</span><span class="hljs-number">5</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> method<span class="hljs-operator">=</span><span class="hljs-string">"man"</span><span class="hljs-punctuation">)</span><br><br>tree_iris <span class="hljs-operator">&lt;-</span> ape<span class="hljs-operator">::</span>bionj<span class="hljs-punctuation">(</span>d_iris<span class="hljs-punctuation">)</span><br>grp <span class="hljs-operator">&lt;-</span> <span class="hljs-built_in">list</span><span class="hljs-punctuation">(</span>setosa     <span class="hljs-operator">=</span> rn<span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-operator">:</span><span class="hljs-number">50</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>            versicolor <span class="hljs-operator">=</span> rn<span class="hljs-punctuation">[</span><span class="hljs-number">51</span><span class="hljs-operator">:</span><span class="hljs-number">100</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>            virginica  <span class="hljs-operator">=</span> rn<span class="hljs-punctuation">[</span><span class="hljs-number">101</span><span class="hljs-operator">:</span><span class="hljs-number">150</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">)</span><br><br>p_iris <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>tree_iris<span class="hljs-punctuation">,</span> layout <span class="hljs-operator">=</span> <span class="hljs-string">'circular'</span><span class="hljs-punctuation">,</span> branch.length<span class="hljs-operator">=</span><span class="hljs-string">'none'</span><span class="hljs-punctuation">)</span><br>groupOTU<span class="hljs-punctuation">(</span>p_iris<span class="hljs-punctuation">,</span> grp<span class="hljs-punctuation">,</span> <span class="hljs-string">'group'</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  aes<span class="hljs-punctuation">(</span>color<span class="hljs-operator">=</span>group<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  scale_color_aaas<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  theme<span class="hljs-punctuation">(</span>legend.position<span class="hljs-operator">=</span><span class="hljs-string">"right"</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071520554.png" srcset="/img/loading.gif" lazyload alt=""></p>
<p>另外一种方法：</p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs R">tree_iris <span class="hljs-operator">&lt;-</span> groupOTU<span class="hljs-punctuation">(</span>tree_iris<span class="hljs-punctuation">,</span> grp<span class="hljs-punctuation">,</span> <span class="hljs-string">"Species"</span><span class="hljs-punctuation">)</span><br>ggtree<span class="hljs-punctuation">(</span>tree_iris<span class="hljs-punctuation">,</span> aes<span class="hljs-punctuation">(</span>color<span class="hljs-operator">=</span>Species<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> layout <span class="hljs-operator">=</span> <span class="hljs-string">'circular'</span><span class="hljs-punctuation">,</span> branch.length <span class="hljs-operator">=</span> <span class="hljs-string">'none'</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  theme<span class="hljs-punctuation">(</span>legend.position<span class="hljs-operator">=</span><span class="hljs-string">"right"</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></tbody></table></figure>
<h3 id="旋转clade"><a href="#旋转clade" class="headerlink" title="旋转clade"></a>旋转clade</h3><p>旋转<code>clade</code>有两种方法：</p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs R">p1 <span class="hljs-operator">&lt;-</span> p <span class="hljs-operator">+</span> geom_point2<span class="hljs-punctuation">(</span>aes<span class="hljs-punctuation">(</span>subset<span class="hljs-operator">=</span>node<span class="hljs-operator">==</span><span class="hljs-number">16</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> color<span class="hljs-operator">=</span><span class="hljs-string">'darkgreen'</span><span class="hljs-punctuation">,</span> size<span class="hljs-operator">=</span><span class="hljs-number">5</span><span class="hljs-punctuation">)</span><br>p2 <span class="hljs-operator">&lt;-</span> rotate<span class="hljs-punctuation">(</span>p1<span class="hljs-punctuation">,</span> <span class="hljs-number">17</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> rotate<span class="hljs-punctuation">(</span><span class="hljs-number">21</span><span class="hljs-punctuation">)</span> <span class="hljs-comment"># 方法1</span><br>flip<span class="hljs-punctuation">(</span>p2<span class="hljs-punctuation">,</span> <span class="hljs-number">17</span><span class="hljs-punctuation">,</span> <span class="hljs-number">21</span><span class="hljs-punctuation">)</span> <span class="hljs-comment"># 方法2</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071520705.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h3 id="外部数据mapping到树上"><a href="#外部数据mapping到树上" class="headerlink" title="外部数据mapping到树上"></a>外部数据mapping到树上</h3><figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs R">library<span class="hljs-punctuation">(</span>ggimage<span class="hljs-punctuation">)</span><br>library<span class="hljs-punctuation">(</span>ggtree<span class="hljs-punctuation">)</span><br><br><span class="hljs-comment"># 文件下载地址</span><br><span class="hljs-comment"># https://raw.githubusercontent.com/YuLab-SMU/treedata-book/master/data/tree_boots.nwk</span><br><span class="hljs-comment"># https://raw.githubusercontent.com/YuLab-SMU/treedata-book/master/data/tip_data.csv</span><br><br><br>x <span class="hljs-operator">&lt;-</span> read.tree<span class="hljs-punctuation">(</span><span class="hljs-string">"tree_boots.nwk"</span><span class="hljs-punctuation">)</span><br>info <span class="hljs-operator">&lt;-</span> read.csv<span class="hljs-punctuation">(</span><span class="hljs-string">"tip_data.csv"</span><span class="hljs-punctuation">)</span><br><br>p <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>x<span class="hljs-punctuation">)</span> <span class="hljs-operator">%&lt;+%</span> info <span class="hljs-operator">+</span> xlim<span class="hljs-punctuation">(</span><span class="hljs-operator">-</span><span class="hljs-number">.1</span><span class="hljs-punctuation">,</span> <span class="hljs-number">4</span><span class="hljs-punctuation">)</span><br>p2 <span class="hljs-operator">&lt;-</span> p <span class="hljs-operator">+</span> geom_tiplab<span class="hljs-punctuation">(</span>offset <span class="hljs-operator">=</span> <span class="hljs-number">.6</span><span class="hljs-punctuation">,</span> hjust <span class="hljs-operator">=</span> <span class="hljs-number">.5</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_tippoint<span class="hljs-punctuation">(</span>aes<span class="hljs-punctuation">(</span>shape <span class="hljs-operator">=</span> trophic_habit<span class="hljs-punctuation">,</span> color <span class="hljs-operator">=</span> trophic_habit<span class="hljs-punctuation">,</span> size <span class="hljs-operator">=</span> mass_in_kg<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  theme<span class="hljs-punctuation">(</span>legend.position <span class="hljs-operator">=</span> <span class="hljs-string">"right"</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> scale_size_continuous<span class="hljs-punctuation">(</span><span class="hljs-built_in">range</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-number">3</span><span class="hljs-punctuation">,</span> <span class="hljs-number">10</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br><br><span class="hljs-comment">#https://raw.githubusercontent.com/YuLab-SMU/treedata-book/master/data/inode_data.csv</span><br>d2 <span class="hljs-operator">&lt;-</span> read.csv<span class="hljs-punctuation">(</span><span class="hljs-string">"inode_data.csv"</span><span class="hljs-punctuation">)</span><br>p2 <span class="hljs-operator">%&lt;+%</span> d2 <span class="hljs-operator">+</span> geom_label<span class="hljs-punctuation">(</span>aes<span class="hljs-punctuation">(</span>label <span class="hljs-operator">=</span> vernacularName.y<span class="hljs-punctuation">,</span> fill <span class="hljs-operator">=</span> posterior<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  scale_fill_gradientn<span class="hljs-punctuation">(</span>colors <span class="hljs-operator">=</span> RColorBrewer<span class="hljs-operator">::</span>brewer.pal<span class="hljs-punctuation">(</span><span class="hljs-number">3</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"YlGnBu"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071520744.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h3 id="将SNP数据添加到树上"><a href="#将SNP数据添加到树上" class="headerlink" title="将SNP数据添加到树上"></a>将SNP数据添加到树上</h3><figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs R">library<span class="hljs-punctuation">(</span>ggtree<span class="hljs-punctuation">)</span><br><span class="hljs-comment">## remote_folder &lt;- paste0("https://raw.githubusercontent.com/katholt/",</span><br><span class="hljs-comment">##                         "plotTree/master/tree_example_april2015/")</span><br>remote_folder <span class="hljs-operator">&lt;-</span> <span class="hljs-string">"data/tree_example_april2015/"</span> <br><br><span class="hljs-comment">## read the phylogenetic tree</span><br>tree <span class="hljs-operator">&lt;-</span> read.tree<span class="hljs-punctuation">(</span>paste0<span class="hljs-punctuation">(</span>remote_folder<span class="hljs-punctuation">,</span> <span class="hljs-string">"tree.nwk"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br><br><span class="hljs-comment">## read the sampling information data set</span><br>info <span class="hljs-operator">&lt;-</span> read.csv<span class="hljs-punctuation">(</span>paste0<span class="hljs-punctuation">(</span>remote_folder<span class="hljs-punctuation">,</span><span class="hljs-string">"info.csv"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br><br><span class="hljs-comment">## read and process the allele table</span><br>snps<span class="hljs-operator">&lt;-</span>read.csv<span class="hljs-punctuation">(</span>paste0<span class="hljs-punctuation">(</span>remote_folder<span class="hljs-punctuation">,</span> <span class="hljs-string">"alleles.csv"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> header <span class="hljs-operator">=</span> <span class="hljs-built_in">F</span><span class="hljs-punctuation">,</span><br>                row.names <span class="hljs-operator">=</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span> stringsAsFactor <span class="hljs-operator">=</span> <span class="hljs-built_in">F</span><span class="hljs-punctuation">)</span><br>snps_strainCols <span class="hljs-operator">&lt;-</span> snps<span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">]</span> <br>snps<span class="hljs-operator">&lt;-</span>snps<span class="hljs-punctuation">[</span><span class="hljs-operator">-</span><span class="hljs-number">1</span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">]</span> <span class="hljs-comment"># drop strain names</span><br>colnames<span class="hljs-punctuation">(</span>snps<span class="hljs-punctuation">)</span> <span class="hljs-operator">&lt;-</span> snps_strainCols<br><br>gapChar <span class="hljs-operator">&lt;-</span> <span class="hljs-string">"?"</span><br>snp <span class="hljs-operator">&lt;-</span> t<span class="hljs-punctuation">(</span>snps<span class="hljs-punctuation">)</span><br>lsnp <span class="hljs-operator">&lt;-</span> apply<span class="hljs-punctuation">(</span>snp<span class="hljs-punctuation">,</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span> <span class="hljs-keyword">function</span><span class="hljs-punctuation">(</span>x<span class="hljs-punctuation">)</span> <span class="hljs-punctuation">{</span><br>        x <span class="hljs-operator">!=</span> snp<span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">]</span> <span class="hljs-operator">&amp;</span> x <span class="hljs-operator">!=</span> gapChar <span class="hljs-operator">&amp;</span> snp<span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">]</span> <span class="hljs-operator">!=</span> gapChar<br>    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">)</span><br>lsnp <span class="hljs-operator">&lt;-</span> as.data.frame<span class="hljs-punctuation">(</span>lsnp<span class="hljs-punctuation">)</span><br>lsnp<span class="hljs-operator">$</span>pos <span class="hljs-operator">&lt;-</span> <span class="hljs-built_in">as.numeric</span><span class="hljs-punctuation">(</span>rownames<span class="hljs-punctuation">(</span>lsnp<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>lsnp <span class="hljs-operator">&lt;-</span> tidyr<span class="hljs-operator">::</span>gather<span class="hljs-punctuation">(</span>lsnp<span class="hljs-punctuation">,</span> name<span class="hljs-punctuation">,</span> value<span class="hljs-punctuation">,</span> <span class="hljs-operator">-</span>pos<span class="hljs-punctuation">)</span><br>snp_data <span class="hljs-operator">&lt;-</span> lsnp<span class="hljs-punctuation">[</span>lsnp<span class="hljs-operator">$</span>value<span class="hljs-punctuation">,</span> <span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"name"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"pos"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span><br><br><span class="hljs-comment">## read the trait data</span><br>bar_data <span class="hljs-operator">&lt;-</span> read.csv<span class="hljs-punctuation">(</span>paste0<span class="hljs-punctuation">(</span>remote_folder<span class="hljs-punctuation">,</span> <span class="hljs-string">"bar.csv"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br><br><span class="hljs-comment">## visualize the tree </span><br>p <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">)</span> <br><br><span class="hljs-comment">## attach the sampling information data set </span><br><span class="hljs-comment">## and add symbols colored by location</span><br>p <span class="hljs-operator">&lt;-</span> p <span class="hljs-operator">%&lt;+%</span> info <span class="hljs-operator">+</span> geom_tippoint<span class="hljs-punctuation">(</span>aes<span class="hljs-punctuation">(</span>color<span class="hljs-operator">=</span>location<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br><br><span class="hljs-comment">## visualize SNP and Trait data using dot and bar charts,</span><br><span class="hljs-comment">## and align them based on tree structure</span><br>p <span class="hljs-operator">+</span> geom_facet<span class="hljs-punctuation">(</span>panel <span class="hljs-operator">=</span> <span class="hljs-string">"SNP"</span><span class="hljs-punctuation">,</span> data <span class="hljs-operator">=</span> snp_data<span class="hljs-punctuation">,</span> geom <span class="hljs-operator">=</span> geom_point<span class="hljs-punctuation">,</span> <br>               mapping<span class="hljs-operator">=</span>aes<span class="hljs-punctuation">(</span>x <span class="hljs-operator">=</span> pos<span class="hljs-punctuation">,</span> color <span class="hljs-operator">=</span> location<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> shape <span class="hljs-operator">=</span> <span class="hljs-string">'|'</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>    geom_facet<span class="hljs-punctuation">(</span>panel <span class="hljs-operator">=</span> <span class="hljs-string">"Trait"</span><span class="hljs-punctuation">,</span> data <span class="hljs-operator">=</span> bar_data<span class="hljs-punctuation">,</span> geom <span class="hljs-operator">=</span> ggstance<span class="hljs-operator">::</span>geom_barh<span class="hljs-punctuation">,</span> <br>                aes<span class="hljs-punctuation">(</span>x <span class="hljs-operator">=</span> dummy_bar_value<span class="hljs-punctuation">,</span> color <span class="hljs-operator">=</span> location<span class="hljs-punctuation">,</span> fill <span class="hljs-operator">=</span> location<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> <br>                stat <span class="hljs-operator">=</span> <span class="hljs-string">"identity"</span><span class="hljs-punctuation">,</span> width <span class="hljs-operator">=</span> <span class="hljs-number">.6</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>    theme_tree2<span class="hljs-punctuation">(</span>legend.position<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-number">.05</span><span class="hljs-punctuation">,</span> <span class="hljs-number">.85</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071520908.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h3 id="关联矩阵"><a href="#关联矩阵" class="headerlink" title="关联矩阵"></a>关联矩阵</h3><figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs R">beast_file <span class="hljs-operator">&lt;-</span> system.file<span class="hljs-punctuation">(</span><span class="hljs-string">"examples/MCC_FluA_H3.tree"</span><span class="hljs-punctuation">,</span> package<span class="hljs-operator">=</span><span class="hljs-string">"ggtree"</span><span class="hljs-punctuation">)</span><br>beast_tree <span class="hljs-operator">&lt;-</span> read.beast<span class="hljs-punctuation">(</span>beast_file<span class="hljs-punctuation">)</span><br><br>genotype_file <span class="hljs-operator">&lt;-</span> system.file<span class="hljs-punctuation">(</span><span class="hljs-string">"examples/Genotype.txt"</span><span class="hljs-punctuation">,</span> package<span class="hljs-operator">=</span><span class="hljs-string">"ggtree"</span><span class="hljs-punctuation">)</span><br>genotype <span class="hljs-operator">&lt;-</span> read.table<span class="hljs-punctuation">(</span>genotype_file<span class="hljs-punctuation">,</span> sep<span class="hljs-operator">=</span><span class="hljs-string">"\t"</span><span class="hljs-punctuation">,</span> stringsAsFactor<span class="hljs-operator">=</span><span class="hljs-built_in">F</span><span class="hljs-punctuation">)</span><br>colnames<span class="hljs-punctuation">(</span>genotype<span class="hljs-punctuation">)</span> <span class="hljs-operator">&lt;-</span> sub<span class="hljs-punctuation">(</span><span class="hljs-string">"\\.$"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span> colnames<span class="hljs-punctuation">(</span>genotype<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>p <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>beast_tree<span class="hljs-punctuation">,</span> mrsd<span class="hljs-operator">=</span><span class="hljs-string">"2013-01-01"</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>    geom_treescale<span class="hljs-punctuation">(</span>x<span class="hljs-operator">=</span><span class="hljs-number">2008</span><span class="hljs-punctuation">,</span> y<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-punctuation">,</span> offset<span class="hljs-operator">=</span><span class="hljs-number">2</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>    geom_tiplab<span class="hljs-punctuation">(</span>size<span class="hljs-operator">=</span><span class="hljs-number">2</span><span class="hljs-punctuation">)</span><br>gheatmap<span class="hljs-punctuation">(</span>p<span class="hljs-punctuation">,</span> genotype<span class="hljs-punctuation">,</span> offset<span class="hljs-operator">=</span><span class="hljs-number">5</span><span class="hljs-punctuation">,</span> width<span class="hljs-operator">=</span><span class="hljs-number">0.5</span><span class="hljs-punctuation">,</span> font.size<span class="hljs-operator">=</span><span class="hljs-number">3</span><span class="hljs-punctuation">,</span> <br>        colnames_angle<span class="hljs-operator">=</span><span class="hljs-operator">-</span><span class="hljs-number">45</span><span class="hljs-punctuation">,</span> hjust<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>    scale_fill_manual<span class="hljs-punctuation">(</span>breaks<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"HuH3N2"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"pdm"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"trig"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> <br>        values<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"steelblue"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"firebrick"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"darkgreen"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> name<span class="hljs-operator">=</span><span class="hljs-string">"genotype"</span><span class="hljs-punctuation">)</span><br><br>p <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>beast_tree<span class="hljs-punctuation">,</span> mrsd<span class="hljs-operator">=</span><span class="hljs-string">"2013-01-01"</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>    geom_tiplab<span class="hljs-punctuation">(</span>size<span class="hljs-operator">=</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span> align<span class="hljs-operator">=</span><span class="hljs-literal">TRUE</span><span class="hljs-punctuation">,</span> linesize<span class="hljs-operator">=</span><span class="hljs-number">.5</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>    theme_tree2<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br>gheatmap<span class="hljs-punctuation">(</span>p<span class="hljs-punctuation">,</span> genotype<span class="hljs-punctuation">,</span> offset<span class="hljs-operator">=</span><span class="hljs-number">8</span><span class="hljs-punctuation">,</span> width<span class="hljs-operator">=</span><span class="hljs-number">0.6</span><span class="hljs-punctuation">,</span> <br>        colnames<span class="hljs-operator">=</span><span class="hljs-literal">FALSE</span><span class="hljs-punctuation">,</span> legend_title<span class="hljs-operator">=</span><span class="hljs-string">"genotype"</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>    scale_x_ggtree<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>    scale_y_continuous<span class="hljs-punctuation">(</span>expand<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-number">0.3</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071520371.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h3 id="关联多个矩阵"><a href="#关联多个矩阵" class="headerlink" title="关联多个矩阵"></a>关联多个矩阵</h3><figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs R">nwk <span class="hljs-operator">&lt;-</span> system.file<span class="hljs-punctuation">(</span><span class="hljs-string">"extdata"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"sample.nwk"</span><span class="hljs-punctuation">,</span> package<span class="hljs-operator">=</span><span class="hljs-string">"treeio"</span><span class="hljs-punctuation">)</span><br><br>tree <span class="hljs-operator">&lt;-</span> read.tree<span class="hljs-punctuation">(</span>nwk<span class="hljs-punctuation">)</span><br>circ <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">,</span> layout <span class="hljs-operator">=</span> <span class="hljs-string">"circular"</span><span class="hljs-punctuation">)</span><br><br>df <span class="hljs-operator">&lt;-</span> data.frame<span class="hljs-punctuation">(</span>first<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"a"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"b"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"a"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"c"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"d"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"d"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"a"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"b"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"e"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"e"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"f"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"c"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"f"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>                 second<span class="hljs-operator">=</span> <span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"z"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"z"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"z"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"z"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"y"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"y"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"y"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"y"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"x"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"x"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"x"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"a"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"a"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>rownames<span class="hljs-punctuation">(</span>df<span class="hljs-punctuation">)</span> <span class="hljs-operator">&lt;-</span> tree<span class="hljs-operator">$</span>tip.label<br><br>df2 <span class="hljs-operator">&lt;-</span> as.data.frame<span class="hljs-punctuation">(</span>matrix<span class="hljs-punctuation">(</span>rnorm<span class="hljs-punctuation">(</span><span class="hljs-number">39</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> ncol<span class="hljs-operator">=</span><span class="hljs-number">3</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>rownames<span class="hljs-punctuation">(</span>df2<span class="hljs-punctuation">)</span> <span class="hljs-operator">&lt;-</span> tree<span class="hljs-operator">$</span>tip.label<br>colnames<span class="hljs-punctuation">(</span>df2<span class="hljs-punctuation">)</span> <span class="hljs-operator">&lt;-</span> <span class="hljs-built_in">LETTERS</span><span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-operator">:</span><span class="hljs-number">3</span><span class="hljs-punctuation">]</span><br><br><br>p1 <span class="hljs-operator">&lt;-</span> gheatmap<span class="hljs-punctuation">(</span>circ<span class="hljs-punctuation">,</span> df<span class="hljs-punctuation">,</span> offset<span class="hljs-operator">=</span><span class="hljs-number">.8</span><span class="hljs-punctuation">,</span> width<span class="hljs-operator">=</span><span class="hljs-number">.2</span><span class="hljs-punctuation">,</span><br>               colnames_angle<span class="hljs-operator">=</span><span class="hljs-number">95</span><span class="hljs-punctuation">,</span> colnames_offset_y <span class="hljs-operator">=</span> <span class="hljs-number">.25</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>    scale_fill_viridis_d<span class="hljs-punctuation">(</span>option<span class="hljs-operator">=</span><span class="hljs-string">"D"</span><span class="hljs-punctuation">,</span> name<span class="hljs-operator">=</span><span class="hljs-string">"discrete\nvalue"</span><span class="hljs-punctuation">)</span><br><br><br>library<span class="hljs-punctuation">(</span>ggnewscale<span class="hljs-punctuation">)</span><br>p2 <span class="hljs-operator">&lt;-</span> p1 <span class="hljs-operator">+</span> new_scale_fill<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br>gheatmap<span class="hljs-punctuation">(</span>p2<span class="hljs-punctuation">,</span> df2<span class="hljs-punctuation">,</span> offset<span class="hljs-operator">=</span><span class="hljs-number">15</span><span class="hljs-punctuation">,</span> width<span class="hljs-operator">=</span><span class="hljs-number">.3</span><span class="hljs-punctuation">,</span><br>         colnames_angle<span class="hljs-operator">=</span><span class="hljs-number">90</span><span class="hljs-punctuation">,</span> colnames_offset_y <span class="hljs-operator">=</span> <span class="hljs-number">.25</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>    scale_fill_viridis_c<span class="hljs-punctuation">(</span>option<span class="hljs-operator">=</span><span class="hljs-string">"A"</span><span class="hljs-punctuation">,</span> name<span class="hljs-operator">=</span><span class="hljs-string">"continuous\nvalue"</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071520415.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h3 id="多序列比对可视化"><a href="#多序列比对可视化" class="headerlink" title="多序列比对可视化"></a>多序列比对可视化</h3><figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs R">tree <span class="hljs-operator">&lt;-</span> read.tree<span class="hljs-punctuation">(</span><span class="hljs-string">"data/tree.nwk"</span><span class="hljs-punctuation">)</span><br>p <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> geom_tiplab<span class="hljs-punctuation">(</span>size<span class="hljs-operator">=</span><span class="hljs-number">3</span><span class="hljs-punctuation">)</span><br>msaplot<span class="hljs-punctuation">(</span>p<span class="hljs-punctuation">,</span> <span class="hljs-string">"data/sequence.fasta"</span><span class="hljs-punctuation">,</span> offset<span class="hljs-operator">=</span><span class="hljs-number">3</span><span class="hljs-punctuation">,</span> width<span class="hljs-operator">=</span><span class="hljs-number">2</span><span class="hljs-punctuation">)</span><br>p <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">,</span> layout<span class="hljs-operator">=</span><span class="hljs-string">'circular'</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>    geom_tiplab<span class="hljs-punctuation">(</span>offset<span class="hljs-operator">=</span><span class="hljs-number">4</span><span class="hljs-punctuation">,</span> align<span class="hljs-operator">=</span><span class="hljs-literal">TRUE</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> xlim<span class="hljs-punctuation">(</span><span class="hljs-literal">NA</span><span class="hljs-punctuation">,</span> <span class="hljs-number">12</span><span class="hljs-punctuation">)</span><br>msaplot<span class="hljs-punctuation">(</span>p<span class="hljs-punctuation">,</span> <span class="hljs-string">"data/sequence.fasta"</span><span class="hljs-punctuation">,</span> window<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-number">120</span><span class="hljs-punctuation">,</span> <span class="hljs-number">200</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span>  <br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071520969.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h3 id="拼图"><a href="#拼图" class="headerlink" title="拼图"></a>拼图</h3><figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs R">library<span class="hljs-punctuation">(</span>ggplot2<span class="hljs-punctuation">)</span><br>library<span class="hljs-punctuation">(</span>ggtree<span class="hljs-punctuation">)</span><br><br>set.seed<span class="hljs-punctuation">(</span><span class="hljs-number">2019</span><span class="hljs-operator">-</span><span class="hljs-number">10</span><span class="hljs-operator">-</span><span class="hljs-number">31</span><span class="hljs-punctuation">)</span><br>tr <span class="hljs-operator">&lt;-</span> rtree<span class="hljs-punctuation">(</span><span class="hljs-number">10</span><span class="hljs-punctuation">)</span><br><br>d1 <span class="hljs-operator">&lt;-</span> data.frame<span class="hljs-punctuation">(</span><br>    <span class="hljs-comment"># only some labels match</span><br>    label <span class="hljs-operator">=</span> <span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span>tr<span class="hljs-operator">$</span>tip.label<span class="hljs-punctuation">[</span>sample<span class="hljs-punctuation">(</span><span class="hljs-number">5</span><span class="hljs-punctuation">,</span> <span class="hljs-number">5</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"A"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>    value <span class="hljs-operator">=</span> sample<span class="hljs-punctuation">(</span><span class="hljs-number">1</span><span class="hljs-operator">:</span><span class="hljs-number">6</span><span class="hljs-punctuation">,</span> <span class="hljs-number">6</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br><br>d2 <span class="hljs-operator">&lt;-</span> data.frame<span class="hljs-punctuation">(</span><br>    label <span class="hljs-operator">=</span> <span class="hljs-built_in">rep</span><span class="hljs-punctuation">(</span>tr<span class="hljs-operator">$</span>tip.label<span class="hljs-punctuation">,</span> <span class="hljs-number">5</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>    category <span class="hljs-operator">=</span> <span class="hljs-built_in">rep</span><span class="hljs-punctuation">(</span><span class="hljs-built_in">LETTERS</span><span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-operator">:</span><span class="hljs-number">5</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> each<span class="hljs-operator">=</span><span class="hljs-number">10</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>    value <span class="hljs-operator">=</span> rnorm<span class="hljs-punctuation">(</span><span class="hljs-number">50</span><span class="hljs-punctuation">,</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-number">3</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <br><br>g <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>tr<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> geom_tiplab<span class="hljs-punctuation">(</span>align<span class="hljs-operator">=</span><span class="hljs-literal">TRUE</span><span class="hljs-punctuation">)</span><br><br>p1 <span class="hljs-operator">&lt;-</span> ggplot<span class="hljs-punctuation">(</span>d1<span class="hljs-punctuation">,</span> aes<span class="hljs-punctuation">(</span>label<span class="hljs-punctuation">,</span> value<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> geom_col<span class="hljs-punctuation">(</span>aes<span class="hljs-punctuation">(</span>fill<span class="hljs-operator">=</span>label<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>    geom_text<span class="hljs-punctuation">(</span>aes<span class="hljs-punctuation">(</span>label<span class="hljs-operator">=</span>label<span class="hljs-punctuation">,</span> y<span class="hljs-operator">=</span> value<span class="hljs-operator">+</span><span class="hljs-number">.1</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>    coord_flip<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> theme_tree2<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> theme<span class="hljs-punctuation">(</span>legend.position<span class="hljs-operator">=</span><span class="hljs-string">'none'</span><span class="hljs-punctuation">)</span><br> <br>p2 <span class="hljs-operator">&lt;-</span> ggplot<span class="hljs-punctuation">(</span>d2<span class="hljs-punctuation">,</span> aes<span class="hljs-punctuation">(</span>x<span class="hljs-operator">=</span>category<span class="hljs-punctuation">,</span> y<span class="hljs-operator">=</span>label<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>    geom_tile<span class="hljs-punctuation">(</span>aes<span class="hljs-punctuation">(</span>fill<span class="hljs-operator">=</span>value<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> scale_fill_viridis_c<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>    theme_tree2<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <br>    <br>cowplot<span class="hljs-operator">::</span>plot_grid<span class="hljs-punctuation">(</span>g<span class="hljs-punctuation">,</span> p2<span class="hljs-punctuation">,</span> p1<span class="hljs-punctuation">,</span> ncol<span class="hljs-operator">=</span><span class="hljs-number">3</span><span class="hljs-punctuation">)</span> <br><br>library<span class="hljs-punctuation">(</span>aplot<span class="hljs-punctuation">)</span><br>p2 <span class="hljs-operator">%&gt;%</span> insert_left<span class="hljs-punctuation">(</span>g<span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> insert_right<span class="hljs-punctuation">(</span>p1<span class="hljs-punctuation">,</span> width<span class="hljs-operator">=</span><span class="hljs-number">.5</span><span class="hljs-punctuation">)</span> <br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071520333.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h3 id="图片注释"><a href="#图片注释" class="headerlink" title="图片注释"></a>图片注释</h3><p>没能找到图片下载地址，看代码很容易理解：</p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs R">library<span class="hljs-punctuation">(</span>ggimage<span class="hljs-punctuation">)</span><br>library<span class="hljs-punctuation">(</span>ggtree<span class="hljs-punctuation">)</span><br><br>nwk <span class="hljs-operator">&lt;-</span> <span class="hljs-string">"((((bufonidae, dendrobatidae), ceratophryidae), (centrolenidae, leptodactylidae)), hylidae);"</span><br><br>x <span class="hljs-operator">=</span> read.tree<span class="hljs-punctuation">(</span>text <span class="hljs-operator">=</span> nwk<span class="hljs-punctuation">)</span><br>ggtree<span class="hljs-punctuation">(</span>x<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> xlim<span class="hljs-punctuation">(</span><span class="hljs-literal">NA</span><span class="hljs-punctuation">,</span> <span class="hljs-number">7</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> ylim<span class="hljs-punctuation">(</span><span class="hljs-literal">NA</span><span class="hljs-punctuation">,</span> <span class="hljs-number">6.2</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_tiplab<span class="hljs-punctuation">(</span>aes<span class="hljs-punctuation">(</span>image<span class="hljs-operator">=</span>paste0<span class="hljs-punctuation">(</span><span class="hljs-string">"img/frogs/"</span><span class="hljs-punctuation">,</span> label<span class="hljs-punctuation">,</span> <span class="hljs-string">'.jpg'</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> <br>              geom<span class="hljs-operator">=</span><span class="hljs-string">"image"</span><span class="hljs-punctuation">,</span> offset<span class="hljs-operator">=</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span> align<span class="hljs-operator">=</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span> size<span class="hljs-operator">=</span><span class="hljs-number">.2</span><span class="hljs-punctuation">)</span>  <span class="hljs-operator">+</span> <br>  geom_tiplab<span class="hljs-punctuation">(</span>geom<span class="hljs-operator">=</span><span class="hljs-string">'label'</span><span class="hljs-punctuation">,</span> offset<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-punctuation">,</span> hjust<span class="hljs-operator">=</span><span class="hljs-number">.5</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  geom_image<span class="hljs-punctuation">(</span>x<span class="hljs-operator">=</span><span class="hljs-number">.8</span><span class="hljs-punctuation">,</span> y<span class="hljs-operator">=</span><span class="hljs-number">5.5</span><span class="hljs-punctuation">,</span> image<span class="hljs-operator">=</span><span class="hljs-string">"img/frogs/frog.jpg"</span><span class="hljs-punctuation">,</span> size<span class="hljs-operator">=</span><span class="hljs-number">.2</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071520974.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h3 id="图标（剪影）注释"><a href="#图标（剪影）注释" class="headerlink" title="图标（剪影）注释"></a>图标（剪影）注释</h3><p><a target="_blank" rel="noopener" href="http://phylopic.org/">PhyloPic</a>提供了1300余种生物剪影，<code>ggtree</code>能够调用这个数据库中的生物图标进行注释，相当于上面的图片。这种情况下绘图稍微有点慢，毕竟这个数据库是国外的。</p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs R">library<span class="hljs-punctuation">(</span>ggtree<span class="hljs-punctuation">)</span><br>newick <span class="hljs-operator">&lt;-</span> <span class="hljs-string">"((Pongo_abelii,(Gorilla_gorilla_gorilla,(Pan_paniscus,Pan_troglodytes)Pan,Homo_sapiens)Homininae)Hominidae,Nomascus_leucogenys)Hominoidea;"</span><br><br>tree <span class="hljs-operator">&lt;-</span> read.tree<span class="hljs-punctuation">(</span>text<span class="hljs-operator">=</span>newick<span class="hljs-punctuation">)</span><br><br>d <span class="hljs-operator">&lt;-</span> ggimage<span class="hljs-operator">::</span>phylopic_uid<span class="hljs-punctuation">(</span>tree<span class="hljs-operator">$</span>tip.label<span class="hljs-punctuation">)</span><br>d<span class="hljs-operator">$</span>body_mass <span class="hljs-operator">=</span> <span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-number">52</span><span class="hljs-punctuation">,</span> <span class="hljs-number">114</span><span class="hljs-punctuation">,</span> <span class="hljs-number">47</span><span class="hljs-punctuation">,</span> <span class="hljs-number">45</span><span class="hljs-punctuation">,</span> <span class="hljs-number">58</span><span class="hljs-punctuation">,</span> <span class="hljs-number">6</span><span class="hljs-punctuation">)</span><br><br>p <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">)</span> <span class="hljs-operator">%&lt;+%</span> d <span class="hljs-operator">+</span> <br>  geom_tiplab<span class="hljs-punctuation">(</span>aes<span class="hljs-punctuation">(</span>image<span class="hljs-operator">=</span>uid<span class="hljs-punctuation">,</span> colour<span class="hljs-operator">=</span>body_mass<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> geom<span class="hljs-operator">=</span><span class="hljs-string">"phylopic"</span><span class="hljs-punctuation">,</span> offset<span class="hljs-operator">=</span><span class="hljs-number">2.5</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_tiplab<span class="hljs-punctuation">(</span>aes<span class="hljs-punctuation">(</span>label<span class="hljs-operator">=</span>label<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> offset <span class="hljs-operator">=</span> <span class="hljs-number">.2</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> xlim<span class="hljs-punctuation">(</span><span class="hljs-literal">NA</span><span class="hljs-punctuation">,</span> <span class="hljs-number">7</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  scale_color_viridis_c<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071520220.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h3 id="使用子图进行注释"><a href="#使用子图进行注释" class="headerlink" title="使用子图进行注释"></a>使用子图进行注释</h3><p>用子图进行注释是通过函数<code>geom_inset()</code>来完成的。</p>
<h4 id="条形图注释"><a href="#条形图注释" class="headerlink" title="条形图注释"></a>条形图注释</h4><figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs R">library<span class="hljs-punctuation">(</span>phytools<span class="hljs-punctuation">)</span><br>data<span class="hljs-punctuation">(</span>anoletree<span class="hljs-punctuation">)</span><br>x <span class="hljs-operator">&lt;-</span> getStates<span class="hljs-punctuation">(</span>anoletree<span class="hljs-punctuation">,</span><span class="hljs-string">"tips"</span><span class="hljs-punctuation">)</span><br>tree <span class="hljs-operator">&lt;-</span> anoletree<br><br>cols <span class="hljs-operator">&lt;-</span> setNames<span class="hljs-punctuation">(</span>palette<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-operator">:</span><span class="hljs-built_in">length</span><span class="hljs-punctuation">(</span>unique<span class="hljs-punctuation">(</span>x<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>sort<span class="hljs-punctuation">(</span>unique<span class="hljs-punctuation">(</span>x<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>fitER <span class="hljs-operator">&lt;-</span> ape<span class="hljs-operator">::</span>ace<span class="hljs-punctuation">(</span>x<span class="hljs-punctuation">,</span>tree<span class="hljs-punctuation">,</span>model<span class="hljs-operator">=</span><span class="hljs-string">"ER"</span><span class="hljs-punctuation">,</span>type<span class="hljs-operator">=</span><span class="hljs-string">"discrete"</span><span class="hljs-punctuation">)</span><br>ancstats <span class="hljs-operator">&lt;-</span> as.data.frame<span class="hljs-punctuation">(</span>fitER<span class="hljs-operator">$</span>lik.anc<span class="hljs-punctuation">)</span><br>ancstats<span class="hljs-operator">$</span>node <span class="hljs-operator">&lt;-</span> 1<span class="hljs-operator">:</span>tree<span class="hljs-operator">$</span>Nnode<span class="hljs-operator">+</span>Ntip<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">)</span><br><br><span class="hljs-comment">## cols parameter indicate which columns store stats</span><br>bars <span class="hljs-operator">&lt;-</span> nodebar<span class="hljs-punctuation">(</span>ancstats<span class="hljs-punctuation">,</span> cols<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-operator">:</span><span class="hljs-number">6</span><span class="hljs-punctuation">)</span><br>bars <span class="hljs-operator">&lt;-</span> lapply<span class="hljs-punctuation">(</span>bars<span class="hljs-punctuation">,</span> <span class="hljs-keyword">function</span><span class="hljs-punctuation">(</span>g<span class="hljs-punctuation">)</span> g<span class="hljs-operator">+</span>scale_fill_manual<span class="hljs-punctuation">(</span>values <span class="hljs-operator">=</span> cols<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br><br>tree2 <span class="hljs-operator">&lt;-</span> full_join<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">,</span> data.frame<span class="hljs-punctuation">(</span>label <span class="hljs-operator">=</span> <span class="hljs-built_in">names</span><span class="hljs-punctuation">(</span>x<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> stat <span class="hljs-operator">=</span> x <span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> by <span class="hljs-operator">=</span> <span class="hljs-string">'label'</span><span class="hljs-punctuation">)</span><br>p <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>tree2<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> geom_tiplab<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>    geom_tippoint<span class="hljs-punctuation">(</span>aes<span class="hljs-punctuation">(</span>color <span class="hljs-operator">=</span> stat<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>    scale_color_manual<span class="hljs-punctuation">(</span>values <span class="hljs-operator">=</span> cols<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>    theme<span class="hljs-punctuation">(</span>legend.position <span class="hljs-operator">=</span> <span class="hljs-string">"right"</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>    xlim<span class="hljs-punctuation">(</span><span class="hljs-literal">NA</span><span class="hljs-punctuation">,</span> <span class="hljs-number">8</span><span class="hljs-punctuation">)</span><br>p <span class="hljs-operator">+</span> geom_inset<span class="hljs-punctuation">(</span>bars<span class="hljs-punctuation">,</span> width <span class="hljs-operator">=</span> <span class="hljs-number">.08</span><span class="hljs-punctuation">,</span> height <span class="hljs-operator">=</span> <span class="hljs-number">.05</span><span class="hljs-punctuation">,</span> x <span class="hljs-operator">=</span> <span class="hljs-string">"branch"</span><span class="hljs-punctuation">)</span> <br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071520608.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h4 id="饼图注释"><a href="#饼图注释" class="headerlink" title="饼图注释"></a>饼图注释</h4><figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs R">library<span class="hljs-punctuation">(</span>phytools<span class="hljs-punctuation">)</span><br>library<span class="hljs-punctuation">(</span>treeio<span class="hljs-punctuation">)</span><br>library<span class="hljs-punctuation">(</span>tidytree<span class="hljs-punctuation">)</span><br>data<span class="hljs-punctuation">(</span>anoletree<span class="hljs-punctuation">)</span><br>x <span class="hljs-operator">&lt;-</span> getStates<span class="hljs-punctuation">(</span>anoletree<span class="hljs-punctuation">,</span><span class="hljs-string">"tips"</span><span class="hljs-punctuation">)</span><br>tree <span class="hljs-operator">&lt;-</span> anoletree<br><br>cols <span class="hljs-operator">&lt;-</span> setNames<span class="hljs-punctuation">(</span>palette<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-operator">:</span><span class="hljs-built_in">length</span><span class="hljs-punctuation">(</span>unique<span class="hljs-punctuation">(</span>x<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>sort<span class="hljs-punctuation">(</span>unique<span class="hljs-punctuation">(</span>x<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>fitER <span class="hljs-operator">&lt;-</span> ape<span class="hljs-operator">::</span>ace<span class="hljs-punctuation">(</span>x<span class="hljs-punctuation">,</span>tree<span class="hljs-punctuation">,</span>model<span class="hljs-operator">=</span><span class="hljs-string">"ER"</span><span class="hljs-punctuation">,</span>type<span class="hljs-operator">=</span><span class="hljs-string">"discrete"</span><span class="hljs-punctuation">)</span><br>ancstats <span class="hljs-operator">&lt;-</span> as.data.frame<span class="hljs-punctuation">(</span>fitER<span class="hljs-operator">$</span>lik.anc<span class="hljs-punctuation">)</span><br>ancstats<span class="hljs-operator">$</span>node <span class="hljs-operator">&lt;-</span> 1<span class="hljs-operator">:</span>tree<span class="hljs-operator">$</span>Nnode<span class="hljs-operator">+</span>Ntip<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">)</span><br><br>pies <span class="hljs-operator">&lt;-</span> nodepie<span class="hljs-punctuation">(</span>ancstats<span class="hljs-punctuation">,</span> cols <span class="hljs-operator">=</span> <span class="hljs-number">1</span><span class="hljs-operator">:</span><span class="hljs-number">6</span><span class="hljs-punctuation">)</span><br>pies <span class="hljs-operator">&lt;-</span> lapply<span class="hljs-punctuation">(</span>pies<span class="hljs-punctuation">,</span> <span class="hljs-keyword">function</span><span class="hljs-punctuation">(</span>g<span class="hljs-punctuation">)</span> g<span class="hljs-operator">+</span>scale_fill_manual<span class="hljs-punctuation">(</span>values <span class="hljs-operator">=</span> cols<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br><br>tree2 <span class="hljs-operator">&lt;-</span> full_join<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">,</span> data.frame<span class="hljs-punctuation">(</span>label <span class="hljs-operator">=</span> <span class="hljs-built_in">names</span><span class="hljs-punctuation">(</span>x<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> stat <span class="hljs-operator">=</span> x <span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> by <span class="hljs-operator">=</span> <span class="hljs-string">'label'</span><span class="hljs-punctuation">)</span><br>p <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>tree2<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> geom_tiplab<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_tippoint<span class="hljs-punctuation">(</span>aes<span class="hljs-punctuation">(</span>color <span class="hljs-operator">=</span> stat<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  scale_color_manual<span class="hljs-punctuation">(</span>values <span class="hljs-operator">=</span> cols<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  theme<span class="hljs-punctuation">(</span>legend.position <span class="hljs-operator">=</span> <span class="hljs-string">"right"</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  xlim<span class="hljs-punctuation">(</span><span class="hljs-literal">NA</span><span class="hljs-punctuation">,</span> <span class="hljs-number">8</span><span class="hljs-punctuation">)</span><br><br>p <span class="hljs-operator">+</span> geom_inset<span class="hljs-punctuation">(</span>pies<span class="hljs-punctuation">,</span> width <span class="hljs-operator">=</span> <span class="hljs-number">.1</span><span class="hljs-punctuation">,</span> height <span class="hljs-operator">=</span> <span class="hljs-number">.1</span><span class="hljs-punctuation">)</span> <br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071520293.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h4 id="多种图像组合注释"><a href="#多种图像组合注释" class="headerlink" title="多种图像组合注释"></a>多种图像组合注释</h4><figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs scss">pies_and_bars &lt;- pies<br><span class="hljs-selector-tag">i</span> &lt;- <span class="hljs-built_in">sample</span>(length(pies), <span class="hljs-number">20</span>)<br>pies_and_bars<span class="hljs-selector-attr">[i]</span> &lt;- bars<span class="hljs-selector-attr">[i]</span><br><span class="hljs-selector-tag">p</span> + <span class="hljs-built_in">geom_inset</span>(pies_and_bars, width=.<span class="hljs-number">08</span>, height=.<span class="hljs-number">05</span>)<br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071521102.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h3 id="Phylomoji注释"><a href="#Phylomoji注释" class="headerlink" title="Phylomoji注释"></a><code>Phylomoji</code>注释</h3><figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs R">library<span class="hljs-punctuation">(</span>ggplot2<span class="hljs-punctuation">)</span><br>library<span class="hljs-punctuation">(</span>ggtree<span class="hljs-punctuation">)</span><br><span class="hljs-comment"># install.packages('emojifont')</span><br><br>tt <span class="hljs-operator">=</span> <span class="hljs-string">'((snail,mushroom),(((sunflower,evergreen_tree),leaves),green_salad));'</span><br>tree <span class="hljs-operator">=</span> read.tree<span class="hljs-punctuation">(</span>text <span class="hljs-operator">=</span> tt<span class="hljs-punctuation">)</span><br>d <span class="hljs-operator">&lt;-</span> data.frame<span class="hljs-punctuation">(</span>label <span class="hljs-operator">=</span> <span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">'snail'</span><span class="hljs-punctuation">,</span><span class="hljs-string">'mushroom'</span><span class="hljs-punctuation">,</span> <span class="hljs-string">'sunflower'</span><span class="hljs-punctuation">,</span><br>                          <span class="hljs-string">'evergreen_tree'</span><span class="hljs-punctuation">,</span><span class="hljs-string">'leaves'</span><span class="hljs-punctuation">,</span> <span class="hljs-string">'green_salad'</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>                group <span class="hljs-operator">=</span> <span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">'animal'</span><span class="hljs-punctuation">,</span> <span class="hljs-string">'fungi'</span><span class="hljs-punctuation">,</span> <span class="hljs-string">'flowering plant'</span><span class="hljs-punctuation">,</span><br>                          <span class="hljs-string">'conifers'</span><span class="hljs-punctuation">,</span> <span class="hljs-string">'ferns'</span><span class="hljs-punctuation">,</span> <span class="hljs-string">'mosses'</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br><br>ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">,</span> linetype <span class="hljs-operator">=</span> <span class="hljs-string">"dashed"</span><span class="hljs-punctuation">,</span> size<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-punctuation">,</span> color<span class="hljs-operator">=</span><span class="hljs-string">'firebrick'</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&lt;+%</span> d <span class="hljs-operator">+</span> <br>  xlim<span class="hljs-punctuation">(</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-number">4.5</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> ylim<span class="hljs-punctuation">(</span><span class="hljs-number">0.5</span><span class="hljs-punctuation">,</span> <span class="hljs-number">6.5</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_tiplab<span class="hljs-punctuation">(</span>parse<span class="hljs-operator">=</span><span class="hljs-string">"emoji"</span><span class="hljs-punctuation">,</span> size<span class="hljs-operator">=</span><span class="hljs-number">15</span><span class="hljs-punctuation">,</span> vjust<span class="hljs-operator">=</span><span class="hljs-number">.25</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_tiplab<span class="hljs-punctuation">(</span>aes<span class="hljs-punctuation">(</span>label <span class="hljs-operator">=</span> group<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> geom<span class="hljs-operator">=</span><span class="hljs-string">"label"</span><span class="hljs-punctuation">,</span> x<span class="hljs-operator">=</span><span class="hljs-number">3.5</span><span class="hljs-punctuation">,</span> hjust<span class="hljs-operator">=</span><span class="hljs-number">.5</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071521792.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h3 id="Emoji注释circular-fan树"><a href="#Emoji注释circular-fan树" class="headerlink" title="Emoji注释circular/fan树"></a><code>Emoji</code>注释circular/fan树</h3><figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs R">p <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">,</span> layout <span class="hljs-operator">=</span> <span class="hljs-string">"circular"</span><span class="hljs-punctuation">,</span> size<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span>  <br>  geom_tiplab<span class="hljs-punctuation">(</span>parse<span class="hljs-operator">=</span><span class="hljs-string">"emoji"</span><span class="hljs-punctuation">,</span> size<span class="hljs-operator">=</span><span class="hljs-number">10</span><span class="hljs-punctuation">,</span> vjust<span class="hljs-operator">=</span><span class="hljs-number">.25</span><span class="hljs-punctuation">)</span><br>print<span class="hljs-punctuation">(</span>p<span class="hljs-punctuation">)</span><br><br><span class="hljs-comment">## fan layout  </span><br>p2 <span class="hljs-operator">&lt;-</span> open_tree<span class="hljs-punctuation">(</span>p<span class="hljs-punctuation">,</span> angle<span class="hljs-operator">=</span><span class="hljs-number">200</span><span class="hljs-punctuation">)</span> <br>print<span class="hljs-punctuation">(</span>p2<span class="hljs-punctuation">)</span><br><br>p2 <span class="hljs-operator">%&gt;%</span> rotate_tree<span class="hljs-punctuation">(</span><span class="hljs-operator">-</span><span class="hljs-number">90</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071521274.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h3 id="Emoji注释clades"><a href="#Emoji注释clades" class="headerlink" title="Emoji注释clades"></a><code>Emoji</code>注释clades</h3><figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs R">set.seed<span class="hljs-punctuation">(</span><span class="hljs-number">123</span><span class="hljs-punctuation">)</span><br>tr <span class="hljs-operator">&lt;-</span> rtree<span class="hljs-punctuation">(</span><span class="hljs-number">30</span><span class="hljs-punctuation">)</span><br><br>ggtree<span class="hljs-punctuation">(</span>tr<span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> xlim<span class="hljs-punctuation">(</span><span class="hljs-literal">NA</span><span class="hljs-punctuation">,</span> <span class="hljs-number">5.2</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>    geom_cladelabel<span class="hljs-punctuation">(</span>node<span class="hljs-operator">=</span><span class="hljs-number">41</span><span class="hljs-punctuation">,</span> label<span class="hljs-operator">=</span><span class="hljs-string">"chicken"</span><span class="hljs-punctuation">,</span> parse<span class="hljs-operator">=</span><span class="hljs-string">"emoji"</span><span class="hljs-punctuation">,</span><br>                    fontsize<span class="hljs-operator">=</span><span class="hljs-number">12</span><span class="hljs-punctuation">,</span> align<span class="hljs-operator">=</span><span class="hljs-literal">TRUE</span><span class="hljs-punctuation">,</span> colour<span class="hljs-operator">=</span><span class="hljs-string">"firebrick"</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>    geom_cladelabel<span class="hljs-punctuation">(</span>node<span class="hljs-operator">=</span><span class="hljs-number">53</span><span class="hljs-punctuation">,</span> label<span class="hljs-operator">=</span><span class="hljs-string">"duck"</span><span class="hljs-punctuation">,</span> parse<span class="hljs-operator">=</span><span class="hljs-string">"emoji"</span><span class="hljs-punctuation">,</span><br>                    fontsize<span class="hljs-operator">=</span><span class="hljs-number">12</span><span class="hljs-punctuation">,</span> align<span class="hljs-operator">=</span><span class="hljs-literal">TRUE</span><span class="hljs-punctuation">,</span> colour<span class="hljs-operator">=</span><span class="hljs-string">"steelblue"</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>    geom_cladelabel<span class="hljs-punctuation">(</span>node<span class="hljs-operator">=</span><span class="hljs-number">48</span><span class="hljs-punctuation">,</span> label<span class="hljs-operator">=</span><span class="hljs-string">"family"</span><span class="hljs-punctuation">,</span> parse<span class="hljs-operator">=</span><span class="hljs-string">"emoji"</span><span class="hljs-punctuation">,</span><br>                    fontsize<span class="hljs-operator">=</span><span class="hljs-number">12</span><span class="hljs-punctuation">,</span> align<span class="hljs-operator">=</span><span class="hljs-literal">TRUE</span><span class="hljs-punctuation">,</span> colour<span class="hljs-operator">=</span><span class="hljs-string">"darkkhaki"</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071521726.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h3 id="AppleColorEmoji"><a href="#AppleColorEmoji" class="headerlink" title="AppleColorEmoji"></a><code>AppleColorEmoji</code></h3><figure class="highlight routeros"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs routeros">library(ggtree)<br>tree_text &lt;- <span class="hljs-string">"(((((cow, (whale, dolphin)), (pig2, boar)), camel), fish), seedling);"</span><br>x &lt;- read.tree(<span class="hljs-attribute">text</span>=tree_text)<br>library(ggimage)<br>library(gridSVG)<br>p &lt;-  ggtree(x, <span class="hljs-attribute">size</span>=2) + geom_tiplab(<span class="hljs-attribute">size</span>=20, <span class="hljs-attribute">parse</span>=<span class="hljs-string">'emoji'</span>) +<br>    xlim(NA, 7) + ylim(NA, 8.5) +<br>    geom_phylopic(<span class="hljs-attribute">image</span>=<span class="hljs-string">"79ad5f09-cf21-4c89-8e7d-0c82a00ce728"</span>,<br>                  <span class="hljs-attribute">color</span>=<span class="hljs-string">"firebrick"</span>, alpha = .3, <span class="hljs-attribute">size</span>=Inf)<br><br>p<br>ps = grid.<span class="hljs-built_in">export</span>(<span class="hljs-string">"emoji.svg"</span>, <span class="hljs-attribute">addClass</span>=T)<br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071521756.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h2 id="ggtree可视化其他数据"><a href="#ggtree可视化其他数据" class="headerlink" title="ggtree可视化其他数据"></a><code>ggtree</code>可视化其他数据</h2><p><code>ggtree</code>支持其他的数据类型，比如树状图（更多格式请移步Y叔博客）：</p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs R">hc <span class="hljs-operator">&lt;-</span> hclust<span class="hljs-punctuation">(</span>dist<span class="hljs-punctuation">(</span>mtcars<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>hc<br>clus <span class="hljs-operator">&lt;-</span> cutree<span class="hljs-punctuation">(</span>hc<span class="hljs-punctuation">,</span> <span class="hljs-number">4</span><span class="hljs-punctuation">)</span><br>g <span class="hljs-operator">&lt;-</span> split<span class="hljs-punctuation">(</span><span class="hljs-built_in">names</span><span class="hljs-punctuation">(</span>clus<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> clus<span class="hljs-punctuation">)</span><br><br>p <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>hc<span class="hljs-punctuation">,</span> linetype<span class="hljs-operator">=</span><span class="hljs-string">'dashed'</span><span class="hljs-punctuation">)</span><br>clades <span class="hljs-operator">&lt;-</span> sapply<span class="hljs-punctuation">(</span>g<span class="hljs-punctuation">,</span> <span class="hljs-keyword">function</span><span class="hljs-punctuation">(</span>n<span class="hljs-punctuation">)</span> MRCA<span class="hljs-punctuation">(</span>p<span class="hljs-punctuation">,</span> n<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br><br>p <span class="hljs-operator">&lt;-</span> groupClade<span class="hljs-punctuation">(</span>p<span class="hljs-punctuation">,</span> clades<span class="hljs-punctuation">,</span> group_name<span class="hljs-operator">=</span><span class="hljs-string">'subtree'</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> aes<span class="hljs-punctuation">(</span>color<span class="hljs-operator">=</span>subtree<span class="hljs-punctuation">)</span><br><br>d <span class="hljs-operator">&lt;-</span> data.frame<span class="hljs-punctuation">(</span>label <span class="hljs-operator">=</span> <span class="hljs-built_in">names</span><span class="hljs-punctuation">(</span>clus<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> <br>                cyl <span class="hljs-operator">=</span> mtcars<span class="hljs-punctuation">[</span><span class="hljs-built_in">names</span><span class="hljs-punctuation">(</span>clus<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"cyl"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">)</span><br><br>p <span class="hljs-operator">%&lt;+%</span> d <span class="hljs-operator">+</span> <br>  layout_dendrogram<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  geom_tippoint<span class="hljs-punctuation">(</span>size<span class="hljs-operator">=</span><span class="hljs-number">5</span><span class="hljs-punctuation">,</span> shape<span class="hljs-operator">=</span><span class="hljs-number">21</span><span class="hljs-punctuation">,</span> aes<span class="hljs-punctuation">(</span>fill<span class="hljs-operator">=</span>factor<span class="hljs-punctuation">(</span>cyl<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> x<span class="hljs-operator">=</span>x<span class="hljs-operator">+</span><span class="hljs-number">.5</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> color<span class="hljs-operator">=</span><span class="hljs-string">'black'</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  geom_tiplab<span class="hljs-punctuation">(</span>aes<span class="hljs-punctuation">(</span>label<span class="hljs-operator">=</span>cyl<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> size<span class="hljs-operator">=</span><span class="hljs-number">3</span><span class="hljs-punctuation">,</span> hjust<span class="hljs-operator">=</span><span class="hljs-number">.5</span><span class="hljs-punctuation">,</span> color<span class="hljs-operator">=</span><span class="hljs-string">'black'</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_tiplab<span class="hljs-punctuation">(</span>angle<span class="hljs-operator">=</span><span class="hljs-number">90</span><span class="hljs-punctuation">,</span> hjust<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-punctuation">,</span> offset<span class="hljs-operator">=</span><span class="hljs-operator">-</span><span class="hljs-number">10</span><span class="hljs-punctuation">,</span> show.legend<span class="hljs-operator">=</span><span class="hljs-built_in">F</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>  scale_color_brewer<span class="hljs-punctuation">(</span>palette<span class="hljs-operator">=</span><span class="hljs-string">'Set1'</span><span class="hljs-punctuation">,</span> breaks<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-operator">:</span><span class="hljs-number">4</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  theme_dendrogram<span class="hljs-punctuation">(</span>plot.margin<span class="hljs-operator">=</span>margin<span class="hljs-punctuation">(</span><span class="hljs-number">6</span><span class="hljs-punctuation">,</span><span class="hljs-number">6</span><span class="hljs-punctuation">,</span><span class="hljs-number">80</span><span class="hljs-punctuation">,</span><span class="hljs-number">6</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  theme<span class="hljs-punctuation">(</span>legend.position<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-number">.9</span><span class="hljs-punctuation">,</span> <span class="hljs-number">.6</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071521771.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h2 id="ggtree拓展ggtreeExtra"><a href="#ggtree拓展ggtreeExtra" class="headerlink" title="ggtree拓展ggtreeExtra"></a><code>ggtree</code>拓展<code>ggtreeExtra</code></h2><p><code>ggtreeExtra</code>真的是惊艳到我了，只能献出我的膝盖啊！</p>
<p><code>ggtree</code>的函数<code>geom_facet()</code>只支持<code>rectangular</code>、 <code>roundrect</code>、 <code>ellipse</code> 及 <code>slanted</code> 这4种输出样式，并不支持在<code>circular</code>、<code>fan</code>及<code>radial</code>这几种输出样式的外环上添加图层，为了解决这个问题，Y叔团队开发了新的R包：<code>ggtreeExtra</code>！</p>
<h3 id="添加微生物组丰度"><a href="#添加微生物组丰度" class="headerlink" title="添加微生物组丰度"></a>添加微生物组丰度</h3><p><code>ggtree</code>直接支持<code>phyloseq</code>对象，这个对做微生物的来说，简直就是福音啊！</p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs R">library<span class="hljs-punctuation">(</span>ggtreeExtra<span class="hljs-punctuation">)</span><br>library<span class="hljs-punctuation">(</span>ggtree<span class="hljs-punctuation">)</span><br>library<span class="hljs-punctuation">(</span>phyloseq<span class="hljs-punctuation">)</span><br>library<span class="hljs-punctuation">(</span>dplyr<span class="hljs-punctuation">)</span><br><br>data<span class="hljs-punctuation">(</span><span class="hljs-string">"GlobalPatterns"</span><span class="hljs-punctuation">)</span><br>GP <span class="hljs-operator">&lt;-</span> GlobalPatterns<br>GP <span class="hljs-operator">&lt;-</span> prune_taxa<span class="hljs-punctuation">(</span>taxa_sums<span class="hljs-punctuation">(</span>GP<span class="hljs-punctuation">)</span> <span class="hljs-operator">&gt;</span> <span class="hljs-number">600</span><span class="hljs-punctuation">,</span> GP<span class="hljs-punctuation">)</span><br>sample_data<span class="hljs-punctuation">(</span>GP<span class="hljs-punctuation">)</span><span class="hljs-operator">$</span>human <span class="hljs-operator">&lt;-</span> get_variable<span class="hljs-punctuation">(</span>GP<span class="hljs-punctuation">,</span> <span class="hljs-string">"SampleType"</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%in%</span><br>                              <span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"Feces"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"Skin"</span><span class="hljs-punctuation">)</span><br>mergedGP <span class="hljs-operator">&lt;-</span> merge_samples<span class="hljs-punctuation">(</span>GP<span class="hljs-punctuation">,</span> <span class="hljs-string">"SampleType"</span><span class="hljs-punctuation">)</span><br>mergedGP <span class="hljs-operator">&lt;-</span> rarefy_even_depth<span class="hljs-punctuation">(</span>mergedGP<span class="hljs-punctuation">,</span>rngseed<span class="hljs-operator">=</span><span class="hljs-number">394582</span><span class="hljs-punctuation">)</span><br>mergedGP <span class="hljs-operator">&lt;-</span> tax_glom<span class="hljs-punctuation">(</span>mergedGP<span class="hljs-punctuation">,</span><span class="hljs-string">"Order"</span><span class="hljs-punctuation">)</span><br><br>melt_simple <span class="hljs-operator">&lt;-</span> psmelt<span class="hljs-punctuation">(</span>mergedGP<span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>               filter<span class="hljs-punctuation">(</span>Abundance <span class="hljs-operator">&lt;</span> <span class="hljs-number">120</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>               select<span class="hljs-punctuation">(</span>OTU<span class="hljs-punctuation">,</span> val<span class="hljs-operator">=</span>Abundance<span class="hljs-punctuation">)</span><br><br>p <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>mergedGP<span class="hljs-punctuation">,</span> layout<span class="hljs-operator">=</span><span class="hljs-string">"fan"</span><span class="hljs-punctuation">,</span> open.angle<span class="hljs-operator">=</span><span class="hljs-number">10</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>     geom_tippoint<span class="hljs-punctuation">(</span>mapping<span class="hljs-operator">=</span>aes<span class="hljs-punctuation">(</span>color<span class="hljs-operator">=</span>Phylum<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> <br>                   size<span class="hljs-operator">=</span><span class="hljs-number">1.5</span><span class="hljs-punctuation">,</span><br>                   show.legend<span class="hljs-operator">=</span><span class="hljs-literal">FALSE</span><span class="hljs-punctuation">)</span><br>p <span class="hljs-operator">&lt;-</span> rotate_tree<span class="hljs-punctuation">(</span>p<span class="hljs-punctuation">,</span> <span class="hljs-operator">-</span><span class="hljs-number">90</span><span class="hljs-punctuation">)</span><br><br>p <span class="hljs-operator">&lt;-</span> p <span class="hljs-operator">+</span><br>     geom_fruit<span class="hljs-punctuation">(</span><br>         data<span class="hljs-operator">=</span>melt_simple<span class="hljs-punctuation">,</span><br>         geom<span class="hljs-operator">=</span>geom_boxplot<span class="hljs-punctuation">,</span><br>         mapping <span class="hljs-operator">=</span> aes<span class="hljs-punctuation">(</span><br>                     y<span class="hljs-operator">=</span>OTU<span class="hljs-punctuation">,</span><br>                     x<span class="hljs-operator">=</span>val<span class="hljs-punctuation">,</span><br>                     group<span class="hljs-operator">=</span>label<span class="hljs-punctuation">,</span><br>                     fill<span class="hljs-operator">=</span>Phylum<span class="hljs-punctuation">,</span><br>                   <span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>         size<span class="hljs-operator">=</span><span class="hljs-number">.2</span><span class="hljs-punctuation">,</span><br>         outlier.size<span class="hljs-operator">=</span><span class="hljs-number">0.5</span><span class="hljs-punctuation">,</span><br>         outlier.stroke<span class="hljs-operator">=</span><span class="hljs-number">0.08</span><span class="hljs-punctuation">,</span><br>         outlier.shape<span class="hljs-operator">=</span><span class="hljs-number">21</span><span class="hljs-punctuation">,</span><br>         axis.params<span class="hljs-operator">=</span><span class="hljs-built_in">list</span><span class="hljs-punctuation">(</span><br>                         axis       <span class="hljs-operator">=</span> <span class="hljs-string">"x"</span><span class="hljs-punctuation">,</span><br>                         text.size  <span class="hljs-operator">=</span> <span class="hljs-number">1.8</span><span class="hljs-punctuation">,</span><br>                         hjust      <span class="hljs-operator">=</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                         vjust      <span class="hljs-operator">=</span> <span class="hljs-number">0.5</span><span class="hljs-punctuation">,</span><br>                         nbreak     <span class="hljs-operator">=</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>                     <span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>         grid.params<span class="hljs-operator">=</span><span class="hljs-built_in">list</span><span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br>     <span class="hljs-punctuation">)</span> <br>     <br>p <span class="hljs-operator">&lt;-</span> p <span class="hljs-operator">+</span><br>     scale_fill_discrete<span class="hljs-punctuation">(</span><br>         name<span class="hljs-operator">=</span><span class="hljs-string">"Phyla"</span><span class="hljs-punctuation">,</span><br>         guide<span class="hljs-operator">=</span>guide_legend<span class="hljs-punctuation">(</span>keywidth<span class="hljs-operator">=</span><span class="hljs-number">0.8</span><span class="hljs-punctuation">,</span> keyheight<span class="hljs-operator">=</span><span class="hljs-number">0.8</span><span class="hljs-punctuation">,</span> ncol<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-punctuation">)</span><br>     <span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>     theme<span class="hljs-punctuation">(</span><br>         legend.title<span class="hljs-operator">=</span>element_text<span class="hljs-punctuation">(</span>size<span class="hljs-operator">=</span><span class="hljs-number">9</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> <span class="hljs-comment"># The title of legend </span><br>         legend.text<span class="hljs-operator">=</span>element_text<span class="hljs-punctuation">(</span>size<span class="hljs-operator">=</span><span class="hljs-number">7</span><span class="hljs-punctuation">)</span> <span class="hljs-comment"># The label text of legend, the sizes should be adjust with dpi.</span><br>     <span class="hljs-punctuation">)</span><br>p<br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071521044.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h3 id="多维数据添加多个图层"><a href="#多维数据添加多个图层" class="headerlink" title="多维数据添加多个图层"></a>多维数据添加多个图层</h3><p><a href="ggtreeExtra-data.zip">⬇点击下载示例数据⬇</a>。</p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><code class="hljs R">library<span class="hljs-punctuation">(</span>ggtreeExtra<span class="hljs-punctuation">)</span><br>library<span class="hljs-punctuation">(</span>ggtree<span class="hljs-punctuation">)</span><br>library<span class="hljs-punctuation">(</span>treeio<span class="hljs-punctuation">)</span><br>library<span class="hljs-punctuation">(</span>tidytree<span class="hljs-punctuation">)</span><br>library<span class="hljs-punctuation">(</span>ggstar<span class="hljs-punctuation">)</span><br>library<span class="hljs-punctuation">(</span>ggplot2<span class="hljs-punctuation">)</span><br>library<span class="hljs-punctuation">(</span>ggnewscale<span class="hljs-punctuation">)</span><br><br>tree <span class="hljs-operator">&lt;-</span> read.tree<span class="hljs-punctuation">(</span><span class="hljs-string">"data/HMP_tree/hmptree.nwk"</span><span class="hljs-punctuation">)</span><br><span class="hljs-comment"># the abundance and types of microbes</span><br>dat1 <span class="hljs-operator">&lt;-</span> read.csv<span class="hljs-punctuation">(</span><span class="hljs-string">"data/HMP_tree/tippoint_attr.csv"</span><span class="hljs-punctuation">)</span><br><span class="hljs-comment"># the abundance of microbes at different body sites.</span><br>dat2 <span class="hljs-operator">&lt;-</span> read.csv<span class="hljs-punctuation">(</span><span class="hljs-string">"data/HMP_tree/ringheatmap_attr.csv"</span><span class="hljs-punctuation">)</span><br><span class="hljs-comment"># the abundance of microbes at the body sites of greatest prevalence.</span><br>dat3 <span class="hljs-operator">&lt;-</span> read.csv<span class="hljs-punctuation">(</span><span class="hljs-string">"data/HMP_tree/barplot_attr.csv"</span><span class="hljs-punctuation">)</span><br><br><span class="hljs-comment"># adjust the order</span><br>dat2<span class="hljs-operator">$</span>Sites <span class="hljs-operator">&lt;-</span> factor<span class="hljs-punctuation">(</span>dat2<span class="hljs-operator">$</span>Sites<span class="hljs-punctuation">,</span> levels<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"Stool (prevalence)"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"Cheek (prevalence)"</span><span class="hljs-punctuation">,</span><br>                                          <span class="hljs-string">"Plaque (prevalence)"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"Tongue (prevalence)"</span><span class="hljs-punctuation">,</span><br>                                          <span class="hljs-string">"Nose (prevalence)"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"Vagina (prevalence)"</span><span class="hljs-punctuation">,</span><br>                                          <span class="hljs-string">"Skin (prevalence)"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>dat3<span class="hljs-operator">$</span>Sites <span class="hljs-operator">&lt;-</span> factor<span class="hljs-punctuation">(</span>dat3<span class="hljs-operator">$</span>Sites<span class="hljs-punctuation">,</span> levels<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"Stool (prevalence)"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"Cheek (prevalence)"</span><span class="hljs-punctuation">,</span><br>                                          <span class="hljs-string">"Plaque (prevalence)"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"Tongue (prevalence)"</span><span class="hljs-punctuation">,</span><br>                                          <span class="hljs-string">"Nose (prevalence)"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"Vagina (prevalence)"</span><span class="hljs-punctuation">,</span><br>                                          <span class="hljs-string">"Skin (prevalence)"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br><span class="hljs-comment"># extract the clade label information. Because some nodes of tree are annotated to genera,</span><br><span class="hljs-comment"># which can be displayed with high light using ggtree.</span><br>nodeids <span class="hljs-operator">&lt;-</span> nodeid<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">,</span> tree<span class="hljs-operator">$</span>node.label<span class="hljs-punctuation">[</span>nchar<span class="hljs-punctuation">(</span>tree<span class="hljs-operator">$</span>node.label<span class="hljs-punctuation">)</span><span class="hljs-operator">&gt;</span><span class="hljs-number">4</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">)</span><br>nodedf <span class="hljs-operator">&lt;-</span> data.frame<span class="hljs-punctuation">(</span>node<span class="hljs-operator">=</span>nodeids<span class="hljs-punctuation">)</span><br>nodelab <span class="hljs-operator">&lt;-</span> gsub<span class="hljs-punctuation">(</span><span class="hljs-string">"[\\.0-9]"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span> tree<span class="hljs-operator">$</span>node.label<span class="hljs-punctuation">[</span>nchar<span class="hljs-punctuation">(</span>tree<span class="hljs-operator">$</span>node.label<span class="hljs-punctuation">)</span><span class="hljs-operator">&gt;</span><span class="hljs-number">4</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">)</span><br><span class="hljs-comment"># The layers of clade and hightlight</span><br>poslist <span class="hljs-operator">&lt;-</span> <span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-number">1.6</span><span class="hljs-punctuation">,</span> <span class="hljs-number">1.4</span><span class="hljs-punctuation">,</span> <span class="hljs-number">1.6</span><span class="hljs-punctuation">,</span> <span class="hljs-number">0.8</span><span class="hljs-punctuation">,</span> <span class="hljs-number">0.1</span><span class="hljs-punctuation">,</span> <span class="hljs-number">0.25</span><span class="hljs-punctuation">,</span> <span class="hljs-number">1.6</span><span class="hljs-punctuation">,</span> <span class="hljs-number">1.6</span><span class="hljs-punctuation">,</span> <span class="hljs-number">1.2</span><span class="hljs-punctuation">,</span> <span class="hljs-number">0.4</span><span class="hljs-punctuation">,</span><br>             <span class="hljs-number">1.2</span><span class="hljs-punctuation">,</span> <span class="hljs-number">1.8</span><span class="hljs-punctuation">,</span> <span class="hljs-number">0.3</span><span class="hljs-punctuation">,</span> <span class="hljs-number">0.8</span><span class="hljs-punctuation">,</span> <span class="hljs-number">0.4</span><span class="hljs-punctuation">,</span> <span class="hljs-number">0.3</span><span class="hljs-punctuation">,</span> <span class="hljs-number">0.4</span><span class="hljs-punctuation">,</span> <span class="hljs-number">0.4</span><span class="hljs-punctuation">,</span> <span class="hljs-number">0.4</span><span class="hljs-punctuation">,</span> <span class="hljs-number">0.6</span><span class="hljs-punctuation">,</span><br>             <span class="hljs-number">0.3</span><span class="hljs-punctuation">,</span> <span class="hljs-number">0.4</span><span class="hljs-punctuation">,</span> <span class="hljs-number">0.3</span><span class="hljs-punctuation">)</span><br>labdf <span class="hljs-operator">&lt;-</span> data.frame<span class="hljs-punctuation">(</span>node<span class="hljs-operator">=</span>nodeids<span class="hljs-punctuation">,</span> label<span class="hljs-operator">=</span>nodelab<span class="hljs-punctuation">,</span> pos<span class="hljs-operator">=</span>poslist<span class="hljs-punctuation">)</span><br><br><span class="hljs-comment"># The circular layout tree.</span><br>p <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>tree<span class="hljs-punctuation">,</span> layout<span class="hljs-operator">=</span><span class="hljs-string">"fan"</span><span class="hljs-punctuation">,</span> size<span class="hljs-operator">=</span><span class="hljs-number">0.15</span><span class="hljs-punctuation">,</span> open.angle<span class="hljs-operator">=</span><span class="hljs-number">5</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>     geom_hilight<span class="hljs-punctuation">(</span>data<span class="hljs-operator">=</span>nodedf<span class="hljs-punctuation">,</span> mapping<span class="hljs-operator">=</span>aes<span class="hljs-punctuation">(</span>node<span class="hljs-operator">=</span>node<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>                  extendto<span class="hljs-operator">=</span><span class="hljs-number">6.8</span><span class="hljs-punctuation">,</span> alpha<span class="hljs-operator">=</span><span class="hljs-number">0.3</span><span class="hljs-punctuation">,</span> fill<span class="hljs-operator">=</span><span class="hljs-string">"grey"</span><span class="hljs-punctuation">,</span> color<span class="hljs-operator">=</span><span class="hljs-string">"grey50"</span><span class="hljs-punctuation">,</span><br>                  size<span class="hljs-operator">=</span><span class="hljs-number">0.05</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>     geom_cladelab<span class="hljs-punctuation">(</span>data<span class="hljs-operator">=</span>labdf<span class="hljs-punctuation">,</span> <br>                   mapping<span class="hljs-operator">=</span>aes<span class="hljs-punctuation">(</span>node<span class="hljs-operator">=</span>node<span class="hljs-punctuation">,</span> <br>                               label<span class="hljs-operator">=</span>label<span class="hljs-punctuation">,</span><br>                               offset.text<span class="hljs-operator">=</span>pos<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>                   hjust<span class="hljs-operator">=</span><span class="hljs-number">0.5</span><span class="hljs-punctuation">,</span><br>                   angle<span class="hljs-operator">=</span><span class="hljs-string">"auto"</span><span class="hljs-punctuation">,</span><br>                   barsize<span class="hljs-operator">=</span><span class="hljs-literal">NA</span><span class="hljs-punctuation">,</span><br>                   horizontal<span class="hljs-operator">=</span><span class="hljs-literal">FALSE</span><span class="hljs-punctuation">,</span> <br>                   fontsize<span class="hljs-operator">=</span><span class="hljs-number">1.4</span><span class="hljs-punctuation">,</span><br>                   fontface<span class="hljs-operator">=</span><span class="hljs-string">"italic"</span><br>                   <span class="hljs-punctuation">)</span><br><br>p <span class="hljs-operator">&lt;-</span> p <span class="hljs-operator">%&lt;+%</span> dat1 <span class="hljs-operator">+</span> geom_star<span class="hljs-punctuation">(</span><br>                        mapping<span class="hljs-operator">=</span>aes<span class="hljs-punctuation">(</span>fill<span class="hljs-operator">=</span>Phylum<span class="hljs-punctuation">,</span> starshape<span class="hljs-operator">=</span>Type<span class="hljs-punctuation">,</span> size<span class="hljs-operator">=</span>Size<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>                        position<span class="hljs-operator">=</span><span class="hljs-string">"identity"</span><span class="hljs-punctuation">,</span>starstroke<span class="hljs-operator">=</span><span class="hljs-number">0.1</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>         scale_fill_manual<span class="hljs-punctuation">(</span>values<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"#FFC125"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"#87CEFA"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"#7B68EE"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"#808080"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"#800080"</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-string">"#9ACD32"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"#D15FEE"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"#FFC0CB"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"#EE6A50"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"#8DEEEE"</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-string">"#006400"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"#800000"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"#B0171F"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"#191970"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>                           guide<span class="hljs-operator">=</span>guide_legend<span class="hljs-punctuation">(</span>keywidth <span class="hljs-operator">=</span> <span class="hljs-number">0.5</span><span class="hljs-punctuation">,</span> keyheight <span class="hljs-operator">=</span> <span class="hljs-number">0.5</span><span class="hljs-punctuation">,</span> order<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                              override.aes<span class="hljs-operator">=</span><span class="hljs-built_in">list</span><span class="hljs-punctuation">(</span>starshape<span class="hljs-operator">=</span><span class="hljs-number">15</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>                           na.translate<span class="hljs-operator">=</span><span class="hljs-literal">FALSE</span><span class="hljs-punctuation">)</span><span class="hljs-operator">+</span><br>         scale_starshape_manual<span class="hljs-punctuation">(</span>values<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-number">15</span><span class="hljs-punctuation">,</span> <span class="hljs-number">1</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>                                guide<span class="hljs-operator">=</span>guide_legend<span class="hljs-punctuation">(</span>keywidth <span class="hljs-operator">=</span> <span class="hljs-number">0.5</span><span class="hljs-punctuation">,</span> keyheight <span class="hljs-operator">=</span> <span class="hljs-number">0.5</span><span class="hljs-punctuation">,</span> order<span class="hljs-operator">=</span><span class="hljs-number">2</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>                                na.translate<span class="hljs-operator">=</span><span class="hljs-literal">FALSE</span><span class="hljs-punctuation">)</span><span class="hljs-operator">+</span><br>         scale_size_continuous<span class="hljs-punctuation">(</span><span class="hljs-built_in">range</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-number">1</span><span class="hljs-punctuation">,</span> <span class="hljs-number">2.5</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>                               guide <span class="hljs-operator">=</span> guide_legend<span class="hljs-punctuation">(</span>keywidth <span class="hljs-operator">=</span> <span class="hljs-number">0.5</span><span class="hljs-punctuation">,</span> keyheight <span class="hljs-operator">=</span> <span class="hljs-number">0.5</span><span class="hljs-punctuation">,</span> order<span class="hljs-operator">=</span><span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>                                                    override.aes<span class="hljs-operator">=</span><span class="hljs-built_in">list</span><span class="hljs-punctuation">(</span>starshape<span class="hljs-operator">=</span><span class="hljs-number">15</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>                                                    <br>p <span class="hljs-operator">&lt;-</span> p <span class="hljs-operator">+</span> new_scale_fill<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>         geom_fruit<span class="hljs-punctuation">(</span>data<span class="hljs-operator">=</span>dat2<span class="hljs-punctuation">,</span> geom<span class="hljs-operator">=</span>geom_tile<span class="hljs-punctuation">,</span><br>                    mapping<span class="hljs-operator">=</span>aes<span class="hljs-punctuation">(</span>y<span class="hljs-operator">=</span>ID<span class="hljs-punctuation">,</span> x<span class="hljs-operator">=</span>Sites<span class="hljs-punctuation">,</span> alpha<span class="hljs-operator">=</span>Abundance<span class="hljs-punctuation">,</span> fill<span class="hljs-operator">=</span>Sites<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>                    color <span class="hljs-operator">=</span> <span class="hljs-string">"grey50"</span><span class="hljs-punctuation">,</span> offset <span class="hljs-operator">=</span> <span class="hljs-number">0.04</span><span class="hljs-punctuation">,</span>size <span class="hljs-operator">=</span> <span class="hljs-number">0.02</span><span class="hljs-punctuation">)</span><span class="hljs-operator">+</span><br>         scale_alpha_continuous<span class="hljs-punctuation">(</span><span class="hljs-built_in">range</span><span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-number">1</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>                             guide<span class="hljs-operator">=</span>guide_legend<span class="hljs-punctuation">(</span>keywidth <span class="hljs-operator">=</span> <span class="hljs-number">0.3</span><span class="hljs-punctuation">,</span> keyheight <span class="hljs-operator">=</span> <span class="hljs-number">0.3</span><span class="hljs-punctuation">,</span> order<span class="hljs-operator">=</span><span class="hljs-number">5</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>         geom_fruit<span class="hljs-punctuation">(</span>data<span class="hljs-operator">=</span>dat3<span class="hljs-punctuation">,</span> geom<span class="hljs-operator">=</span>geom_bar<span class="hljs-punctuation">,</span><br>                    mapping<span class="hljs-operator">=</span>aes<span class="hljs-punctuation">(</span>y<span class="hljs-operator">=</span>ID<span class="hljs-punctuation">,</span> x<span class="hljs-operator">=</span>HigherAbundance<span class="hljs-punctuation">,</span> fill<span class="hljs-operator">=</span>Sites<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>                    pwidth<span class="hljs-operator">=</span><span class="hljs-number">0.38</span><span class="hljs-punctuation">,</span> <br>                    orientation<span class="hljs-operator">=</span><span class="hljs-string">"y"</span><span class="hljs-punctuation">,</span> <br>                    stat<span class="hljs-operator">=</span><span class="hljs-string">"identity"</span><span class="hljs-punctuation">,</span><br>         <span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>         scale_fill_manual<span class="hljs-punctuation">(</span>values<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"#0000FF"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"#FFA500"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"#FF0000"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"#800000"</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-string">"#006400"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"#800080"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"#696969"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>                           guide<span class="hljs-operator">=</span>guide_legend<span class="hljs-punctuation">(</span>keywidth <span class="hljs-operator">=</span> <span class="hljs-number">0.3</span><span class="hljs-punctuation">,</span> keyheight <span class="hljs-operator">=</span> <span class="hljs-number">0.3</span><span class="hljs-punctuation">,</span> order<span class="hljs-operator">=</span><span class="hljs-number">4</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-operator">+</span><br>         geom_treescale<span class="hljs-punctuation">(</span>fontsize<span class="hljs-operator">=</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span> linesize<span class="hljs-operator">=</span><span class="hljs-number">0.3</span><span class="hljs-punctuation">,</span> x<span class="hljs-operator">=</span><span class="hljs-number">4.9</span><span class="hljs-punctuation">,</span> y<span class="hljs-operator">=</span><span class="hljs-number">0.1</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>         theme<span class="hljs-punctuation">(</span>legend.position<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-number">0.93</span><span class="hljs-punctuation">,</span> <span class="hljs-number">0.5</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>               legend.background<span class="hljs-operator">=</span>element_rect<span class="hljs-punctuation">(</span>fill<span class="hljs-operator">=</span><span class="hljs-literal">NA</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>               legend.title<span class="hljs-operator">=</span>element_text<span class="hljs-punctuation">(</span>size<span class="hljs-operator">=</span><span class="hljs-number">6.5</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>               legend.text<span class="hljs-operator">=</span>element_text<span class="hljs-punctuation">(</span>size<span class="hljs-operator">=</span><span class="hljs-number">4.5</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>               legend.spacing.y <span class="hljs-operator">=</span> unit<span class="hljs-punctuation">(</span><span class="hljs-number">0.02</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"cm"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>             <span class="hljs-punctuation">)</span><br>p<br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071521659.png" srcset="/img/loading.gif" lazyload alt=""></p>
<p>另外一种输出方式：</p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R">p <span class="hljs-operator">+</span> layout_rectangular<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>    theme<span class="hljs-punctuation">(</span>legend.position<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-number">.05</span><span class="hljs-punctuation">,</span> <span class="hljs-number">.7</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071521711.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h2 id="群体遗学传例子"><a href="#群体遗学传例子" class="headerlink" title="群体遗学传例子"></a>群体遗学传例子</h2><figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><code class="hljs R">library<span class="hljs-punctuation">(</span>ggtree<span class="hljs-punctuation">)</span><br>library<span class="hljs-punctuation">(</span>ggtreeExtra<span class="hljs-punctuation">)</span><br>library<span class="hljs-punctuation">(</span>ggplot2<span class="hljs-punctuation">)</span><br>library<span class="hljs-punctuation">(</span>ggnewscale<span class="hljs-punctuation">)</span><br>library<span class="hljs-punctuation">(</span>dplyr<span class="hljs-punctuation">)</span><br>library<span class="hljs-punctuation">(</span>tidytree<span class="hljs-punctuation">)</span><br>library<span class="hljs-punctuation">(</span>ggstar<span class="hljs-punctuation">)</span><br><br>dat <span class="hljs-operator">&lt;-</span> read.csv<span class="hljs-punctuation">(</span><span class="hljs-string">"data/microreact/Candida_auris/microreact-project-Candidaauris-data.csv"</span><span class="hljs-punctuation">)</span><br>tr <span class="hljs-operator">&lt;-</span> read.tree<span class="hljs-punctuation">(</span><span class="hljs-string">"data/microreact/Candida_auris/microreact-project-Candidaauris-tree.nwk"</span><span class="hljs-punctuation">)</span><br><br>countries <span class="hljs-operator">&lt;-</span> <span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"Canada"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"United States"</span><span class="hljs-punctuation">,</span><br>               <span class="hljs-string">"Colombia"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"Panama"</span><span class="hljs-punctuation">,</span><br>               <span class="hljs-string">"Venezuela"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"France"</span><span class="hljs-punctuation">,</span><br>               <span class="hljs-string">"Germany"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"Spain"</span><span class="hljs-punctuation">,</span><br>               <span class="hljs-string">"UK"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"India"</span><span class="hljs-punctuation">,</span><br>               <span class="hljs-string">"Israel"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"Pakistan"</span><span class="hljs-punctuation">,</span><br>               <span class="hljs-string">"Saudi Arabia"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"United Arab Emirates"</span><span class="hljs-punctuation">,</span><br>               <span class="hljs-string">"Kenya"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"South Africa"</span><span class="hljs-punctuation">,</span><br>               <span class="hljs-string">"Japan"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"South Korea"</span><span class="hljs-punctuation">,</span><br>               <span class="hljs-string">"Australia"</span><span class="hljs-punctuation">)</span><br><span class="hljs-comment"># For the tip points</span><br>dat1 <span class="hljs-operator">&lt;-</span> dat <span class="hljs-operator">%&gt;%</span> select<span class="hljs-punctuation">(</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"ID"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"COUNTRY"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"COUNTRY__colour"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>dat1<span class="hljs-operator">$</span>COUNTRY <span class="hljs-operator">&lt;-</span> factor<span class="hljs-punctuation">(</span>dat1<span class="hljs-operator">$</span>COUNTRY<span class="hljs-punctuation">,</span> levels<span class="hljs-operator">=</span>countries<span class="hljs-punctuation">)</span><br>COUNTRYcolors <span class="hljs-operator">&lt;-</span> dat1<span class="hljs-punctuation">[</span>match<span class="hljs-punctuation">(</span>countries<span class="hljs-punctuation">,</span>dat<span class="hljs-operator">$</span>COUNTRY<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><span class="hljs-string">"COUNTRY__colour"</span><span class="hljs-punctuation">]</span><br><br><span class="hljs-comment"># For the heatmap layer</span><br>dat2 <span class="hljs-operator">&lt;-</span> dat <span class="hljs-operator">%&gt;%</span> select<span class="hljs-punctuation">(</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"ID"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"FCZ"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"AMB"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"MCF"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>dat2 <span class="hljs-operator">&lt;-</span> reshape2<span class="hljs-operator">::</span>melt<span class="hljs-punctuation">(</span>dat2<span class="hljs-punctuation">,</span>id<span class="hljs-operator">=</span><span class="hljs-string">"ID"</span><span class="hljs-punctuation">,</span> variable.name<span class="hljs-operator">=</span><span class="hljs-string">"Antifungal"</span><span class="hljs-punctuation">,</span> value.name<span class="hljs-operator">=</span><span class="hljs-string">"type"</span><span class="hljs-punctuation">)</span><br>dat2<span class="hljs-operator">$</span>type <span class="hljs-operator">&lt;-</span> paste<span class="hljs-punctuation">(</span>dat2<span class="hljs-operator">$</span>Antifungal<span class="hljs-punctuation">,</span> dat2<span class="hljs-operator">$</span>type<span class="hljs-punctuation">)</span><br>dat2<span class="hljs-operator">$</span>type <span class="hljs-operator">&lt;-</span> unlist<span class="hljs-punctuation">(</span>lapply<span class="hljs-punctuation">(</span>dat2<span class="hljs-operator">$</span>type<span class="hljs-punctuation">,</span><br>                           <span class="hljs-keyword">function</span><span class="hljs-punctuation">(</span>x<span class="hljs-punctuation">)</span>ifelse<span class="hljs-punctuation">(</span>grepl<span class="hljs-punctuation">(</span><span class="hljs-string">"Not_"</span><span class="hljs-punctuation">,</span> x<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"Susceptible"</span><span class="hljs-punctuation">,</span> x<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>dat2<span class="hljs-operator">$</span>Antifungal <span class="hljs-operator">&lt;-</span> factor<span class="hljs-punctuation">(</span>dat2<span class="hljs-operator">$</span>Antifungal<span class="hljs-punctuation">,</span> levels<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"FCZ"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"AMB"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"MCF"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>dat2<span class="hljs-operator">$</span>type <span class="hljs-operator">&lt;-</span> factor<span class="hljs-punctuation">(</span>dat2<span class="hljs-operator">$</span>type<span class="hljs-punctuation">,</span><br>                    levels<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"FCZ Resistant"</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-string">"AMB Resistant"</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-string">"MCF Resistant"</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-string">"Susceptible"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br><br><span class="hljs-comment"># For the points layer</span><br>dat3 <span class="hljs-operator">&lt;-</span> dat <span class="hljs-operator">%&gt;%</span> select<span class="hljs-punctuation">(</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"ID"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"ERG11"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"FKS1"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>        reshape2<span class="hljs-operator">::</span>melt<span class="hljs-punctuation">(</span>id<span class="hljs-operator">=</span><span class="hljs-string">"ID"</span><span class="hljs-punctuation">,</span> variable.name<span class="hljs-operator">=</span><span class="hljs-string">"point"</span><span class="hljs-punctuation">,</span> value.name<span class="hljs-operator">=</span><span class="hljs-string">"mutation"</span><span class="hljs-punctuation">)</span><br>dat3<span class="hljs-operator">$</span>mutation <span class="hljs-operator">&lt;-</span> paste<span class="hljs-punctuation">(</span>dat3<span class="hljs-operator">$</span>point<span class="hljs-punctuation">,</span> dat3<span class="hljs-operator">$</span>mutation<span class="hljs-punctuation">)</span><br>dat3<span class="hljs-operator">$</span>mutation <span class="hljs-operator">&lt;-</span> unlist<span class="hljs-punctuation">(</span>lapply<span class="hljs-punctuation">(</span>dat3<span class="hljs-operator">$</span>mutation<span class="hljs-punctuation">,</span> <span class="hljs-keyword">function</span><span class="hljs-punctuation">(</span>x<span class="hljs-punctuation">)</span>ifelse<span class="hljs-punctuation">(</span>grepl<span class="hljs-punctuation">(</span><span class="hljs-string">"WT"</span><span class="hljs-punctuation">,</span>x<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> <span class="hljs-literal">NA</span><span class="hljs-punctuation">,</span>x<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>dat3<span class="hljs-operator">$</span>mutation <span class="hljs-operator">&lt;-</span> factor<span class="hljs-punctuation">(</span>dat3<span class="hljs-operator">$</span>mutation<span class="hljs-punctuation">,</span> levels<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"ERG11 Y132F"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"ERG11 K143R"</span><span class="hljs-punctuation">,</span><br>                                                <span class="hljs-string">"ERG11 F126L"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"FKS1 S639Y/P/F"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br><br><span class="hljs-comment"># For the clade group</span><br>dat4 <span class="hljs-operator">&lt;-</span> dat <span class="hljs-operator">%&gt;%</span> select<span class="hljs-punctuation">(</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"ID"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"CLADE"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>dat4 <span class="hljs-operator">&lt;-</span> aggregate<span class="hljs-punctuation">(</span>.<span class="hljs-operator">~</span>CLADE<span class="hljs-punctuation">,</span> dat4<span class="hljs-punctuation">,</span> FUN<span class="hljs-operator">=</span>paste<span class="hljs-punctuation">,</span> collapse<span class="hljs-operator">=</span><span class="hljs-string">","</span><span class="hljs-punctuation">)</span><br>clades <span class="hljs-operator">&lt;-</span> lapply<span class="hljs-punctuation">(</span>dat4<span class="hljs-operator">$</span>ID<span class="hljs-punctuation">,</span> <span class="hljs-keyword">function</span><span class="hljs-punctuation">(</span>x<span class="hljs-punctuation">)</span><span class="hljs-punctuation">{</span>unlist<span class="hljs-punctuation">(</span>strsplit<span class="hljs-punctuation">(</span>x<span class="hljs-punctuation">,</span>split<span class="hljs-operator">=</span><span class="hljs-string">","</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">)</span><br><span class="hljs-built_in">names</span><span class="hljs-punctuation">(</span>clades<span class="hljs-punctuation">)</span> <span class="hljs-operator">&lt;-</span> dat4<span class="hljs-operator">$</span>CLADE<br><br>tr <span class="hljs-operator">&lt;-</span> groupOTU<span class="hljs-punctuation">(</span>tr<span class="hljs-punctuation">,</span> clades<span class="hljs-punctuation">,</span> <span class="hljs-string">"Clade"</span><span class="hljs-punctuation">)</span><br>Clade <span class="hljs-operator">&lt;-</span> <span class="hljs-literal">NULL</span><br>p <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>tr<span class="hljs-operator">=</span>tr<span class="hljs-punctuation">,</span> layout<span class="hljs-operator">=</span><span class="hljs-string">"fan"</span><span class="hljs-punctuation">,</span> open.angle<span class="hljs-operator">=</span><span class="hljs-number">15</span><span class="hljs-punctuation">,</span> size<span class="hljs-operator">=</span><span class="hljs-number">0.2</span><span class="hljs-punctuation">,</span> aes<span class="hljs-punctuation">(</span>colour<span class="hljs-operator">=</span>Clade<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>     scale_colour_manual<span class="hljs-punctuation">(</span><br>         values<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"black"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"#69B920"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"#9C2E88"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"#F74B00"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"#60C3DB"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>         labels<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">""</span><span class="hljs-punctuation">,</span><span class="hljs-string">"I"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"II"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"III"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"IV"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>         guide<span class="hljs-operator">=</span>guide_legend<span class="hljs-punctuation">(</span>keywidth<span class="hljs-operator">=</span><span class="hljs-number">0.5</span><span class="hljs-punctuation">,</span><br>                            keyheight<span class="hljs-operator">=</span><span class="hljs-number">0.5</span><span class="hljs-punctuation">,</span><br>                            order<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                            override.aes<span class="hljs-operator">=</span><span class="hljs-built_in">list</span><span class="hljs-punctuation">(</span>linetype<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"0"</span><span class="hljs-operator">=</span><span class="hljs-literal">NA</span><span class="hljs-punctuation">,</span><br>                                                         <span class="hljs-string">"Clade1"</span><span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                                         <span class="hljs-string">"Clade2"</span><span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                                         <span class="hljs-string">"Clade3"</span><span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                                         <span class="hljs-string">"Clade4"</span><span class="hljs-operator">=</span><span class="hljs-number">1</span><br>                                                        <span class="hljs-punctuation">)</span><br>                                             <span class="hljs-punctuation">)</span><br>                           <span class="hljs-punctuation">)</span><br>     <span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>     new_scale_colour<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br><br>p1 <span class="hljs-operator">&lt;-</span> p <span class="hljs-operator">%&lt;+%</span> dat1 <span class="hljs-operator">+</span><br>     geom_tippoint<span class="hljs-punctuation">(</span>aes<span class="hljs-punctuation">(</span>colour<span class="hljs-operator">=</span>COUNTRY<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>                   alpha<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>     geom_tiplab<span class="hljs-punctuation">(</span>aes<span class="hljs-punctuation">(</span>colour<span class="hljs-operator">=</span>COUNTRY<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>                   align<span class="hljs-operator">=</span><span class="hljs-literal">TRUE</span><span class="hljs-punctuation">,</span><br>                   linetype<span class="hljs-operator">=</span><span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>                   size<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                   linesize<span class="hljs-operator">=</span><span class="hljs-number">0.2</span><span class="hljs-punctuation">,</span><br>                   show.legend<span class="hljs-operator">=</span><span class="hljs-literal">FALSE</span><br>                   <span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>     scale_colour_manual<span class="hljs-punctuation">(</span><br>         name<span class="hljs-operator">=</span><span class="hljs-string">"Country labels"</span><span class="hljs-punctuation">,</span><br>         values<span class="hljs-operator">=</span>COUNTRYcolors<span class="hljs-punctuation">,</span><br>         guide<span class="hljs-operator">=</span>guide_legend<span class="hljs-punctuation">(</span>keywidth<span class="hljs-operator">=</span><span class="hljs-number">0.5</span><span class="hljs-punctuation">,</span><br>                            keyheight<span class="hljs-operator">=</span><span class="hljs-number">0.5</span><span class="hljs-punctuation">,</span><br>                            order<span class="hljs-operator">=</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>                            override.aes<span class="hljs-operator">=</span><span class="hljs-built_in">list</span><span class="hljs-punctuation">(</span>size<span class="hljs-operator">=</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span>alpha<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>     <span class="hljs-punctuation">)</span><br><br>p2 <span class="hljs-operator">&lt;-</span> p1 <span class="hljs-operator">+</span><br>      geom_fruit<span class="hljs-punctuation">(</span><br>          data<span class="hljs-operator">=</span>dat2<span class="hljs-punctuation">,</span><br>          geom<span class="hljs-operator">=</span>geom_tile<span class="hljs-punctuation">,</span><br>          mapping<span class="hljs-operator">=</span>aes<span class="hljs-punctuation">(</span>x<span class="hljs-operator">=</span>Antifungal<span class="hljs-punctuation">,</span> y<span class="hljs-operator">=</span>ID<span class="hljs-punctuation">,</span> fill<span class="hljs-operator">=</span>type<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>          width<span class="hljs-operator">=</span><span class="hljs-number">0.1</span><span class="hljs-punctuation">,</span><br>          color<span class="hljs-operator">=</span><span class="hljs-string">"white"</span><span class="hljs-punctuation">,</span><br>          pwidth<span class="hljs-operator">=</span><span class="hljs-number">0.1</span><span class="hljs-punctuation">,</span><br>          offset<span class="hljs-operator">=</span><span class="hljs-number">0.15</span><br>      <span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>      scale_fill_manual<span class="hljs-punctuation">(</span><br>           name<span class="hljs-operator">=</span><span class="hljs-string">"Antifungal susceptibility"</span><span class="hljs-punctuation">,</span><br>           values<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"#595959"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"#B30000"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"#020099"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"#E6E6E6"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>           na.translate<span class="hljs-operator">=</span><span class="hljs-literal">FALSE</span><span class="hljs-punctuation">,</span><br>           guide<span class="hljs-operator">=</span>guide_legend<span class="hljs-punctuation">(</span>keywidth<span class="hljs-operator">=</span><span class="hljs-number">0.5</span><span class="hljs-punctuation">,</span><br>                              keyheight<span class="hljs-operator">=</span><span class="hljs-number">0.5</span><span class="hljs-punctuation">,</span><br>                              order<span class="hljs-operator">=</span><span class="hljs-number">3</span><br>                             <span class="hljs-punctuation">)</span><br>      <span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>      new_scale_fill<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br><br>p3 <span class="hljs-operator">&lt;-</span> p2 <span class="hljs-operator">+</span><br>      geom_fruit<span class="hljs-punctuation">(</span><br>          data<span class="hljs-operator">=</span>dat3<span class="hljs-punctuation">,</span><br>          geom<span class="hljs-operator">=</span>geom_star<span class="hljs-punctuation">,</span><br>          mapping<span class="hljs-operator">=</span>aes<span class="hljs-punctuation">(</span>x<span class="hljs-operator">=</span>mutation<span class="hljs-punctuation">,</span> y<span class="hljs-operator">=</span>ID<span class="hljs-punctuation">,</span> fill<span class="hljs-operator">=</span>mutation<span class="hljs-punctuation">,</span> starshape<span class="hljs-operator">=</span>point<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>          size<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>          starstroke<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>          pwidth<span class="hljs-operator">=</span><span class="hljs-number">0.1</span><span class="hljs-punctuation">,</span><br>          inherit.aes <span class="hljs-operator">=</span> <span class="hljs-literal">FALSE</span><span class="hljs-punctuation">,</span><br>          grid.params<span class="hljs-operator">=</span><span class="hljs-built_in">list</span><span class="hljs-punctuation">(</span><br>                          linetype<span class="hljs-operator">=</span><span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>                          size<span class="hljs-operator">=</span><span class="hljs-number">0.2</span><br>                      <span class="hljs-punctuation">)</span><br><br>      <span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>      scale_fill_manual<span class="hljs-punctuation">(</span><br>          name<span class="hljs-operator">=</span><span class="hljs-string">"Point mutations"</span><span class="hljs-punctuation">,</span><br>          values<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"#329901"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"#0600FF"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"#FF0100"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"#9900CC"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>          guide<span class="hljs-operator">=</span>guide_legend<span class="hljs-punctuation">(</span>keywidth<span class="hljs-operator">=</span><span class="hljs-number">0.5</span><span class="hljs-punctuation">,</span> keyheight<span class="hljs-operator">=</span><span class="hljs-number">0.5</span><span class="hljs-punctuation">,</span> order<span class="hljs-operator">=</span><span class="hljs-number">4</span><span class="hljs-punctuation">,</span><br>                             override.aes<span class="hljs-operator">=</span><span class="hljs-built_in">list</span><span class="hljs-punctuation">(</span>starshape<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"ERG11 Y132F"</span><span class="hljs-operator">=</span><span class="hljs-number">15</span><span class="hljs-punctuation">,</span><br>                                                           <span class="hljs-string">"ERG11 K143R"</span><span class="hljs-operator">=</span><span class="hljs-number">15</span><span class="hljs-punctuation">,</span><br>                                                           <span class="hljs-string">"ERG11 F126L"</span><span class="hljs-operator">=</span><span class="hljs-number">15</span><span class="hljs-punctuation">,</span><br>                                                           <span class="hljs-string">"FKS1 S639Y/P/F"</span><span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>                                               size<span class="hljs-operator">=</span><span class="hljs-number">2</span><span class="hljs-punctuation">)</span><br>                            <span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>          na.translate<span class="hljs-operator">=</span><span class="hljs-literal">FALSE</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>      scale_starshape_manual<span class="hljs-punctuation">(</span><br>          values<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-number">15</span><span class="hljs-punctuation">,</span> <span class="hljs-number">1</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>          guide<span class="hljs-operator">=</span><span class="hljs-string">"none"</span><br>      <span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>      theme<span class="hljs-punctuation">(</span><br>          legend.background<span class="hljs-operator">=</span>element_rect<span class="hljs-punctuation">(</span>fill<span class="hljs-operator">=</span><span class="hljs-literal">NA</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>          legend.title<span class="hljs-operator">=</span>element_text<span class="hljs-punctuation">(</span>size<span class="hljs-operator">=</span><span class="hljs-number">7</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> <span class="hljs-comment"># The size should be adjusted with different devout.</span><br>          legend.text<span class="hljs-operator">=</span>element_text<span class="hljs-punctuation">(</span>size<span class="hljs-operator">=</span><span class="hljs-number">5.5</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>          legend.spacing.y <span class="hljs-operator">=</span> unit<span class="hljs-punctuation">(</span><span class="hljs-number">0.02</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"cm"</span><span class="hljs-punctuation">)</span><br>      <span class="hljs-punctuation">)</span><br>p3<br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071521751.png" srcset="/img/loading.gif" lazyload alt=""></p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><code class="hljs R">library<span class="hljs-punctuation">(</span>ggtreeExtra<span class="hljs-punctuation">)</span><br>library<span class="hljs-punctuation">(</span>ggtree<span class="hljs-punctuation">)</span><br>library<span class="hljs-punctuation">(</span>ggplot2<span class="hljs-punctuation">)</span><br>library<span class="hljs-punctuation">(</span>ggnewscale<span class="hljs-punctuation">)</span><br>library<span class="hljs-punctuation">(</span>treeio<span class="hljs-punctuation">)</span><br>library<span class="hljs-punctuation">(</span>tidytree<span class="hljs-punctuation">)</span><br>library<span class="hljs-punctuation">(</span>dplyr<span class="hljs-punctuation">)</span><br>library<span class="hljs-punctuation">(</span>ggstar<span class="hljs-punctuation">)</span><br><br>tr <span class="hljs-operator">&lt;-</span> read.tree<span class="hljs-punctuation">(</span><span class="hljs-string">"data/microreact/Salmonella_Typhi/microreact-project-NJIDqgsS-tree.nwk"</span><span class="hljs-punctuation">)</span><br><br>metada <span class="hljs-operator">&lt;-</span> read.csv<span class="hljs-punctuation">(</span><span class="hljs-string">"data/microreact/Salmonella_Typhi/microreact-project-NJIDqgsS-data.csv"</span><span class="hljs-punctuation">)</span><br><br>metadata <span class="hljs-operator">&lt;-</span> metada <span class="hljs-operator">%&gt;%</span><br>            select<span class="hljs-punctuation">(</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"id"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"country"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"country__colour"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"year"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"year__colour"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"haplotype"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>metadata<span class="hljs-operator">$</span>haplotype <span class="hljs-operator">&lt;-</span> unlist<span class="hljs-punctuation">(</span>lapply<span class="hljs-punctuation">(</span>metadata<span class="hljs-operator">$</span>haplotype<span class="hljs-punctuation">,</span> <span class="hljs-keyword">function</span><span class="hljs-punctuation">(</span>x<span class="hljs-punctuation">)</span>ifelse<span class="hljs-punctuation">(</span>nchar<span class="hljs-punctuation">(</span>x<span class="hljs-punctuation">)</span><span class="hljs-operator">&gt;</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span>x<span class="hljs-punctuation">,</span><span class="hljs-literal">NA</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br><br>countrycolors <span class="hljs-operator">&lt;-</span> metada <span class="hljs-operator">%&gt;%</span><br>                 select<span class="hljs-punctuation">(</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"country"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"country__colour"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>                 distinct<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br><br>yearcolors <span class="hljs-operator">&lt;-</span> metada <span class="hljs-operator">%&gt;%</span><br>              select<span class="hljs-punctuation">(</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"year"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"year__colour"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>              distinct<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br>yearcolors <span class="hljs-operator">&lt;-</span> yearcolors<span class="hljs-punctuation">[</span>order<span class="hljs-punctuation">(</span>yearcolors<span class="hljs-operator">$</span>year<span class="hljs-punctuation">,</span> decreasing<span class="hljs-operator">=</span><span class="hljs-literal">TRUE</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">]</span><br><br>metadata<span class="hljs-operator">$</span>country <span class="hljs-operator">&lt;-</span> factor<span class="hljs-punctuation">(</span>metadata<span class="hljs-operator">$</span>country<span class="hljs-punctuation">,</span> levels<span class="hljs-operator">=</span>countrycolors<span class="hljs-operator">$</span>country<span class="hljs-punctuation">)</span><br>metadata<span class="hljs-operator">$</span>year <span class="hljs-operator">&lt;-</span> factor<span class="hljs-punctuation">(</span>metadata<span class="hljs-operator">$</span>year<span class="hljs-punctuation">,</span> levels<span class="hljs-operator">=</span>yearcolors<span class="hljs-operator">$</span>year<span class="hljs-punctuation">)</span><br><br>p <span class="hljs-operator">&lt;-</span> ggtree<span class="hljs-punctuation">(</span>tr<span class="hljs-punctuation">,</span> layout<span class="hljs-operator">=</span><span class="hljs-string">"fan"</span><span class="hljs-punctuation">,</span> open.angle<span class="hljs-operator">=</span><span class="hljs-number">15</span><span class="hljs-punctuation">,</span> size<span class="hljs-operator">=</span><span class="hljs-number">0.1</span><span class="hljs-punctuation">)</span><br><br>p <span class="hljs-operator">&lt;-</span> p <span class="hljs-operator">%&lt;+%</span> metadata<br><br>p1 <span class="hljs-operator">&lt;-</span>p <span class="hljs-operator">+</span><br>     geom_tippoint<span class="hljs-punctuation">(</span><br>         mapping<span class="hljs-operator">=</span>aes<span class="hljs-punctuation">(</span>colour<span class="hljs-operator">=</span>country<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>         size<span class="hljs-operator">=</span><span class="hljs-number">1.5</span><span class="hljs-punctuation">,</span><br>         stroke<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>         alpha<span class="hljs-operator">=</span><span class="hljs-number">0.4</span><br>     <span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>     scale_colour_manual<span class="hljs-punctuation">(</span><br>         name<span class="hljs-operator">=</span><span class="hljs-string">"Country"</span><span class="hljs-punctuation">,</span><br>         values<span class="hljs-operator">=</span>countrycolors<span class="hljs-operator">$</span>country__colour<span class="hljs-punctuation">,</span><br>         guide<span class="hljs-operator">=</span>guide_legend<span class="hljs-punctuation">(</span>keywidth<span class="hljs-operator">=</span><span class="hljs-number">0.3</span><span class="hljs-punctuation">,</span><br>                            keyheight<span class="hljs-operator">=</span><span class="hljs-number">0.3</span><span class="hljs-punctuation">,</span><br>                            ncol<span class="hljs-operator">=</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>                            override.aes<span class="hljs-operator">=</span><span class="hljs-built_in">list</span><span class="hljs-punctuation">(</span>size<span class="hljs-operator">=</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span>alpha<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>                            order<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-punctuation">)</span><br>     <span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>     theme<span class="hljs-punctuation">(</span><br>         legend.title<span class="hljs-operator">=</span>element_text<span class="hljs-punctuation">(</span>size<span class="hljs-operator">=</span><span class="hljs-number">5</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>         legend.text<span class="hljs-operator">=</span>element_text<span class="hljs-punctuation">(</span>size<span class="hljs-operator">=</span><span class="hljs-number">4</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>         legend.spacing.y <span class="hljs-operator">=</span> unit<span class="hljs-punctuation">(</span><span class="hljs-number">0.02</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"cm"</span><span class="hljs-punctuation">)</span><br>     <span class="hljs-punctuation">)</span><br><br>p2 <span class="hljs-operator">&lt;-</span>p1 <span class="hljs-operator">+</span><br>     geom_fruit<span class="hljs-punctuation">(</span><br>         geom<span class="hljs-operator">=</span>geom_star<span class="hljs-punctuation">,</span><br>         mapping<span class="hljs-operator">=</span>aes<span class="hljs-punctuation">(</span>fill<span class="hljs-operator">=</span>haplotype<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>         starshape<span class="hljs-operator">=</span><span class="hljs-number">26</span><span class="hljs-punctuation">,</span><br>         color<span class="hljs-operator">=</span><span class="hljs-literal">NA</span><span class="hljs-punctuation">,</span><br>         size<span class="hljs-operator">=</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>         starstroke<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>         offset<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>     <span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>     scale_fill_manual<span class="hljs-punctuation">(</span><br>         name<span class="hljs-operator">=</span><span class="hljs-string">"Haplotype"</span><span class="hljs-punctuation">,</span><br>         values<span class="hljs-operator">=</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">"red"</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>         guide<span class="hljs-operator">=</span>guide_legend<span class="hljs-punctuation">(</span><br>                   keywidth<span class="hljs-operator">=</span><span class="hljs-number">0.3</span><span class="hljs-punctuation">,</span><br>                   keyheight<span class="hljs-operator">=</span><span class="hljs-number">0.3</span><span class="hljs-punctuation">,</span><br>                   order<span class="hljs-operator">=</span><span class="hljs-number">3</span><br>               <span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>         na.translate<span class="hljs-operator">=</span><span class="hljs-literal">FALSE</span><br>     <span class="hljs-punctuation">)</span><br><br>p3 <span class="hljs-operator">&lt;-</span>p2 <span class="hljs-operator">+</span><br>     new_scale_fill<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>     geom_fruit<span class="hljs-punctuation">(</span><br>         geom<span class="hljs-operator">=</span>geom_tile<span class="hljs-punctuation">,</span><br>         mapping<span class="hljs-operator">=</span>aes<span class="hljs-punctuation">(</span>fill<span class="hljs-operator">=</span>year<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>         width<span class="hljs-operator">=</span><span class="hljs-number">0.002</span><span class="hljs-punctuation">,</span><br>         offset<span class="hljs-operator">=</span><span class="hljs-number">0.1</span><br>     <span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>     scale_fill_manual<span class="hljs-punctuation">(</span><br>         name<span class="hljs-operator">=</span><span class="hljs-string">"Year"</span><span class="hljs-punctuation">,</span><br>         values<span class="hljs-operator">=</span>yearcolors<span class="hljs-operator">$</span>year__colour<span class="hljs-punctuation">,</span><br>         guide<span class="hljs-operator">=</span>guide_legend<span class="hljs-punctuation">(</span>keywidth<span class="hljs-operator">=</span><span class="hljs-number">0.3</span><span class="hljs-punctuation">,</span> keyheight<span class="hljs-operator">=</span><span class="hljs-number">0.3</span><span class="hljs-punctuation">,</span> ncol<span class="hljs-operator">=</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span> order<span class="hljs-operator">=</span><span class="hljs-number">2</span><span class="hljs-punctuation">)</span><br>     <span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>     theme<span class="hljs-punctuation">(</span><br>           legend.title<span class="hljs-operator">=</span>element_text<span class="hljs-punctuation">(</span>size<span class="hljs-operator">=</span><span class="hljs-number">6</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> <span class="hljs-comment"># The size should be adjusted with the different devout.</span><br>           legend.text<span class="hljs-operator">=</span>element_text<span class="hljs-punctuation">(</span>size<span class="hljs-operator">=</span><span class="hljs-number">4.5</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>           legend.spacing.y <span class="hljs-operator">=</span> unit<span class="hljs-punctuation">(</span><span class="hljs-number">0.02</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"cm"</span><span class="hljs-punctuation">)</span><br>           <span class="hljs-punctuation">)</span><br>p3<br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://xiang-1257290193.cos.ap-guangzhou.myqcloud.com/Typora/202201071521939.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><blockquote>
<p>[1]. Yu G, Smith D K, Zhu H, et al. ggtree: an R package for visualization and annotation of phylogenetic trees with their covariates and other associated data[J]. <strong><em>Methods in Ecology and Evolution</em></strong>, 2017, 8(1): 28-36.</p>
<p>[2]. <a target="_blank" rel="noopener" href="https://yulab-smu.top/treedata-book/index.html">https://yulab-smu.top/treedata-book/index.html</a></p>
<p>[3]. <a target="_blank" rel="noopener" href="https://cosx.org/2015/11/to-achieve-the-visualization-and-annotation-of-evolutionary-tree-using-ggtree/">https://cosx.org/2015/11/to-achieve-the-visualization-and-annotation-of-evolutionary-tree-using-ggtree/</a></p>
<p>[4]. <a target="_blank" rel="noopener" href="https://yulab-smu.top/treedata-book/chapter1.html">https://yulab-smu.top/treedata-book/chapter1.html</a></p>
<p>[5]. Wang L G, Lam T T Y, Xu S, et al. Treeio: an R package for phylogenetic tree input and output with richly annotated and associated data[J]. Molecular biology and evolution, 2020, 37(2): 599-603.</p>
<p>[6]. <a target="_blank" rel="noopener" href="https://github.com/YuLab-SMU/tidytree">https://github.com/YuLab-SMU/tidytree</a></p>
</blockquote>
<p>交流请联系：</p>
<blockquote>
<blockquote>
<p>💌lixiang117423@gmail.com</p>
<p>💌lixiang117423@foxmail.com</p>
</blockquote>
</blockquote>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/R%E8%AF%AD%E8%A8%80/" class="category-chain-item">R语言</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/R%E8%AF%AD%E8%A8%80/" class="print-no-link">#R语言</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>ggtree学习笔记</div>
      <div>https://lixiang117423.github.io/article/fb57811f/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>小蓝哥</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2021年2月15日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/article/5d800d6f/" title="Coursera助学金申请模板">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Coursera助学金申请模板</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/article/baab187/" title="新希望—野生（近缘）种质资源">
                        <span class="hidden-mobile">新希望—野生（近缘）种质资源</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
    <!-- 备案信息 ICP for China -->
    <div class="beian">
  <span>
    <a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">
      滇ICP备2021000708号-4
    </a>
  </span>
  
</div>

  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    
      <script  src="/js/img-lazyload.js" ></script>
    
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
